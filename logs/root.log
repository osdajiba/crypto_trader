2025-03-08 16:32:30,757 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:32:30,806 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:32:30,808 - trading_system - INFO - Trading system initializing...
2025-03-08 16:32:30,829 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:32:30,833 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:32:30,835 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:32:30,837 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:32:30,849 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:32:30,851 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:32:30,854 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:32:30,857 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:32:30,859 - trading_system - INFO - 创建了local数据源
2025-03-08 16:32:30,865 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:32:30,869 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:32:30,870 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:32:30,870 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:32:30,872 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:32:30,875 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:32:31,487 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:32:31,490 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:32:31,493 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:32:31,498 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:32:31,512 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:32:31,513 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:32:31,515 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:32:31,516 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:32:31,517 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:32:31,518 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:32:31,520 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:32:31,522 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:32:31,523 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:32:31,524 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:32:31,525 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:32:31,529 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:32:31,530 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2022-01-01-2023-12-31
2025-03-08 16:32:31,532 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:32:31,533 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:32:31,536 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:32:31,537 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:32:31,539 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:32:31,540 - system.execution - INFO - Execution engine closed
2025-03-08 16:32:31,541 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:32:31,541 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:32:31,542 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:32:31,543 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:32:31,543 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:32:31,544 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:32:31,545 - AsyncExecutor - INFO - Task task_1232337092448_0 cancelled
2025-03-08 16:32:31,549 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:32:31,550 - AsyncExecutor - INFO - Task task_1232337092448_0 was cancelled
2025-03-08 16:33:31,462 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:33:31,504 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:33:31,506 - trading_system - INFO - Trading system initializing...
2025-03-08 16:33:31,517 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:33:31,519 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:33:31,519 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:33:31,520 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:33:31,520 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:33:31,521 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:33:31,523 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:33:31,524 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:33:31,525 - trading_system - INFO - 创建了local数据源
2025-03-08 16:33:31,527 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:33:31,529 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:33:31,530 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:33:31,531 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:33:31,532 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:33:31,534 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:33:32,053 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:33:32,055 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:33:32,057 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:33:32,060 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:33:32,062 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:33:32,063 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:33:32,064 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:33:32,065 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:33:32,067 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:33:32,069 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:33:32,071 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:33:32,082 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:33:32,083 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:33:32,084 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:33:32,085 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:33:32,088 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:33:32,090 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2022-01-01-2023-12-31
2025-03-08 16:33:32,091 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:33:32,093 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:33:32,095 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:33:32,097 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:33:32,098 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:33:32,099 - system.execution - INFO - Execution engine closed
2025-03-08 16:33:32,100 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:33:32,101 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:33:32,102 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:33:32,103 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:33:32,103 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:33:32,104 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:33:32,105 - AsyncExecutor - INFO - Task task_2489916292960_0 cancelled
2025-03-08 16:33:32,108 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:33:32,109 - AsyncExecutor - INFO - Task task_2489916292960_0 was cancelled
2025-03-08 16:34:16,368 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:34:16,413 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:34:16,414 - trading_system - INFO - Trading system initializing...
2025-03-08 16:34:16,426 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:34:16,436 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:34:16,437 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:34:16,438 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:34:16,439 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:34:16,440 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:34:16,441 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:34:16,442 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:34:16,442 - trading_system - INFO - 创建了local数据源
2025-03-08 16:34:16,446 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:34:16,448 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:34:16,449 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:34:16,450 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:34:16,451 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:34:16,453 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:34:17,141 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:34:17,143 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:34:17,146 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:34:17,152 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:34:17,154 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:34:17,156 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:34:17,157 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:34:17,158 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:34:17,159 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:34:17,159 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:34:17,161 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:34:17,163 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:34:17,164 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:34:17,164 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:34:17,166 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:34:37,314 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:34:37,317 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2022-01-01-2023-12-31
2025-03-08 16:34:37,323 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:34:37,326 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:34:37,331 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:34:37,332 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:34:37,333 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:34:37,334 - system.execution - INFO - Execution engine closed
2025-03-08 16:34:37,335 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:34:37,336 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:34:37,338 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:34:37,339 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:34:37,340 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:34:37,341 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:34:37,342 - AsyncExecutor - INFO - Task task_2349333660192_0 cancelled
2025-03-08 16:34:37,348 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:34:37,348 - AsyncExecutor - INFO - Task task_2349333660192_0 was cancelled
2025-03-08 16:34:43,099 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:34:43,137 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:34:43,137 - trading_system - INFO - Trading system initializing...
2025-03-08 16:34:43,147 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:34:43,148 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:34:43,149 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:34:43,149 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:34:43,151 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:34:43,152 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:34:43,153 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:34:43,153 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:34:43,154 - trading_system - INFO - 创建了local数据源
2025-03-08 16:34:43,158 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:34:43,161 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:34:43,162 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:34:43,163 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:34:43,164 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:34:43,166 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:34:43,655 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:34:43,658 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:34:43,660 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:34:43,664 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:34:43,666 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:34:43,668 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:34:43,669 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:34:43,670 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:34:43,671 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:34:43,672 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:34:43,673 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:34:43,676 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:34:43,677 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:34:43,678 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:34:43,679 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:41:11,350 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:41:24,386 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2022-01-01-2023-12-31
2025-03-08 16:41:30,792 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:41:30,830 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:41:30,831 - trading_system - INFO - Trading system initializing...
2025-03-08 16:41:30,841 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:41:30,843 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:41:30,843 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:41:30,845 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:41:30,845 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:41:30,846 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:41:30,847 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:41:30,848 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:41:30,849 - trading_system - INFO - 创建了local数据源
2025-03-08 16:41:30,852 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:41:30,854 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:41:30,855 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:41:30,856 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:41:30,857 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:41:30,860 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:41:31,429 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:41:31,431 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:41:31,433 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:41:31,437 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:41:31,439 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:41:31,440 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:41:31,441 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:41:31,442 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:41:31,443 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:41:31,444 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:41:31,446 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:41:31,447 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:41:31,448 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:41:31,449 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:41:31,450 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:42:24,075 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:45:06,067 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2022-01-01-2023-12-31
2025-03-08 16:45:06,073 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:45:06,078 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:45:06,082 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:45:06,084 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:45:06,085 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:45:06,085 - system.execution - INFO - Execution engine closed
2025-03-08 16:45:06,086 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:45:06,088 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:45:06,089 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:45:06,090 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:45:06,091 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:45:06,091 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:45:06,091 - AsyncExecutor - INFO - Task task_2475635425984_0 cancelled
2025-03-08 16:45:06,099 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:45:06,100 - AsyncExecutor - INFO - Task task_2475635425984_0 was cancelled
2025-03-08 16:45:11,641 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:45:11,697 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:45:11,698 - trading_system - INFO - Trading system initializing...
2025-03-08 16:45:11,706 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:45:11,708 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:45:11,708 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:45:11,709 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:45:11,710 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:45:11,711 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:45:11,712 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:45:11,714 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:45:11,714 - trading_system - INFO - 创建了local数据源
2025-03-08 16:46:13,283 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:46:13,290 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:46:13,292 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:46:13,294 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:46:13,297 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:46:13,301 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:46:13,807 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:46:13,809 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:46:13,812 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:46:13,817 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:46:13,818 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:46:13,819 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:46:13,820 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:46:13,821 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:46:13,822 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:46:13,823 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:46:13,832 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:46:13,833 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:46:13,834 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:46:13,834 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:46:13,835 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:46:34,520 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:46:34,557 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:46:34,557 - trading_system - INFO - Trading system initializing...
2025-03-08 16:46:34,569 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:46:34,570 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:46:34,570 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:46:34,571 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:46:34,572 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:46:34,572 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:46:34,573 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:46:34,573 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:46:34,573 - trading_system - INFO - 创建了local数据源
2025-03-08 16:48:12,824 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:48:12,830 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:48:12,833 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:48:12,834 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:48:12,838 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:48:12,841 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:48:13,359 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:48:13,361 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:48:13,364 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:48:13,368 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:48:13,370 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:48:13,371 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:48:13,372 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:48:13,373 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:48:13,374 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:48:13,375 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:48:13,384 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:48:13,386 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:48:13,386 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:48:13,387 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:48:13,388 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:48:41,575 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:48:41,610 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:48:41,612 - trading_system - INFO - Trading system initializing...
2025-03-08 16:48:41,622 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:48:41,623 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:48:41,624 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:48:41,625 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:48:41,626 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:48:41,626 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:48:41,627 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:48:41,628 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:48:41,629 - trading_system - INFO - 创建了local数据源
2025-03-08 16:49:35,484 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:49:35,491 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:49:35,493 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:49:35,494 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:49:35,497 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:49:35,502 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:49:36,009 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:49:36,013 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:49:36,014 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:49:36,018 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:49:36,020 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:49:36,021 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:49:36,022 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:49:36,023 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:49:36,024 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:49:36,026 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:49:36,035 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:49:36,036 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:49:36,037 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:49:36,038 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:49:36,038 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:49:45,786 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:49:45,847 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:49:45,849 - trading_system - INFO - Trading system initializing...
2025-03-08 16:49:45,871 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:49:45,874 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:49:45,875 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:49:45,876 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:49:45,878 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:49:45,879 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:49:45,880 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:49:45,882 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:49:45,883 - trading_system - INFO - 创建了local数据源
2025-03-08 16:50:03,807 - trading_system - ERROR - 连接Binance失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:50:03,813 - trading_system - ERROR - 创建exchange数据源失败: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 53, in __init__
    self._connect_exchange()
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 90, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-08 16:50:03,814 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-08 16:50:03,815 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:50:03,817 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:50:03,820 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:50:04,325 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:50:04,327 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:50:04,329 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:50:04,335 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:50:04,338 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:50:04,340 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:50:04,342 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:50:04,344 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:50:04,345 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:50:04,347 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:50:04,356 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:50:04,357 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:50:04,358 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:50:04,359 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:50:04,360 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:50:10,223 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:50:10,265 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:50:10,266 - trading_system - INFO - Trading system initializing...
2025-03-08 16:50:10,275 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:50:10,276 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:50:10,277 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:50:10,278 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:50:10,279 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:50:10,279 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:50:10,280 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:50:10,281 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:50:10,282 - trading_system - INFO - 创建了local数据源
2025-03-08 16:51:12,424 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:51:12,460 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:51:12,461 - trading_system - INFO - Trading system initializing...
2025-03-08 16:51:38,654 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:51:38,688 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:51:38,688 - trading_system - INFO - Trading system initializing...
2025-03-08 16:51:53,777 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:51:53,779 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:51:58,113 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:51:58,114 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:51:58,117 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:51:58,118 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:51:58,120 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:51:58,122 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:51:58,122 - trading_system - INFO - 创建了local数据源
2025-03-08 16:52:30,383 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:52:30,419 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:52:30,420 - trading_system - INFO - Trading system initializing...
2025-03-08 16:52:30,430 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:52:30,432 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:52:30,432 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:52:30,433 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:52:30,434 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:52:30,434 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:52:30,435 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:52:30,437 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:52:30,437 - trading_system - INFO - 创建了local数据源
2025-03-08 16:52:53,358 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:52:53,380 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:52:53,384 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:52:53,385 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:52:53,387 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:52:53,388 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:52:53,389 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:52:53,391 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:52:53,394 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:52:53,965 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:52:53,968 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:52:53,970 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:52:53,975 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:52:53,976 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:52:53,978 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:52:53,979 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:52:53,981 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:52:53,982 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:52:53,982 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:52:53,992 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:52:53,993 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:52:53,994 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:52:53,994 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:52:53,996 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:53:18,579 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:53:24,323 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2022-01-01-2023-12-31，尝试从交易所下载
2025-03-08 16:53:24,324 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2022-01-01 - 2023-12-31
2025-03-08 16:53:24,576 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为18个部分
2025-03-08 16:53:24,577 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2022-01-01 16:00:00+08:00 - 2022-02-11 04:00:00+08:00
2025-03-08 16:53:24,578 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:53:24,780 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:26,792 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:30,794 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:30,796 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:30,798 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:32,810 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:36,824 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:36,826 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:36,828 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2022-01-01 16:00:00+08:00 - 2022-02-11 04:00:00+08:00
2025-03-08 16:53:39,844 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2022-02-11 04:00:00+08:00 - 2022-03-23 16:00:00+08:00
2025-03-08 16:53:39,846 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:53:39,848 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:41,855 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:45,872 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:45,874 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:45,877 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:47,897 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:51,895 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:51,897 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:51,898 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2022-02-11 04:00:00+08:00 - 2022-03-23 16:00:00+08:00
2025-03-08 16:53:54,892 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2022-03-23 16:00:00+08:00 - 2022-05-03 04:00:00+08:00
2025-03-08 16:53:54,894 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:53:54,896 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:53:56,902 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:00,930 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:00,932 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:00,933 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:02,951 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:06,975 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:06,976 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:06,977 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2022-03-23 16:00:00+08:00 - 2022-05-03 04:00:00+08:00
2025-03-08 16:54:09,975 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2022-05-03 04:00:00+08:00 - 2022-06-12 16:00:00+08:00
2025-03-08 16:54:09,978 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:54:09,980 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:12,001 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:16,024 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:16,025 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:16,028 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:18,052 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:22,068 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:22,071 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:22,073 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2022-05-03 04:00:00+08:00 - 2022-06-12 16:00:00+08:00
2025-03-08 16:54:27,723 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:54:27,774 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:54:27,774 - trading_system - INFO - Trading system initializing...
2025-03-08 16:54:27,782 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:54:27,783 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:54:27,784 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:54:27,784 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:54:27,786 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:54:27,786 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:54:27,787 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:54:27,789 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:54:27,790 - trading_system - INFO - 创建了local数据源
2025-03-08 16:54:32,967 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:54:32,989 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:54:32,991 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:54:32,992 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:54:32,994 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:54:32,996 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:54:32,997 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:54:32,998 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:54:33,002 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:54:33,532 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:54:33,535 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:54:33,537 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:54:33,542 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:54:33,543 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:54:33,545 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:54:33,547 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:54:33,547 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:54:33,548 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:54:33,549 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:54:33,550 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:54:33,552 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:54:33,553 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:54:33,554 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:54:33,554 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:54:33,557 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:54:38,382 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 16:54:38,384 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 16:54:38,593 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 16:54:38,594 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:54:38,595 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:54:38,884 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:40,896 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:44,902 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:44,904 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:44,906 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:46,914 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:50,916 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:50,918 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:54:50,921 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:54:50,924 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 16:54:50,926 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 16:54:50,928 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 16:54:50,932 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:54:50,933 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:54:50,941 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:54:50,942 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:54:50,943 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:54:50,944 - system.execution - INFO - Execution engine closed
2025-03-08 16:54:50,945 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:54:50,956 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:54:50,957 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:54:50,958 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:54:50,959 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:54:50,960 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:54:50,961 - AsyncExecutor - INFO - Task task_1964508627648_0 cancelled
2025-03-08 16:54:50,963 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:54:50,964 - AsyncExecutor - INFO - Task task_1964508627648_0 was cancelled
2025-03-08 16:55:04,531 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:55:04,581 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:55:04,582 - trading_system - INFO - Trading system initializing...
2025-03-08 16:55:04,594 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:55:04,595 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:55:04,597 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:55:04,597 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:55:04,597 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:55:04,599 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:55:04,599 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:55:04,601 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:55:04,602 - trading_system - INFO - 创建了local数据源
2025-03-08 16:55:04,621 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:55:04,645 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:55:04,646 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:55:04,647 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:55:04,648 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:55:04,648 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:55:04,649 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:55:04,651 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:55:04,653 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:55:05,140 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:55:05,143 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:55:05,145 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:55:05,149 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:55:05,152 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:55:05,154 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:55:05,155 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:55:05,156 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:55:05,157 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:55:05,158 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:55:05,160 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:55:05,162 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:55:05,163 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:55:05,164 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:55:05,165 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:55:05,168 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:55:05,168 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 16:55:05,170 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 16:55:05,379 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 16:55:05,380 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:55:05,381 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:55:05,560 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:07,574 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:11,581 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:11,583 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:11,584 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:13,598 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:17,617 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:17,620 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:17,621 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:55:17,623 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 16:55:17,627 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 16:55:17,628 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 16:55:17,631 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:55:17,633 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:55:17,640 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:55:17,641 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:55:17,642 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:55:17,644 - system.execution - INFO - Execution engine closed
2025-03-08 16:55:17,645 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:55:17,646 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:55:17,648 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:55:17,649 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:55:17,650 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:55:17,650 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:55:17,651 - AsyncExecutor - INFO - Task task_1766228148768_0 cancelled
2025-03-08 16:55:17,652 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:55:17,653 - AsyncExecutor - INFO - Task task_1766228148768_0 was cancelled
2025-03-08 16:55:23,232 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:55:23,310 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:55:23,311 - trading_system - INFO - Trading system initializing...
2025-03-08 16:55:23,321 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:55:23,323 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:55:23,323 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:55:23,324 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:55:23,324 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:55:23,325 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:55:23,325 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:55:23,328 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:55:23,329 - trading_system - INFO - 创建了local数据源
2025-03-08 16:55:23,360 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:55:23,401 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:55:23,403 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:55:23,405 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:55:23,406 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:55:23,407 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:55:23,409 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:55:23,411 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:55:23,414 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:55:24,070 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:55:24,074 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:55:24,078 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:55:24,084 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:55:24,086 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:55:24,088 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:55:24,090 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:55:24,091 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:55:24,092 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:55:24,093 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:55:24,094 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:55:24,096 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:55:24,097 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:55:24,099 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:55:24,099 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:55:24,103 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:55:24,104 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 16:55:24,105 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 16:55:24,310 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 16:55:24,311 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:55:24,312 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:55:24,516 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:26,544 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:30,548 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:30,550 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:30,552 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:32,578 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:55:37,425 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:55:37,461 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:55:37,461 - trading_system - INFO - Trading system initializing...
2025-03-08 16:55:37,471 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:55:37,472 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:55:37,474 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:55:37,474 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:55:37,474 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:55:37,475 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:55:37,476 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:55:37,476 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:55:37,477 - trading_system - INFO - 创建了local数据源
2025-03-08 16:55:37,504 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:55:37,541 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:55:37,542 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:55:37,542 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:55:37,543 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:55:37,543 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:55:37,545 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:55:37,546 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:55:37,560 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:55:38,048 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:55:38,050 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:55:38,052 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:55:38,056 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:55:38,057 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:55:38,058 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:55:38,060 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:55:38,061 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:55:38,062 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:55:38,062 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:55:38,064 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:55:38,065 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:55:38,066 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:55:38,066 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:55:38,067 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:55:38,070 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:55:38,071 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 16:55:41,647 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 16:56:03,744 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 16:56:18,583 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:56:18,584 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:56:18,820 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:20,826 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:24,846 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:24,848 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:24,849 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:26,867 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:30,888 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:30,891 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:56:30,893 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:56:30,895 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 16:56:30,897 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 16:56:30,898 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 16:56:30,900 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 16:56:30,901 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 16:56:30,906 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:56:30,907 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 16:56:30,908 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:56:30,908 - system.execution - INFO - Execution engine closed
2025-03-08 16:56:30,910 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:56:30,911 - trading_system - INFO - Initiating system shutdown...
2025-03-08 16:56:30,912 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 16:56:30,912 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 16:56:30,913 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 16:56:30,914 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 16:56:30,914 - AsyncExecutor - INFO - Task task_1436217033248_0 cancelled
2025-03-08 16:56:30,915 - trading_system - INFO - Shutting down trading system...
2025-03-08 16:56:30,916 - AsyncExecutor - INFO - Task task_1436217033248_0 was cancelled
2025-03-08 16:56:39,111 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:56:39,158 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:56:39,159 - trading_system - INFO - Trading system initializing...
2025-03-08 16:56:39,171 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:56:39,173 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:56:39,173 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:56:39,174 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:56:39,174 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:56:39,176 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:56:39,177 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:56:39,179 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:56:39,179 - trading_system - INFO - 创建了local数据源
2025-03-08 16:56:39,200 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:56:39,223 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:56:39,224 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:56:39,226 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:56:39,226 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:56:39,227 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:56:39,228 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:56:39,228 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:56:39,230 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:56:39,694 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:56:39,698 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:56:39,700 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:56:39,703 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:56:39,705 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:56:39,706 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:56:39,708 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:56:39,708 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:56:39,710 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:56:39,710 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:56:39,713 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:56:39,714 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:56:39,715 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:56:39,716 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:56:39,717 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:56:39,720 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:56:39,721 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 16:56:50,917 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 16:56:51,113 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 16:57:37,814 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:57:37,816 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:58:24,364 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 16:58:24,401 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 16:58:24,402 - trading_system - INFO - Trading system initializing...
2025-03-08 16:58:24,410 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 16:58:24,412 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 16:58:24,413 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 16:58:24,413 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 16:58:24,414 - trading_system - INFO - Starting trading pipeline...
2025-03-08 16:58:24,414 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:58:24,415 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 16:58:24,416 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 16:58:24,416 - trading_system - INFO - 创建了local数据源
2025-03-08 16:58:24,438 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 16:58:24,458 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 16:58:24,458 - trading_system - INFO - Binance接口初始化完成
2025-03-08 16:58:24,460 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 16:58:24,461 - trading_system - INFO - 创建了exchange数据源
2025-03-08 16:58:24,462 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 16:58:24,462 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 16:58:24,463 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 16:58:24,465 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 16:58:24,926 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:58:24,929 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:58:24,931 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 16:58:24,935 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 16:58:24,937 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 16:58:24,938 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 16:58:24,939 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 16:58:24,941 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 16:58:24,942 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 16:58:24,943 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 16:58:24,944 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 16:58:24,944 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 16:58:24,946 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 16:58:24,947 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 16:58:24,948 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 16:58:24,950 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 16:58:24,951 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 16:58:33,833 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 16:58:34,010 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 16:58:49,708 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 16:58:49,711 - trading_system - INFO - 将请求分为2个块
2025-03-08 16:59:34,348 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 16:59:48,601 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:24,019 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:24,020 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:24,021 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:26,034 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:30,045 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:30,047 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:00:30,049 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 17:00:30,052 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 17:00:30,055 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 17:00:30,057 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 17:00:30,059 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 17:00:30,061 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 17:00:30,068 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 17:00:30,069 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 17:00:30,072 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 17:00:30,073 - system.execution - INFO - Execution engine closed
2025-03-08 17:00:30,074 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 17:00:30,075 - trading_system - INFO - Initiating system shutdown...
2025-03-08 17:00:30,076 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 17:00:30,076 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 17:00:30,077 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 17:00:30,078 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 17:00:30,079 - AsyncExecutor - INFO - Task task_1806294090752_0 cancelled
2025-03-08 17:00:30,080 - trading_system - INFO - Shutting down trading system...
2025-03-08 17:00:30,081 - AsyncExecutor - INFO - Task task_1806294090752_0 was cancelled
2025-03-08 17:00:34,580 - ccxt.base.exchange - WARNING - binance requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-03-08 17:00:34,581 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001A48F7B4150>
2025-03-08 17:00:47,707 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 17:00:47,745 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 17:00:47,747 - trading_system - INFO - Trading system initializing...
2025-03-08 17:00:47,759 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 17:00:47,761 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 17:00:47,762 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 17:00:47,762 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 17:00:47,763 - trading_system - INFO - Starting trading pipeline...
2025-03-08 17:00:47,764 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 17:00:47,765 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 17:00:47,766 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 17:00:47,767 - trading_system - INFO - 创建了local数据源
2025-03-08 17:00:47,794 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 17:00:47,817 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 17:00:47,818 - trading_system - INFO - Binance接口初始化完成
2025-03-08 17:00:47,819 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 17:00:47,821 - trading_system - INFO - 创建了exchange数据源
2025-03-08 17:00:47,821 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 17:00:47,822 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 17:00:47,824 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 17:00:47,826 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 17:00:48,332 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 17:00:48,335 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 17:00:48,337 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 17:00:48,342 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 17:00:48,344 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 17:00:48,346 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 17:00:48,347 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 17:00:48,349 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 17:00:48,350 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 17:00:48,351 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 17:00:48,354 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 17:00:48,355 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 17:00:48,357 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 17:00:48,357 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 17:00:48,359 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 17:00:48,361 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 17:00:48,362 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 17:00:48,363 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 17:00:48,538 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 17:01:10,349 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 17:01:10,351 - trading_system - INFO - 将请求分为2个块
2025-03-08 17:01:10,597 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:12,603 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:16,597 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:16,599 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:16,601 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:18,602 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:22,614 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:22,616 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:01:22,618 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 17:01:22,620 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 17:01:22,623 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 17:01:22,624 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 17:01:22,626 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 17:01:22,627 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 17:01:22,632 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 17:01:22,634 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 17:01:22,635 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 17:01:22,636 - system.execution - INFO - Execution engine closed
2025-03-08 17:01:22,637 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 17:01:22,637 - trading_system - INFO - Initiating system shutdown...
2025-03-08 17:01:22,638 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 17:01:22,639 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 17:01:22,640 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 17:01:22,641 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 17:01:22,642 - AsyncExecutor - INFO - Task task_2216593490464_0 cancelled
2025-03-08 17:01:22,644 - trading_system - INFO - Shutting down trading system...
2025-03-08 17:01:22,645 - AsyncExecutor - INFO - Task task_2216593490464_0 was cancelled
2025-03-08 17:02:01,855 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 17:02:01,898 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 17:02:01,899 - trading_system - INFO - Trading system initializing...
2025-03-08 17:02:01,909 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 17:02:01,910 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 17:02:01,911 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 17:02:01,911 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 17:02:01,912 - trading_system - INFO - Starting trading pipeline...
2025-03-08 17:02:01,912 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 17:02:01,913 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 17:02:01,914 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 17:02:01,915 - trading_system - INFO - 创建了local数据源
2025-03-08 17:02:01,942 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 17:02:01,989 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 17:02:01,991 - trading_system - INFO - Binance接口初始化完成
2025-03-08 17:02:01,993 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 17:02:01,995 - trading_system - INFO - 创建了exchange数据源
2025-03-08 17:02:01,996 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 17:02:01,997 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 17:02:01,998 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 17:02:02,001 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 17:02:02,588 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 17:02:02,591 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 17:02:02,593 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 17:02:02,598 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 17:02:02,601 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 17:02:02,602 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 17:02:02,603 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 17:02:02,604 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 17:02:02,605 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 17:02:02,606 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 17:02:02,607 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 17:02:02,609 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 17:02:02,610 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 17:02:02,611 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 17:02:02,612 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 17:02:02,616 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 17:02:02,616 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 17:02:02,617 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 17:02:02,784 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 17:02:29,748 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 17:02:29,750 - trading_system - INFO - 将请求分为2个块
2025-03-08 17:03:37,790 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:03:57,425 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:04:06,438 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:04:06,440 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 17:04:10,512 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:47:53,094 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:47:53,114 - ConfigManager - INFO - Configuration loaded from D:\jacky\crypto_py\conf\config.yaml
2025-03-08 18:47:53,114 - trading_system - INFO - Trading system initializing...
2025-03-08 18:47:53,177 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:47:53,178 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:47:53,178 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:47:53,178 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:47:53,179 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:47:53,179 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:47:53,179 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:47:53,179 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:47:53,179 - trading_system - INFO - 创建了local数据源
2025-03-08 18:47:53,185 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:47:53,190 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:47:53,190 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:47:53,190 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:47:53,191 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:47:53,191 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:47:53,191 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:47:53,192 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:47:53,209 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:47:57,831 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:47:57,846 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:47:57,870 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:47:57,891 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:47:57,905 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:47:57,925 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:47:57,926 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:47:57,926 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:47:57,927 - system.strategyfactory - WARNING - 使用标准方法加载策略 simple 失败: 未知类型: simple，尝试替代方法
2025-03-08 18:47:57,927 - system.strategyfactory - ERROR - 创建失败: 未知策略: simple
2025-03-08 18:47:57,928 - system.tradingmodefactory - ERROR - 创建 backtest 失败: 未知策略: simple
2025-03-08 18:47:57,928 - system.tradingmodefactory - ERROR - 创建失败: 创建 backtest 失败: 未知策略: simple
2025-03-08 18:47:57,928 - trading_system - ERROR - Error in trading pipeline: 创建 backtest 失败: 未知策略: simple
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 146, in _get_concrete_class
    return await self._load_class_from_path(name, BaseStrategy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 303, in _load_class_from_path
    raise ValueError(f"未知类型: {name}")
ValueError: 未知类型: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 222, in _get_or_create
    await instance.initialize()
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 29, in initialize
    self.strategy = await self.strategy_factory.create(strategy_name, strategy_params)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 70, in create
    concrete_class = await self._get_concrete_class(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 152, in _get_concrete_class
    raise ValueError(f"未知策略: {name}")
ValueError: 未知策略: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\core\core.py", line 65, in run_pipeline
    self.trading_mode = await self.mode_factory.create(self.mode)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 73, in create
    return await self._get_or_create(name, concrete_class, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 231, in _get_or_create
    raise ValueError(f"创建 {name} 失败: {e}")
ValueError: 创建 backtest 失败: 未知策略: simple
2025-03-08 18:47:57,931 - trading_system - INFO - Initiating system shutdown...
2025-03-08 18:47:57,931 - trading_system - WARNING - Trading mode not properly initialized, skipping shutdown
2025-03-08 18:47:57,931 - AsyncExecutor - INFO - Task task_1389920671744_0 cancelled
2025-03-08 18:47:57,931 - trading_system - INFO - Shutting down trading system...
2025-03-08 18:47:57,932 - AsyncExecutor - INFO - Task task_1389920671744_0 was cancelled
2025-03-08 18:48:48,527 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:48:48,565 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\config.yaml
2025-03-08 18:48:48,566 - trading_system - INFO - Trading system initializing...
2025-03-08 18:48:48,573 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:48:48,574 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:48:48,575 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:48:48,576 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:48:48,576 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:48:48,577 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:48:48,578 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:48:48,580 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:48:48,581 - trading_system - INFO - 创建了local数据源
2025-03-08 18:48:48,601 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:48:48,621 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:48:48,622 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:48:48,623 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:48:48,623 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:48:48,625 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:48:48,626 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:48:48,627 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:48:48,628 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:48:49,227 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:48:49,231 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:48:49,236 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:48:49,241 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:48:49,243 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:48:49,245 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:48:49,247 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:48:49,248 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:48:49,249 - system.strategyfactory - WARNING - 使用标准方法加载策略 simple 失败: 未知类型: simple，尝试替代方法
2025-03-08 18:48:49,250 - system.strategyfactory - ERROR - 创建失败: 未知策略: simple
2025-03-08 18:48:49,251 - system.tradingmodefactory - ERROR - 创建 backtest 失败: 未知策略: simple
2025-03-08 18:48:49,252 - system.tradingmodefactory - ERROR - 创建失败: 创建 backtest 失败: 未知策略: simple
2025-03-08 18:48:49,252 - trading_system - ERROR - Error in trading pipeline: 创建 backtest 失败: 未知策略: simple
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 146, in _get_concrete_class
    return await self._load_class_from_path(name, BaseStrategy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 303, in _load_class_from_path
    raise ValueError(f"未知类型: {name}")
ValueError: 未知类型: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 222, in _get_or_create
    await instance.initialize()
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 29, in initialize
    self.strategy = await self.strategy_factory.create(strategy_name, strategy_params)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 70, in create
    concrete_class = await self._get_concrete_class(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 152, in _get_concrete_class
    raise ValueError(f"未知策略: {name}")
ValueError: 未知策略: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\core\core.py", line 65, in run_pipeline
    self.trading_mode = await self.mode_factory.create(self.mode)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 73, in create
    return await self._get_or_create(name, concrete_class, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 231, in _get_or_create
    raise ValueError(f"创建 {name} 失败: {e}")
ValueError: 创建 backtest 失败: 未知策略: simple
2025-03-08 18:48:49,257 - trading_system - INFO - Initiating system shutdown...
2025-03-08 18:48:49,258 - trading_system - WARNING - Trading mode not properly initialized, skipping shutdown
2025-03-08 18:48:49,259 - AsyncExecutor - INFO - Task task_1178393166688_0 cancelled
2025-03-08 18:48:49,261 - trading_system - INFO - Shutting down trading system...
2025-03-08 18:48:49,261 - AsyncExecutor - INFO - Task task_1178393166688_0 was cancelled
2025-03-08 18:50:27,519 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:50:27,550 - ConfigManager - INFO - Configuration loaded from D:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 18:50:27,551 - trading_system - INFO - Trading system initializing...
2025-03-08 18:50:27,554 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:50:27,555 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:50:27,555 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:50:27,555 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:50:27,555 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:50:27,557 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:50:27,557 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:50:27,557 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:50:27,557 - trading_system - INFO - 创建了local数据源
2025-03-08 18:50:27,564 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:50:27,570 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:50:27,570 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:50:27,570 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:50:27,571 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:50:27,571 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:50:27,571 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:50:27,571 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:50:27,573 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:50:27,907 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:50:27,908 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:50:27,909 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:50:27,910 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:50:27,911 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:50:27,911 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:50:27,912 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:50:27,912 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:50:27,913 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 18:50:27,913 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 18:50:27,914 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 18:50:27,914 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 18:50:27,914 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 18:50:27,914 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:50:27,915 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 18:50:27,919 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 18:50:27,919 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 18:50:27,920 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 18:50:30,748 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 18:50:30,749 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 18:50:30,750 - trading_system - INFO - 将请求分为2个块
2025-03-08 18:50:31,053 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:50:33,055 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:50:58,926 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:50:58,963 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 18:50:58,963 - trading_system - INFO - Trading system initializing...
2025-03-08 18:50:58,971 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:50:58,973 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:50:58,974 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:50:58,975 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:50:58,976 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:50:58,976 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:50:58,977 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:50:58,979 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:50:58,979 - trading_system - INFO - 创建了local数据源
2025-03-08 18:50:59,000 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:50:59,024 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:50:59,025 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:50:59,025 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:50:59,026 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:50:59,027 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:50:59,027 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:50:59,028 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:50:59,030 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:50:59,506 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:50:59,509 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:50:59,512 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:50:59,515 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:50:59,518 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:50:59,519 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:50:59,521 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:50:59,522 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:50:59,523 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 18:50:59,524 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 18:50:59,525 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 18:50:59,528 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 18:50:59,529 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 18:50:59,530 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:50:59,531 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 18:50:59,533 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 18:50:59,535 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 18:50:59,536 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 18:50:59,738 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 18:51:31,381 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 18:51:31,383 - trading_system - INFO - 将请求分为2个块
2025-03-08 18:51:38,779 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:51:43,555 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:54:17,941 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:54:17,975 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 18:54:17,976 - trading_system - INFO - Trading system initializing...
2025-03-08 18:54:17,983 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:54:17,984 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:54:17,986 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:54:17,987 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:54:17,987 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:54:17,988 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:54:17,989 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:54:17,991 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:54:17,992 - trading_system - INFO - 创建了local数据源
2025-03-08 18:54:18,013 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:54:18,033 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:54:18,035 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:54:18,036 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:54:18,037 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:54:18,038 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:54:18,038 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:54:18,039 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:54:18,041 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:54:18,507 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:54:18,510 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:54:18,511 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:54:18,515 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:54:18,516 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:54:18,518 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:54:18,519 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:54:18,520 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:54:18,521 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 18:54:18,522 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 18:54:18,523 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 18:54:18,524 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 18:54:18,525 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 18:54:18,526 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:54:18,527 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 18:54:18,529 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 18:54:18,530 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 18:54:18,531 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 18:54:18,666 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 18:54:58,859 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 18:54:58,860 - trading_system - INFO - 将请求分为2个块
2025-03-08 18:55:46,859 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:55:46,923 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 18:55:46,923 - trading_system - INFO - Trading system initializing...
2025-03-08 18:55:46,932 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:55:46,933 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:55:46,933 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:55:46,934 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:55:46,935 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:55:46,935 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:55:46,936 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:55:46,938 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:55:46,938 - trading_system - INFO - 创建了local数据源
2025-03-08 18:55:46,961 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:55:46,988 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:55:46,990 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:55:46,991 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:55:46,992 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:55:46,993 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:55:46,994 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:55:46,995 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:55:46,998 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:55:47,598 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:55:47,600 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:55:47,601 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:55:47,606 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:55:47,607 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:55:47,610 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:55:47,611 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:55:47,612 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:55:47,614 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 18:55:47,615 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 18:55:47,616 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 18:55:47,618 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 18:55:47,619 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 18:55:47,620 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:55:47,621 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 18:55:47,624 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 18:55:47,625 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 18:55:47,626 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 18:55:47,807 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 18:55:50,858 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 18:55:50,860 - trading_system - INFO - 将请求分为2个块
2025-03-08 18:55:52,714 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:56:33,628 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:56:33,665 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 18:56:33,666 - trading_system - INFO - Trading system initializing...
2025-03-08 18:56:33,673 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:56:33,675 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:56:33,676 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:56:33,677 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:56:33,678 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:56:33,678 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:56:33,679 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:56:33,680 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:56:33,681 - trading_system - INFO - 创建了local数据源
2025-03-08 18:56:33,704 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:56:33,725 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:56:33,726 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:56:33,726 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:56:33,728 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:56:33,729 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:56:33,730 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:56:33,731 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:56:33,733 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:56:34,206 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:56:34,208 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:56:34,210 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:56:34,214 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:56:34,215 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:56:34,217 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:56:34,218 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:56:34,218 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:56:34,220 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 18:56:34,221 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 18:56:34,222 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 18:56:34,223 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 18:56:34,224 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 18:56:34,225 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:56:34,225 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 18:56:34,228 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 18:56:34,229 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 18:56:34,230 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 18:56:34,366 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 18:56:37,773 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 18:56:37,774 - trading_system - INFO - 将请求分为2个块
2025-03-08 18:56:47,496 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 18:57:02,347 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 18:57:02,381 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 18:57:02,383 - trading_system - INFO - Trading system initializing...
2025-03-08 18:57:02,390 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 18:57:02,391 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 18:57:02,393 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 18:57:02,394 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 18:57:02,394 - trading_system - INFO - Starting trading pipeline...
2025-03-08 18:57:02,395 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:57:02,395 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 18:57:02,396 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 18:57:02,397 - trading_system - INFO - 创建了local数据源
2025-03-08 18:57:02,418 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 18:57:02,438 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 18:57:02,439 - trading_system - INFO - Binance接口初始化完成
2025-03-08 18:57:02,439 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 18:57:02,440 - trading_system - INFO - 创建了exchange数据源
2025-03-08 18:57:02,441 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 18:57:02,441 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 18:57:02,443 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 18:57:02,445 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 18:57:02,925 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:57:02,927 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:57:02,929 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 18:57:02,933 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 18:57:02,934 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 18:57:02,935 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 18:57:02,936 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 18:57:02,937 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 18:57:02,938 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 18:57:02,939 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 18:57:02,940 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 18:57:02,942 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 18:57:02,943 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 18:57:02,944 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 18:57:02,944 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 18:57:02,947 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 18:57:02,948 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 18:57:02,948 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 18:57:03,096 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 18:57:03,097 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 18:57:03,098 - trading_system - INFO - 将请求分为2个块
2025-03-08 18:57:14,465 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 19:03:59,910 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 19:03:59,984 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 19:03:59,986 - trading_system - INFO - Trading system initializing...
2025-03-08 19:04:00,000 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 19:04:00,003 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 19:04:00,004 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 19:04:00,006 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 19:04:00,006 - trading_system - INFO - Starting trading pipeline...
2025-03-08 19:04:00,009 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 19:04:00,011 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 19:04:00,013 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 19:04:00,014 - trading_system - INFO - 创建了local数据源
2025-03-08 19:04:00,039 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 19:04:00,063 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 19:04:00,064 - trading_system - INFO - Binance接口初始化完成
2025-03-08 19:04:00,065 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 19:04:00,065 - trading_system - INFO - 创建了exchange数据源
2025-03-08 19:04:00,066 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 19:04:00,068 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 19:04:00,070 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 19:04:00,072 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 19:04:00,596 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 19:04:00,598 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 19:04:00,600 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 19:04:00,603 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 19:04:00,605 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 19:04:00,606 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 19:04:00,608 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 19:04:00,608 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 19:04:00,610 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 19:04:00,611 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 19:04:00,612 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 19:04:00,614 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 19:04:00,616 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 19:04:00,616 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 19:04:00,617 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 19:04:00,620 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 19:04:00,621 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 19:04:00,622 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 19:04:00,787 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 19:04:00,788 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 19:04:00,789 - trading_system - INFO - 将请求分为2个块
2025-03-08 19:08:07,442 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 19:08:07,495 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 19:08:07,496 - trading_system - INFO - Trading system initializing...
2025-03-08 19:08:07,512 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 19:08:07,514 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 19:08:07,515 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 19:08:07,516 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 19:08:07,517 - trading_system - INFO - Starting trading pipeline...
2025-03-08 19:08:07,518 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 19:08:07,520 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 19:08:07,522 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 19:08:07,523 - trading_system - INFO - 创建了local数据源
2025-03-08 19:08:07,551 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 19:08:07,580 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 19:08:07,582 - trading_system - INFO - Binance接口初始化完成
2025-03-08 19:08:07,583 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 19:08:07,584 - trading_system - INFO - 创建了exchange数据源
2025-03-08 19:08:07,585 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 19:08:07,585 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 19:08:07,588 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 19:08:07,590 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 19:08:08,275 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 19:08:08,278 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 19:08:08,281 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 19:08:08,286 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 19:08:08,288 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 19:08:08,289 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 19:08:08,291 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 19:08:08,292 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 19:08:08,293 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 19:08:08,294 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 19:08:08,296 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 19:08:08,298 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 19:08:08,299 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 19:08:08,300 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 19:08:08,301 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 19:08:08,304 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 19:08:08,305 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 19:08:08,305 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 19:08:08,645 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 19:08:08,648 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 19:08:08,649 - trading_system - INFO - 将请求分为2个块
2025-03-08 19:08:10,773 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 19:08:21,784 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-08 19:08:30,329 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 19:08:30,330 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 19:08:30,330 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 19:08:30,331 - system.execution - INFO - Execution engine closed
2025-03-08 19:08:30,341 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 19:08:30,342 - trading_system - INFO - Initiating system shutdown...
2025-03-08 19:08:30,342 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 19:08:30,343 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 19:08:30,343 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 19:08:30,344 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 19:08:30,344 - AsyncExecutor - INFO - Task task_1989425136160_0 cancelled
2025-03-08 19:08:30,344 - trading_system - INFO - Shutting down trading system...
2025-03-08 19:08:30,345 - AsyncExecutor - INFO - Task task_1989425136160_0 was cancelled
2025-03-08 19:08:31,203 - ccxt.base.exchange - WARNING - binance requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-03-08 19:08:31,204 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000001CF3512FA90>
2025-03-08 21:57:07,735 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 21:57:07,773 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 21:57:07,774 - trading_system - INFO - Trading system initializing...
2025-03-08 21:57:07,784 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 21:57:07,785 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 21:57:07,785 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 21:57:07,785 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 21:57:07,786 - trading_system - INFO - Starting trading pipeline...
2025-03-08 21:57:07,786 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 21:57:07,787 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 21:57:07,788 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 21:57:07,789 - trading_system - INFO - 创建了local数据源
2025-03-08 21:57:07,812 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 21:57:07,833 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 21:57:07,834 - trading_system - INFO - Binance接口初始化完成
2025-03-08 21:57:07,835 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 21:57:07,835 - trading_system - INFO - 创建了exchange数据源
2025-03-08 21:57:07,837 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 21:57:07,838 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 21:57:07,840 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 21:57:07,842 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 21:57:08,798 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 21:57:08,800 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 21:57:08,812 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 21:57:08,815 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 21:57:08,817 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 21:57:08,819 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 21:57:08,820 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 21:57:08,821 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 21:57:08,823 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 21:57:08,824 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 21:57:08,825 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 21:57:08,827 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 21:57:08,829 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 21:57:08,830 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 21:57:08,831 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 21:57:08,837 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 21:57:08,838 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 21:57:08,839 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 21:57:09,170 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 21:57:09,171 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 16:00:00+08:00 - 2023-12-31 16:00:00+08:00
2025-03-08 21:57:09,172 - trading_system - INFO - 将请求分为2个块
2025-03-08 22:45:14,860 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 22:45:14,922 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 22:45:14,923 - trading_system - INFO - Trading system initializing...
2025-03-08 22:45:14,934 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 22:45:14,936 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 22:45:14,937 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 22:45:14,938 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 22:45:14,940 - trading_system - INFO - Starting trading pipeline...
2025-03-08 22:45:14,940 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:45:14,941 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 22:45:14,943 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 22:45:14,943 - trading_system - INFO - 创建了local数据源
2025-03-08 22:45:14,950 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 22:45:14,951 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 22:45:14,953 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 22:45:14,953 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 22:45:14,957 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 22:45:15,897 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:45:15,900 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:45:15,914 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 22:45:15,923 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:45:15,928 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:45:15,931 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 22:45:15,934 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 22:45:15,936 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 22:45:15,938 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 22:45:15,939 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 22:45:15,941 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 22:45:15,943 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 22:45:15,945 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 22:45:15,946 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:45:15,947 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 22:45:15,952 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 22:45:15,953 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 22:45:15,955 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 22:45:15,956 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 22:45:15,959 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:45:15,960 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 22:45:15,961 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:45:15,961 - system.execution - INFO - Execution engine closed
2025-03-08 22:45:15,963 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:45:15,964 - trading_system - INFO - Initiating system shutdown...
2025-03-08 22:45:15,965 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:45:15,966 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 22:45:15,967 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:45:15,967 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:45:15,968 - AsyncExecutor - INFO - Task task_2428794818688_0 cancelled
2025-03-08 22:45:15,971 - trading_system - INFO - Shutting down trading system...
2025-03-08 22:45:15,972 - AsyncExecutor - INFO - Task task_2428794818688_0 was cancelled
2025-03-08 22:45:38,752 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 22:45:38,792 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 22:45:38,793 - trading_system - INFO - Trading system initializing...
2025-03-08 22:45:38,798 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 22:45:38,799 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 22:45:38,800 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 22:45:38,802 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 22:45:38,803 - trading_system - INFO - Starting trading pipeline...
2025-03-08 22:45:38,803 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:45:38,804 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 22:45:38,805 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 22:45:38,806 - trading_system - INFO - 创建了local数据源
2025-03-08 22:45:38,811 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 22:45:38,812 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 22:45:38,813 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 22:45:38,814 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 22:45:38,816 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 22:45:39,311 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:45:39,313 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:45:39,315 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 22:45:39,318 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:45:39,320 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:45:39,321 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 22:45:39,324 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 22:45:39,325 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 22:45:39,327 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 22:45:39,328 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 22:45:39,330 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 22:45:39,332 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 22:45:39,334 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 22:45:39,336 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:45:39,337 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 22:45:39,351 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 22:45:39,352 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 22:45:39,354 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 22:45:39,355 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 22:45:39,358 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:45:39,359 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 22:45:39,360 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:45:39,361 - system.execution - INFO - Execution engine closed
2025-03-08 22:45:39,362 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:45:39,363 - trading_system - INFO - Initiating system shutdown...
2025-03-08 22:45:39,364 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:45:39,365 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 22:45:39,366 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:45:39,367 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:45:39,369 - AsyncExecutor - INFO - Task task_2267449839904_0 cancelled
2025-03-08 22:45:39,373 - trading_system - INFO - Shutting down trading system...
2025-03-08 22:45:39,374 - AsyncExecutor - INFO - Task task_2267449839904_0 was cancelled
2025-03-08 22:45:57,054 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 22:45:57,092 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 22:45:57,093 - trading_system - INFO - Trading system initializing...
2025-03-08 22:45:57,098 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 22:45:57,099 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 22:45:57,101 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 22:45:57,102 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 22:45:57,102 - trading_system - INFO - Starting trading pipeline...
2025-03-08 22:45:57,103 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:45:57,104 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 22:45:57,106 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 22:45:57,107 - trading_system - INFO - 创建了local数据源
2025-03-08 22:45:57,111 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 22:45:57,113 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 22:45:57,114 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 22:45:57,115 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 22:45:57,118 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 22:45:57,620 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:45:57,623 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:45:57,625 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 22:45:57,629 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:45:57,629 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:45:57,631 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 22:45:57,632 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 22:45:57,633 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 22:45:57,635 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 22:45:57,636 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 22:45:57,637 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 22:45:57,640 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 22:45:57,641 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 22:45:57,641 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:45:57,643 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 22:45:57,646 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 22:45:57,648 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 22:45:57,649 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 22:45:57,650 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 22:45:57,652 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:45:57,653 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 22:45:57,654 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:45:57,655 - system.execution - INFO - Execution engine closed
2025-03-08 22:45:57,656 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:45:57,657 - trading_system - INFO - Initiating system shutdown...
2025-03-08 22:45:57,658 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:45:57,659 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 22:45:57,659 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:45:57,661 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:45:57,662 - AsyncExecutor - INFO - Task task_2502751801312_0 cancelled
2025-03-08 22:45:57,665 - trading_system - INFO - Shutting down trading system...
2025-03-08 22:45:57,666 - AsyncExecutor - INFO - Task task_2502751801312_0 was cancelled
2025-03-08 22:46:16,482 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 22:46:16,522 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 22:46:16,523 - trading_system - INFO - Trading system initializing...
2025-03-08 22:46:16,528 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 22:46:16,529 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 22:46:16,530 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 22:46:16,531 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 22:46:16,532 - trading_system - INFO - Starting trading pipeline...
2025-03-08 22:46:16,533 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:46:16,535 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 22:46:16,536 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 22:46:16,537 - trading_system - INFO - 创建了local数据源
2025-03-08 22:46:16,541 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 22:46:16,543 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 22:46:16,544 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 22:46:16,546 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 22:46:16,548 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 22:46:17,113 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:46:17,115 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:46:17,118 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 22:46:17,122 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:46:17,123 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:46:17,125 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 22:46:17,126 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 22:46:17,127 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 22:46:17,128 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 22:46:17,129 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 22:46:17,131 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 22:46:17,133 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 22:46:17,134 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 22:46:17,135 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:46:17,136 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 22:46:17,140 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 22:46:17,141 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 22:46:17,143 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 22:46:17,144 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 22:46:17,146 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:46:17,146 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 22:46:17,147 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:46:17,148 - system.execution - INFO - Execution engine closed
2025-03-08 22:46:17,149 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:46:17,149 - trading_system - INFO - Initiating system shutdown...
2025-03-08 22:46:17,150 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:46:17,151 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 22:46:17,151 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:46:17,152 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:46:17,153 - AsyncExecutor - INFO - Task task_2265024155936_0 cancelled
2025-03-08 22:46:17,156 - trading_system - INFO - Shutting down trading system...
2025-03-08 22:46:17,157 - AsyncExecutor - INFO - Task task_2265024155936_0 was cancelled
2025-03-08 22:47:09,802 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 22:47:09,841 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 22:47:09,842 - trading_system - INFO - Trading system initializing...
2025-03-08 22:47:09,847 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 22:47:09,849 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 22:47:09,849 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 22:47:09,849 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 22:47:09,851 - trading_system - INFO - Starting trading pipeline...
2025-03-08 22:47:09,852 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:47:09,853 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 22:47:09,854 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 22:47:09,855 - trading_system - INFO - 创建了local数据源
2025-03-08 22:47:09,859 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 22:47:09,860 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 22:47:09,861 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 22:47:09,862 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 22:47:09,865 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 22:47:10,383 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:47:10,386 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:47:10,388 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 22:47:10,392 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 22:47:10,393 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 22:47:10,394 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 22:47:10,395 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 22:47:10,396 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 22:47:10,397 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 22:47:10,398 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 22:47:10,399 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 22:47:10,401 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 22:47:10,402 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 22:47:10,403 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 22:47:10,404 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 22:47:10,407 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 22:47:10,408 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 22:47:10,409 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 22:47:10,412 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 22:47:10,415 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:47:10,416 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 22:47:10,417 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:47:10,418 - system.execution - INFO - Execution engine closed
2025-03-08 22:47:10,419 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:47:10,420 - trading_system - INFO - Initiating system shutdown...
2025-03-08 22:47:10,421 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 22:47:10,421 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 22:47:10,422 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 22:47:10,423 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 22:47:10,424 - AsyncExecutor - INFO - Task task_2649963991168_0 cancelled
2025-03-08 22:47:10,427 - trading_system - INFO - Shutting down trading system...
2025-03-08 22:47:10,428 - AsyncExecutor - INFO - Task task_2649963991168_0 was cancelled
2025-03-08 23:05:46,595 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:05:46,635 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:05:46,636 - trading_system - INFO - Trading system initializing...
2025-03-08 23:05:46,643 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:05:46,645 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:05:46,646 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:05:46,647 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:05:46,647 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:05:46,649 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:05:46,649 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:05:46,652 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:05:46,653 - trading_system - INFO - 创建了local数据源
2025-03-08 23:05:46,658 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:05:46,659 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:05:46,661 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:05:46,662 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:05:46,665 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:05:47,213 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:05:47,216 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:05:47,218 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:05:47,222 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:05:47,224 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:05:47,226 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:05:47,227 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:05:47,228 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:05:47,229 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:05:47,230 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:05:47,231 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:05:47,233 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:05:47,234 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:05:47,235 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:05:47,237 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:05:47,239 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:05:47,241 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:05:47,243 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:05:47,244 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:05:47,246 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:05:47,247 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:05:47,248 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:05:47,248 - system.execution - INFO - Execution engine closed
2025-03-08 23:05:47,249 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:05:47,249 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:05:47,251 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:05:47,252 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:05:47,253 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:05:47,254 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:05:47,255 - AsyncExecutor - INFO - Task task_1881868259616_0 cancelled
2025-03-08 23:05:47,258 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:05:47,259 - AsyncExecutor - INFO - Task task_1881868259616_0 was cancelled
2025-03-08 23:06:51,162 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:06:51,211 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:06:51,212 - trading_system - INFO - Trading system initializing...
2025-03-08 23:06:51,219 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:06:51,222 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:06:51,224 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:06:51,225 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:06:51,226 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:06:51,227 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:06:51,228 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:06:51,230 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:06:51,231 - trading_system - INFO - 创建了local数据源
2025-03-08 23:06:51,235 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:06:51,236 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:06:51,238 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:06:51,240 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:06:51,242 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:06:51,897 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:06:51,899 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:06:51,901 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:06:51,905 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:06:51,907 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:06:51,909 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:06:51,910 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:06:51,912 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:06:51,913 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:06:51,915 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:06:51,916 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:06:51,918 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:06:51,919 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:06:51,920 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:06:51,921 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:06:51,924 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:06:51,925 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:06:51,927 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:06:51,928 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:06:51,930 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:06:51,933 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:06:51,934 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:06:51,935 - system.execution - INFO - Execution engine closed
2025-03-08 23:06:51,936 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:06:51,937 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:06:51,937 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:06:51,938 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:06:51,938 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:06:51,939 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:06:51,940 - AsyncExecutor - INFO - Task task_2005303136544_0 cancelled
2025-03-08 23:06:51,943 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:06:51,944 - AsyncExecutor - INFO - Task task_2005303136544_0 was cancelled
2025-03-08 23:07:52,595 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:07:52,632 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:07:52,633 - trading_system - INFO - Trading system initializing...
2025-03-08 23:07:52,638 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:07:52,639 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:07:52,640 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:07:52,641 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:07:52,643 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:07:52,644 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:07:52,646 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:07:52,647 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:07:52,648 - trading_system - INFO - 创建了local数据源
2025-03-08 23:07:52,652 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:07:52,654 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:07:52,655 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:07:52,656 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:07:52,659 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:07:53,189 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:07:53,191 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:07:53,193 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:07:53,197 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:07:53,199 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:07:53,202 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:07:53,204 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:07:53,206 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:07:53,207 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:07:53,209 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:07:53,210 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:07:53,212 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:07:53,213 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:07:53,214 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:07:53,215 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:07:53,219 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:07:53,220 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:07:53,224 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:07:53,226 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:07:53,228 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:07:53,230 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:07:53,231 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:07:53,231 - system.execution - INFO - Execution engine closed
2025-03-08 23:07:53,232 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:07:53,233 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:07:53,235 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:07:53,236 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:07:53,237 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:07:53,238 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:07:53,240 - AsyncExecutor - INFO - Task task_3051283386656_0 cancelled
2025-03-08 23:07:53,243 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:07:53,244 - AsyncExecutor - INFO - Task task_3051283386656_0 was cancelled
2025-03-08 23:07:59,492 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:07:59,546 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:07:59,547 - trading_system - INFO - Trading system initializing...
2025-03-08 23:07:59,554 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:07:59,556 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:07:59,558 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:07:59,559 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:07:59,560 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:07:59,561 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:07:59,562 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:07:59,564 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:07:59,565 - trading_system - INFO - 创建了local数据源
2025-03-08 23:07:59,570 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:07:59,571 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:07:59,573 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:07:59,574 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:07:59,577 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:08:00,208 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:08:00,211 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:08:00,212 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:08:00,217 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:08:00,219 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:08:00,221 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:08:00,222 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:08:00,223 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:08:00,225 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:08:00,226 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:08:00,227 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:08:00,229 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:08:00,230 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:08:00,231 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:08:00,232 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:08:00,234 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:08:00,236 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:08:00,239 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:08:00,240 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:08:00,242 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:08:00,244 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:08:00,245 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:08:00,246 - system.execution - INFO - Execution engine closed
2025-03-08 23:08:00,247 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:08:00,248 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:08:00,249 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:08:00,250 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:08:00,251 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:08:00,252 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:08:00,253 - AsyncExecutor - INFO - Task task_2753070273120_0 cancelled
2025-03-08 23:08:00,255 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:08:00,257 - AsyncExecutor - INFO - Task task_2753070273120_0 was cancelled
2025-03-08 23:18:30,445 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:18:30,489 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:18:30,490 - trading_system - INFO - Trading system initializing...
2025-03-08 23:18:30,503 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:18:30,506 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:18:30,508 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:18:30,510 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:18:30,511 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:18:30,512 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:18:30,514 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:18:30,516 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:18:30,518 - trading_system - INFO - 创建了local数据源
2025-03-08 23:18:30,543 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:18:30,566 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:18:46,920 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:18:46,923 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:18:46,924 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:18:46,927 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:18:46,927 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:18:46,932 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:18:46,935 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:18:47,488 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:18:47,491 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:18:47,494 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:18:47,499 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:18:47,501 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:18:47,502 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:18:47,504 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:18:47,505 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:18:47,507 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:18:47,508 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:18:47,517 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:18:47,519 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:18:47,520 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:18:47,521 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:18:47,522 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:18:47,525 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:18:47,526 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:18:58,706 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:19:01,805 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:19:01,807 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:19:01,807 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:19:01,809 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:19:01,810 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:19:01,812 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:19:01,814 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:19:01,818 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:19:01,819 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:19:01,819 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:19:01,820 - system.execution - INFO - Execution engine closed
2025-03-08 23:19:01,821 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:19:01,822 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:19:01,823 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:19:01,824 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:19:01,824 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:19:01,826 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:19:01,827 - AsyncExecutor - INFO - Task task_2629769020096_0 cancelled
2025-03-08 23:19:01,831 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:19:01,832 - AsyncExecutor - INFO - Task task_2629769020096_0 was cancelled
2025-03-08 23:19:08,128 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:19:08,166 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:19:08,167 - trading_system - INFO - Trading system initializing...
2025-03-08 23:19:08,174 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:19:08,175 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:19:08,176 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:19:08,177 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:19:08,177 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:19:08,178 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:19:08,179 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:19:08,181 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:19:08,182 - trading_system - INFO - 创建了local数据源
2025-03-08 23:19:08,206 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:19:08,229 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:19:08,230 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:19:08,231 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:19:08,232 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:19:08,233 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:19:08,234 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:19:08,235 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:19:08,237 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:19:08,764 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:19:08,766 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:19:08,768 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:19:08,771 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:19:08,772 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:19:08,773 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:19:08,774 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:19:08,775 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:19:08,777 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:19:08,778 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:19:08,779 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:19:08,781 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:19:08,782 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:19:08,783 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:19:08,784 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:19:08,787 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:19:08,788 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:26:31,407 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:26:31,446 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:26:31,447 - trading_system - INFO - Trading system initializing...
2025-03-08 23:26:31,455 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:26:31,457 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:26:31,458 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:26:31,459 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:26:31,460 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:26:31,461 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:26:31,462 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:26:31,463 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:26:31,464 - trading_system - INFO - 创建了local数据源
2025-03-08 23:26:31,490 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:26:31,514 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:26:31,515 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:26:31,516 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:26:31,517 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:26:31,517 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:26:31,518 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:26:31,519 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:26:31,522 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:26:32,052 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:26:32,055 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:26:32,056 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:26:32,060 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:26:32,062 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:26:32,063 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:26:32,065 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:26:32,066 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:26:32,067 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:26:32,068 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:26:32,069 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:26:32,071 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:26:32,073 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:26:32,074 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:26:32,075 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:26:32,078 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:26:32,081 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:27:27,755 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:27:27,794 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:27:27,794 - trading_system - INFO - Trading system initializing...
2025-03-08 23:27:27,801 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:27:27,802 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:27:27,803 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:27:27,805 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:27:27,806 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:27:27,807 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:27:27,808 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:27:27,809 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:27:27,810 - trading_system - INFO - 创建了local数据源
2025-03-08 23:27:27,837 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:27:27,860 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:27:27,863 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:27:27,864 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:27:27,864 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:27:27,866 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:27:27,867 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:27:27,867 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:27:27,869 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:27:28,462 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:27:28,464 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:27:28,467 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:27:28,471 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:27:28,473 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:27:28,475 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:27:28,476 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:27:28,477 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:27:28,477 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:27:28,479 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:27:28,481 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:27:28,484 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:27:28,485 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:27:28,486 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:27:28,487 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:27:28,491 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:27:28,492 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:27:39,931 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:27:39,976 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:27:39,977 - trading_system - INFO - Trading system initializing...
2025-03-08 23:27:39,986 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:27:39,988 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:27:39,989 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:27:39,990 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:27:39,991 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:27:39,993 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:27:39,994 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:27:39,995 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:27:39,996 - trading_system - INFO - 创建了local数据源
2025-03-08 23:27:40,023 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:27:40,050 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:27:40,051 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:27:40,052 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:27:40,053 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:27:40,055 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:27:40,056 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:27:40,057 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:27:40,059 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:27:40,570 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:27:40,573 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:27:40,576 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:27:40,581 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:27:40,583 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:27:40,585 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:27:40,586 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:27:40,587 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:27:40,588 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:27:40,589 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:27:40,591 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:27:40,592 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:27:40,595 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:27:40,596 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:27:40,597 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:27:40,599 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:27:40,601 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:27:54,412 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:27:54,448 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:27:54,451 - trading_system - INFO - Trading system initializing...
2025-03-08 23:27:54,458 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:27:54,460 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:27:54,460 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:27:54,461 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:27:54,462 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:27:54,462 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:27:54,463 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:27:54,465 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:27:54,465 - trading_system - INFO - 创建了local数据源
2025-03-08 23:27:54,487 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:27:54,508 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:27:54,510 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:27:54,511 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:27:54,512 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:27:54,512 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:27:54,513 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:27:54,515 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:27:54,517 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:27:55,040 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:27:55,044 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:27:55,047 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:27:55,052 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:27:55,054 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:27:55,056 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:27:55,059 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:27:55,060 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:27:55,062 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:27:55,064 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:27:55,067 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:27:55,069 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:27:55,070 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:27:55,071 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:27:55,073 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:27:55,077 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:27:55,078 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:28:19,074 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:28:19,303 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:28:29,107 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:28:29,108 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:28:29,114 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:28:29,115 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:28:29,120 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:28:29,124 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:28:29,128 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:28:29,129 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:28:29,130 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:28:29,131 - system.execution - INFO - Execution engine closed
2025-03-08 23:28:29,132 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:28:29,133 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:28:29,134 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:28:29,134 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:28:29,135 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:28:29,136 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:28:29,136 - AsyncExecutor - INFO - Task task_1478482838208_0 cancelled
2025-03-08 23:28:29,142 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:28:29,143 - AsyncExecutor - INFO - Task task_1478482838208_0 was cancelled
2025-03-08 23:28:34,542 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:28:34,579 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:28:34,580 - trading_system - INFO - Trading system initializing...
2025-03-08 23:28:34,587 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:28:34,587 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:28:34,588 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:28:34,589 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:28:34,590 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:28:34,590 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:28:34,591 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:28:34,593 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:28:34,594 - trading_system - INFO - 创建了local数据源
2025-03-08 23:28:34,617 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:28:34,642 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:28:34,644 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:28:34,645 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:28:34,645 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:28:34,646 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:28:34,647 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:28:34,648 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:28:34,650 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:28:35,164 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:28:35,167 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:28:35,168 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:28:35,171 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:28:35,172 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:28:35,174 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:28:35,176 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:28:35,177 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:28:35,177 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:28:35,178 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:28:35,180 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:28:35,181 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:28:35,182 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:28:35,183 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:28:35,183 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:28:35,186 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:28:35,187 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:28:42,231 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:28:42,445 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:29:03,860 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:29:07,954 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:29:12,162 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:29:12,163 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:29:12,165 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:29:12,169 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:29:12,173 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:29:12,174 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:29:12,175 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:29:12,176 - system.execution - INFO - Execution engine closed
2025-03-08 23:29:12,178 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:29:12,179 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:29:12,180 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:29:12,181 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:29:12,182 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:29:12,183 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:29:12,185 - AsyncExecutor - INFO - Task task_2668852839424_0 cancelled
2025-03-08 23:29:12,191 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:29:12,193 - AsyncExecutor - INFO - Task task_2668852839424_0 was cancelled
2025-03-08 23:29:17,079 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:29:17,119 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:29:17,120 - trading_system - INFO - Trading system initializing...
2025-03-08 23:29:17,128 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:29:17,130 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:29:17,131 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:29:17,132 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:29:17,133 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:29:17,134 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:29:17,135 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:29:17,136 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:29:17,137 - trading_system - INFO - 创建了local数据源
2025-03-08 23:29:17,161 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:29:17,185 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:29:17,186 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:29:17,187 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:29:17,187 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:29:17,188 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:29:17,189 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:29:17,190 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:29:17,192 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:29:17,726 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:29:17,728 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:29:17,730 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:29:17,734 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:29:17,735 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:29:17,736 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:29:17,737 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:29:17,738 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:29:17,739 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:29:17,740 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:29:17,742 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:29:17,744 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:29:17,745 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:29:17,746 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:29:17,747 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:29:17,750 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:29:17,751 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:29:17,751 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:29:17,917 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:29:30,125 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:29:30,126 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:29:30,133 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:29:30,134 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:29:30,137 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:29:30,142 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:29:30,146 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:29:30,147 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:29:30,148 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:29:30,149 - system.execution - INFO - Execution engine closed
2025-03-08 23:29:30,150 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:29:30,152 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:29:30,153 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:29:30,154 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:29:30,155 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:29:30,155 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:29:30,156 - AsyncExecutor - INFO - Task task_1764223664832_0 cancelled
2025-03-08 23:29:30,162 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:29:30,164 - AsyncExecutor - INFO - Task task_1764223664832_0 was cancelled
2025-03-08 23:29:35,437 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:29:35,472 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:29:35,473 - trading_system - INFO - Trading system initializing...
2025-03-08 23:29:35,479 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:29:35,480 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:29:35,481 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:29:35,482 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:29:35,482 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:29:35,483 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:29:35,484 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:29:35,485 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:29:35,485 - trading_system - INFO - 创建了local数据源
2025-03-08 23:29:35,508 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:29:35,529 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:29:35,531 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:29:35,532 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:29:35,533 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:29:35,534 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:29:35,534 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:29:35,535 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:29:35,537 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:29:36,035 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:29:36,037 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:29:36,039 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:29:36,043 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:29:36,045 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:29:36,046 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:29:36,047 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:29:36,047 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:29:36,048 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:29:36,048 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:29:36,049 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:29:36,051 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:29:36,052 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:29:36,053 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:29:36,053 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:29:36,055 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:29:36,056 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:29:36,057 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:29:36,243 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:29:54,501 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:29:54,502 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:29:54,508 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:29:54,509 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:29:54,512 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:29:54,518 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:29:54,525 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:29:54,527 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:29:54,528 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:29:54,528 - system.execution - INFO - Execution engine closed
2025-03-08 23:29:54,530 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:29:54,531 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:29:54,532 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:29:54,533 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:29:54,534 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:29:54,535 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:29:54,536 - AsyncExecutor - INFO - Task task_2425040978624_0 cancelled
2025-03-08 23:29:54,541 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:29:54,542 - AsyncExecutor - INFO - Task task_2425040978624_0 was cancelled
2025-03-08 23:29:59,871 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:29:59,906 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:29:59,907 - trading_system - INFO - Trading system initializing...
2025-03-08 23:29:59,913 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:29:59,914 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:29:59,915 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:29:59,916 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:29:59,916 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:29:59,917 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:29:59,919 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:29:59,920 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:29:59,921 - trading_system - INFO - 创建了local数据源
2025-03-08 23:29:59,941 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:29:59,961 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:29:59,962 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:29:59,963 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:29:59,964 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:29:59,964 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:29:59,965 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:29:59,966 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:29:59,967 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:30:00,463 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:30:00,466 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:30:00,467 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:30:00,470 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:30:00,472 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:30:00,473 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:30:00,474 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:30:00,475 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:30:00,475 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:30:00,477 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:30:00,478 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:30:00,479 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:30:00,481 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:30:00,482 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:30:00,482 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:30:00,485 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:30:00,486 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:30:00,487 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:30:00,639 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:30:15,052 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:30:15,109 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:30:15,110 - trading_system - INFO - Trading system initializing...
2025-03-08 23:30:15,119 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:30:15,121 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:30:15,122 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:30:15,123 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:30:15,123 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:30:15,124 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:30:15,125 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:30:15,126 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:30:15,127 - trading_system - INFO - 创建了local数据源
2025-03-08 23:30:15,151 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:30:15,178 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:30:15,179 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:30:15,180 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:30:15,181 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:30:15,182 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:30:15,184 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:30:15,186 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:30:15,189 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:30:15,804 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:30:15,809 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:30:15,811 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:30:15,815 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:30:15,816 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:30:15,818 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:30:15,819 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:30:15,820 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:30:15,821 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:30:15,822 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:30:15,823 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:30:15,825 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:30:15,827 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:30:15,827 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:30:15,828 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:30:15,832 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:30:15,833 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:30:15,834 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:30:15,974 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:30:19,600 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:30:19,601 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:30:19,605 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:30:19,605 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:30:19,607 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:30:19,607 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:30:19,610 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:30:19,611 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:30:19,611 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:30:19,613 - system.execution - INFO - Execution engine closed
2025-03-08 23:30:19,614 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:30:19,615 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:30:19,616 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:30:19,617 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:30:19,617 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:30:19,619 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:30:19,620 - AsyncExecutor - INFO - Task task_2061580092096_0 cancelled
2025-03-08 23:30:19,623 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:30:19,624 - AsyncExecutor - INFO - Task task_2061580092096_0 was cancelled
2025-03-08 23:30:28,575 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:30:28,611 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:30:28,612 - trading_system - INFO - Trading system initializing...
2025-03-08 23:30:28,619 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:30:28,620 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:30:28,621 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:30:28,622 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:30:28,622 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:30:28,623 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:30:28,624 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:30:28,625 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:30:28,626 - trading_system - INFO - 创建了local数据源
2025-03-08 23:30:28,648 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:30:28,669 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:30:28,670 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:30:28,671 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:30:28,672 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:30:28,673 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:30:28,674 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:30:28,675 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:30:28,677 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:30:29,166 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:30:29,168 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:30:29,170 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:30:29,174 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:30:29,175 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:30:29,177 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:30:29,179 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:30:29,179 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:30:29,180 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:30:29,181 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:30:29,182 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:30:29,183 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:30:29,184 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:30:29,185 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:30:29,185 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:30:29,188 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:30:29,189 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:30:29,190 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:30:29,332 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:30:51,487 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-08 23:30:51,488 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-08 23:30:51,496 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-08 23:30:51,497 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:30:51,500 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:30:51,503 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:30:51,508 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:30:51,511 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:30:51,512 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:30:51,512 - system.execution - INFO - Execution engine closed
2025-03-08 23:30:51,513 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:30:51,515 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:30:51,516 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:30:51,517 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:30:51,518 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:30:51,519 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:30:51,520 - AsyncExecutor - INFO - Task task_2267100332736_0 cancelled
2025-03-08 23:30:51,525 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:30:51,526 - AsyncExecutor - INFO - Task task_2267100332736_0 was cancelled
2025-03-08 23:35:17,127 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:35:17,162 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:35:17,163 - trading_system - INFO - Trading system initializing...
2025-03-08 23:35:17,168 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:35:17,170 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:35:17,171 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:35:17,171 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:35:17,172 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:35:17,173 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:35:17,174 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:35:17,175 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:35:17,176 - trading_system - INFO - 创建了local数据源
2025-03-08 23:35:17,179 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:35:17,180 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:35:17,181 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:35:17,182 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:35:17,184 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:35:17,705 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:35:17,707 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:35:17,710 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:35:17,714 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:35:17,716 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:35:17,718 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:35:17,720 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:35:17,721 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:35:17,723 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:35:17,724 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:35:17,727 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:35:17,728 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:35:17,729 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:35:17,731 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:35:17,731 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:35:17,734 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:35:17,736 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:35:17,738 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:35:17,739 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:35:17,742 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:35:17,744 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:35:17,744 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:35:17,745 - system.execution - INFO - Execution engine closed
2025-03-08 23:35:17,746 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:35:17,747 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:35:17,748 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:35:17,749 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:35:17,750 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:35:17,751 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:35:17,752 - AsyncExecutor - INFO - Task task_1937769992000_0 cancelled
2025-03-08 23:35:17,756 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:35:17,757 - AsyncExecutor - INFO - Task task_1937769992000_0 was cancelled
2025-03-08 23:35:27,455 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:35:27,488 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:35:27,489 - trading_system - INFO - Trading system initializing...
2025-03-08 23:35:27,495 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:35:27,496 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:35:27,497 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:35:27,497 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:35:27,498 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:35:27,498 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:35:27,498 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:35:27,500 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:35:27,501 - trading_system - INFO - 创建了local数据源
2025-03-08 23:35:27,504 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:35:27,505 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:35:27,507 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:35:27,507 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:35:27,509 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:35:28,081 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:35:28,084 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:35:28,086 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:35:28,090 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:35:28,092 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:35:28,093 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:35:28,094 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:35:28,095 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:35:28,096 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:35:28,097 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:35:28,100 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:35:28,101 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:35:28,103 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:35:28,104 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:35:28,105 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:35:28,108 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:35:28,109 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:35:28,110 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:35:28,111 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:35:28,114 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:35:28,115 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:35:28,115 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:35:28,116 - system.execution - INFO - Execution engine closed
2025-03-08 23:35:28,117 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:35:28,118 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:35:28,118 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:35:28,119 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:35:28,119 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:35:28,120 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:35:28,121 - AsyncExecutor - INFO - Task task_1951262495008_0 cancelled
2025-03-08 23:35:28,123 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:35:28,124 - AsyncExecutor - INFO - Task task_1951262495008_0 was cancelled
2025-03-08 23:35:37,583 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:35:37,621 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:35:37,622 - trading_system - INFO - Trading system initializing...
2025-03-08 23:35:37,627 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:35:37,628 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:35:37,629 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:35:37,630 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:35:37,631 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:35:37,631 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:35:37,632 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:35:37,634 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:35:37,634 - trading_system - INFO - 创建了local数据源
2025-03-08 23:35:37,638 - trading_system - ERROR - 创建exchange数据源失败: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 478, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 310, in __init__
    self.exchange = Binance(config=config)
                    ^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 22, in __init__
    self.local_database = os.path.join(self.base_dir, config.get('data', 'path')) if self.config else None
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\ntpath.py", line 147, in join
    genericpath._check_arg_types('join', path, *paths)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\genericpath.py", line 152, in _check_arg_types
    raise TypeError(f'{funcname}() argument must be str, bytes, or '
TypeError: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'

2025-03-08 23:35:37,639 - trading_system - WARNING - 无法创建备用交易所数据源: join() argument must be str, bytes, or os.PathLike object, not 'NoneType'
2025-03-08 23:35:37,640 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:35:37,641 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:35:37,643 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:35:38,194 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:35:38,198 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:35:38,200 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:35:38,204 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:35:38,206 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:35:38,207 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:35:38,208 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:35:38,209 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:35:38,210 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:35:38,211 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:35:38,212 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:35:38,214 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:35:38,215 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:35:38,216 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:35:38,217 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:35:38,221 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:35:38,222 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-08 23:35:38,224 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-08 23:35:38,225 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-08 23:35:38,227 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:35:38,228 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-08 23:35:38,228 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:35:38,229 - system.execution - INFO - Execution engine closed
2025-03-08 23:35:38,230 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:35:38,230 - trading_system - INFO - Initiating system shutdown...
2025-03-08 23:35:38,231 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-08 23:35:38,232 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-08 23:35:38,233 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-08 23:35:38,233 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-08 23:35:38,234 - AsyncExecutor - INFO - Task task_1733748314240_0 cancelled
2025-03-08 23:35:38,236 - trading_system - INFO - Shutting down trading system...
2025-03-08 23:35:38,237 - AsyncExecutor - INFO - Task task_1733748314240_0 was cancelled
2025-03-08 23:36:17,692 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:36:17,761 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:36:17,762 - trading_system - INFO - Trading system initializing...
2025-03-08 23:36:17,769 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:36:17,770 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:36:17,772 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:36:17,772 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:36:17,773 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:36:17,774 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:36:17,775 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:36:17,776 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:36:17,777 - trading_system - INFO - 创建了local数据源
2025-03-08 23:36:17,798 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:36:17,817 - trading_system - INFO - 异步客户端初始化成功
2025-03-08 23:36:17,818 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:36:17,819 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:36:17,820 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:36:17,821 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:36:17,821 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:36:17,823 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:36:17,824 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:36:18,341 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:36:18,344 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:36:18,346 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:36:18,351 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:36:18,352 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:36:18,354 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:36:18,355 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:36:18,356 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:36:18,357 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:36:18,357 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:36:18,359 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:36:18,360 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:36:18,361 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:36:18,362 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:36:18,363 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:36:18,367 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:36:18,367 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:36:34,134 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-08 23:37:06,471 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-08 23:42:34,177 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:42:34,220 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:42:34,221 - trading_system - INFO - Trading system initializing...
2025-03-08 23:42:34,229 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:42:34,230 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:42:34,231 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:42:34,231 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:42:34,232 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:42:34,233 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:42:34,234 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:42:34,236 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:42:34,236 - trading_system - INFO - 创建了local数据源
2025-03-08 23:42:34,256 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:42:34,275 - trading_system - ERROR - 获取IP地址失败: argument of type 'ConfigManager' is not iterable
2025-03-08 23:42:34,276 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: None
2025-03-08 23:42:34,277 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:42:34,278 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:42:34,279 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:42:34,280 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:42:34,280 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:42:34,282 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:42:34,283 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:42:34,761 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:42:34,763 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:42:34,765 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:42:34,768 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:42:34,769 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:42:34,770 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:42:34,772 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:42:34,772 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:42:34,774 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:42:34,775 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:42:34,776 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:42:34,779 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:42:34,780 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:42:34,781 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:42:34,782 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:42:34,785 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:42:34,786 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:44:18,727 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:44:18,771 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:44:18,773 - trading_system - INFO - Trading system initializing...
2025-03-08 23:44:18,780 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:44:18,782 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:44:18,783 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:44:18,784 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:44:18,784 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:44:18,785 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:44:18,786 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:44:18,787 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:44:18,788 - trading_system - INFO - 创建了local数据源
2025-03-08 23:44:18,811 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:44:30,496 - trading_system - ERROR - 获取IP地址失败: argument of type 'ConfigManager' is not iterable
2025-03-08 23:44:39,528 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:44:39,564 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:44:39,564 - trading_system - INFO - Trading system initializing...
2025-03-08 23:44:39,573 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:44:39,574 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:44:39,575 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:44:39,576 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:44:39,577 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:44:39,578 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:44:39,579 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:44:39,580 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:44:39,581 - trading_system - INFO - 创建了local数据源
2025-03-08 23:44:39,605 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:47:03,627 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:47:03,671 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:47:03,671 - trading_system - INFO - Trading system initializing...
2025-03-08 23:47:03,679 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:47:03,680 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:47:03,682 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:47:03,683 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:47:03,684 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:47:03,685 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:03,686 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:47:03,687 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:47:03,688 - trading_system - INFO - 创建了local数据源
2025-03-08 23:47:03,719 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:47:21,335 - trading_system - ERROR - 获取IP地址失败: 'ConfigManager' object is not subscriptable
2025-03-08 23:47:21,337 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: None
2025-03-08 23:47:21,341 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:47:21,344 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:47:21,346 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:47:21,349 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:47:21,350 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:47:21,353 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:47:21,356 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:47:22,013 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:47:22,016 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:47:22,018 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:47:22,021 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:47:22,022 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:47:22,024 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:47:22,025 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:47:22,026 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:47:22,028 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:47:22,029 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:47:22,036 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:47:22,038 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:47:22,039 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:47:22,040 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:22,040 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:47:22,043 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:47:22,044 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:47:28,588 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:47:28,643 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:47:28,645 - trading_system - INFO - Trading system initializing...
2025-03-08 23:47:28,658 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:47:28,660 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:47:28,661 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:47:28,662 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:47:28,663 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:47:28,664 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:28,665 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:47:28,667 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:47:28,668 - trading_system - INFO - 创建了local数据源
2025-03-08 23:47:28,695 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:47:28,723 - trading_system - ERROR - 获取IP地址失败: 'ConfigManager' object is not subscriptable
2025-03-08 23:47:28,724 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: None
2025-03-08 23:47:28,725 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:47:28,726 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:47:28,726 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:47:28,727 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:47:28,728 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:47:28,730 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:47:28,732 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:47:29,348 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:47:29,351 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:47:29,352 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:47:29,355 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:47:29,357 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:47:29,359 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:47:29,360 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:47:29,361 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:47:29,363 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:47:29,364 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:47:29,365 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:47:29,367 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:47:29,368 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:47:29,368 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:29,369 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:47:29,371 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:47:29,372 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:47:37,706 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:47:37,742 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:47:37,742 - trading_system - INFO - Trading system initializing...
2025-03-08 23:47:37,749 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:47:37,750 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:47:37,752 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:47:37,753 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:47:37,754 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:47:37,754 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:37,755 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:47:37,757 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:47:37,758 - trading_system - INFO - 创建了local数据源
2025-03-08 23:47:37,779 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:47:37,815 - trading_system - ERROR - 获取IP地址失败: 'ConfigManager' object is not subscriptable
2025-03-08 23:47:37,818 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: None
2025-03-08 23:47:37,820 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:47:37,821 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:47:37,822 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:47:37,823 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:47:37,824 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:47:37,826 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:47:37,829 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:47:38,344 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:47:38,347 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:47:38,349 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:47:38,353 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:47:38,355 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:47:38,357 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:47:38,358 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:47:38,359 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:47:38,360 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:47:38,361 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:47:38,362 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:47:38,364 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:47:38,365 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:47:38,365 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:38,367 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:47:38,370 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:47:38,371 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-08 23:47:57,248 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:47:57,295 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:47:57,296 - trading_system - INFO - Trading system initializing...
2025-03-08 23:47:57,308 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:47:57,311 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:47:57,312 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:47:57,313 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:47:57,313 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:47:57,314 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:47:57,316 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:47:57,317 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:47:57,318 - trading_system - INFO - 创建了local数据源
2025-03-08 23:47:57,346 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:48:49,052 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-08 23:48:49,087 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-08 23:48:49,088 - trading_system - INFO - Trading system initializing...
2025-03-08 23:48:49,094 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-08 23:48:49,096 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-08 23:48:49,097 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-08 23:48:49,098 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-08 23:48:49,099 - trading_system - INFO - Starting trading pipeline...
2025-03-08 23:48:49,100 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:48:49,101 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-08 23:48:49,102 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-08 23:48:49,104 - trading_system - INFO - 创建了local数据源
2025-03-08 23:48:49,125 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-08 23:49:20,204 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-08 23:49:31,773 - trading_system - INFO - Binance接口初始化完成
2025-03-08 23:49:31,776 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-08 23:49:31,778 - trading_system - INFO - 创建了exchange数据源
2025-03-08 23:49:31,780 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-08 23:49:31,782 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-08 23:49:31,785 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-08 23:49:31,789 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-08 23:49:32,300 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:49:32,303 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:49:32,305 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-08 23:49:32,309 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-08 23:49:32,311 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-08 23:49:32,312 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-08 23:49:32,314 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-08 23:49:32,315 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-08 23:49:32,317 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-08 23:49:32,318 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-08 23:49:32,328 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-08 23:49:32,330 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-08 23:49:32,332 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-08 23:49:32,333 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-08 23:49:32,334 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-08 23:49:32,337 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-08 23:49:32,338 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:07:05,454 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:07:05,498 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:07:05,500 - trading_system - INFO - Trading system initializing...
2025-03-09 00:07:05,510 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:07:05,511 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:07:05,513 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:07:05,514 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:07:05,515 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:07:05,517 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:07:05,519 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:07:05,521 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:07:05,522 - trading_system - INFO - 创建了local数据源
2025-03-09 00:07:05,548 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:07:06,121 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:07:06,123 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:07:06,124 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-09 00:07:06,126 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:07:06,127 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:07:06,129 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:07:06,131 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:07:06,135 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:07:06,774 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:07:06,777 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:07:06,779 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:07:06,783 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:07:06,785 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:07:06,787 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:07:06,788 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:07:06,788 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:07:06,789 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:07:06,790 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:07:06,791 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:07:06,792 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:07:06,795 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:07:06,795 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:07:06,797 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:07:06,798 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:07:06,799 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:07:06,800 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:07:06,975 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:08:01,609 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:08:01,644 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:08:01,645 - trading_system - INFO - Trading system initializing...
2025-03-09 00:08:01,654 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:08:01,655 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:08:01,656 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:08:01,657 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:08:01,658 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:08:01,658 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:08:01,659 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:08:01,661 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:08:01,662 - trading_system - INFO - 创建了local数据源
2025-03-09 00:08:01,686 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:08:02,260 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:08:02,262 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:08:02,264 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-09 00:08:02,265 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:08:02,266 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:08:02,267 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:08:02,268 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:08:02,273 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:08:02,829 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:08:02,831 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:08:02,833 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:08:02,837 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:08:02,838 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:08:02,840 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:08:02,841 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:08:02,842 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:08:02,844 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:08:02,845 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:08:02,847 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:08:02,849 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:08:02,850 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:08:02,852 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:08:02,853 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:08:02,856 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:08:02,857 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:08:02,858 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:08:03,032 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:11:03,904 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-09 00:11:03,906 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-09 00:11:03,973 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 00:11:03,974 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 00:11:03,977 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 00:11:03,982 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 00:11:03,986 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:11:03,987 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 00:11:03,988 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:11:03,989 - system.execution - INFO - Execution engine closed
2025-03-09 00:11:03,989 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:11:03,992 - trading_system - INFO - Initiating system shutdown...
2025-03-09 00:11:03,993 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:11:03,993 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 00:11:03,994 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:11:03,995 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:11:03,997 - AsyncExecutor - INFO - Task task_1339527627936_0 cancelled
2025-03-09 00:11:04,002 - trading_system - INFO - Shutting down trading system...
2025-03-09 00:11:04,004 - AsyncExecutor - INFO - Task task_1339527627936_0 was cancelled
2025-03-09 00:11:23,736 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:11:23,776 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:11:23,777 - trading_system - INFO - Trading system initializing...
2025-03-09 00:11:23,786 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:11:23,787 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:11:23,788 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:11:23,788 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:11:23,789 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:11:23,790 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:11:23,791 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:11:23,792 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:11:23,792 - trading_system - INFO - 创建了local数据源
2025-03-09 00:11:23,812 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:11:24,409 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:11:24,411 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:11:24,413 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-09 00:11:24,414 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:11:24,419 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:11:24,426 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:11:24,428 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:11:24,431 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:11:24,935 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:11:24,938 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:11:24,940 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:11:24,944 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:11:24,945 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:11:24,947 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:11:24,948 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:11:24,948 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:11:24,950 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:11:24,950 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:11:24,952 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:11:24,954 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:11:24,956 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:11:24,957 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:11:24,958 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:11:24,961 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:11:24,962 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:11:24,963 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:11:25,181 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:11:43,821 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-09 00:11:43,823 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-09 00:11:43,829 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 00:11:43,831 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 00:11:43,833 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 00:11:43,837 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 00:11:43,841 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:11:43,843 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 00:11:43,844 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:11:43,845 - system.execution - INFO - Execution engine closed
2025-03-09 00:11:43,845 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:11:43,847 - trading_system - INFO - Initiating system shutdown...
2025-03-09 00:11:43,848 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:11:43,849 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 00:11:43,849 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:11:43,851 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:11:43,852 - AsyncExecutor - INFO - Task task_2141008052768_0 cancelled
2025-03-09 00:11:43,856 - trading_system - INFO - Shutting down trading system...
2025-03-09 00:11:43,857 - AsyncExecutor - INFO - Task task_2141008052768_0 was cancelled
2025-03-09 00:12:11,896 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:12:11,944 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:12:11,945 - trading_system - INFO - Trading system initializing...
2025-03-09 00:12:11,954 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:12:11,955 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:12:11,956 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:12:11,957 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:12:11,957 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:12:11,958 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:12:11,959 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:12:11,960 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:12:11,960 - trading_system - INFO - 创建了local数据源
2025-03-09 00:12:11,985 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:12:12,522 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:12:12,523 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:12:12,524 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-09 00:12:12,525 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:12:12,526 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:12:12,526 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:12:12,527 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:12:12,528 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:12:13,018 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:12:13,020 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:12:13,023 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:12:13,027 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:12:13,028 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:12:13,029 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:12:13,030 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:12:13,031 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:12:13,032 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:12:13,033 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:12:13,034 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:12:13,035 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:12:13,036 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:12:13,037 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:12:13,038 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:12:13,041 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:12:13,042 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:12:13,042 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:12:13,206 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:12:24,495 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-09 00:12:33,094 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:12:33,142 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:12:33,143 - trading_system - INFO - Trading system initializing...
2025-03-09 00:12:33,154 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:12:33,156 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:12:33,157 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:12:33,157 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:12:33,158 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:12:33,159 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:12:33,161 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:12:33,162 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:12:33,163 - trading_system - INFO - 创建了local数据源
2025-03-09 00:12:33,190 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:12:33,817 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:12:33,818 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:12:33,821 - trading_system - INFO - ExchangeSource初始化完成，最大请求频率: 20/分钟
2025-03-09 00:12:33,822 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:12:33,823 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:12:33,824 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:12:33,827 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:12:33,829 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:12:34,415 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:12:34,418 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:12:34,420 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:12:34,424 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:12:34,427 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:12:34,429 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:12:34,431 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:12:34,432 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:12:34,433 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:12:34,434 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:12:34,436 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:12:34,437 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:12:34,438 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:12:34,439 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:12:34,440 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:12:34,443 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:12:34,444 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:12:34,445 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:12:34,681 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:14:57,514 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:14:57,550 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:14:57,551 - trading_system - INFO - Trading system initializing...
2025-03-09 00:14:57,557 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:14:57,558 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:14:57,559 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:14:57,560 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:14:57,561 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:14:57,561 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:14:57,562 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:14:57,563 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:14:57,564 - trading_system - INFO - 创建了local数据源
2025-03-09 00:14:57,586 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:14:58,137 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:14:58,138 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:14:58,140 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 00:14:58,141 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:14:58,143 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:14:58,144 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:14:58,146 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:14:58,149 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:14:58,657 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:14:58,660 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:14:58,662 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:14:58,666 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:14:58,667 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:14:58,668 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:14:58,669 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:14:58,670 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:14:58,671 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:14:58,672 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:14:58,673 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:14:58,675 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:14:58,676 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:14:58,677 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:14:58,677 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:14:58,680 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:14:58,681 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:14:58,682 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:14:58,862 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:15:59,064 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:15:59,098 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:15:59,099 - trading_system - INFO - Trading system initializing...
2025-03-09 00:15:59,106 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:15:59,107 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:15:59,108 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:15:59,109 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:15:59,110 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:15:59,112 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:15:59,112 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:15:59,113 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:15:59,114 - trading_system - INFO - 创建了local数据源
2025-03-09 00:15:59,134 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:15:59,661 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:15:59,663 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:15:59,664 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 00:15:59,665 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:15:59,666 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:15:59,668 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:15:59,670 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:15:59,672 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:16:00,156 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:16:00,159 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:16:00,160 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:16:00,163 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:16:00,165 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:16:00,166 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:16:00,167 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:16:00,168 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:16:00,169 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:16:00,170 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:16:00,171 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:16:00,173 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:16:00,174 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:16:00,175 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:16:00,176 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:16:00,178 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:16:00,179 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:16:00,180 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:16:00,324 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:16:14,657 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-09 00:16:16,744 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-09 00:16:21,711 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 00:16:27,736 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:16:27,773 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:16:27,774 - trading_system - INFO - Trading system initializing...
2025-03-09 00:16:27,781 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:16:27,783 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:16:27,783 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:16:27,784 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:16:27,785 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:16:27,785 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:16:27,786 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:16:27,787 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:16:27,788 - trading_system - INFO - 创建了local数据源
2025-03-09 00:16:27,810 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:16:28,327 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:16:28,328 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:16:28,329 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 00:16:28,329 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:16:28,330 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:16:28,330 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:16:28,331 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:16:28,333 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:16:28,874 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:16:28,877 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:16:28,879 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:16:28,883 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:16:28,884 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:16:28,886 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:16:28,887 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:16:28,888 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:16:28,889 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:16:28,890 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:16:28,892 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:16:28,894 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:16:28,894 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:16:28,895 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:16:28,896 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:16:28,899 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:16:28,899 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:16:28,900 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:16:29,046 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:17:29,424 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:17:29,470 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:17:29,470 - trading_system - INFO - Trading system initializing...
2025-03-09 00:17:29,478 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:17:29,479 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:17:29,480 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:17:29,481 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:17:29,482 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:17:29,483 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:17:29,484 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:17:29,485 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:17:29,486 - trading_system - INFO - 创建了local数据源
2025-03-09 00:17:29,505 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:17:30,077 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:17:30,079 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:17:30,080 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 00:17:30,081 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:17:30,082 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:17:30,083 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:17:30,084 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:17:30,097 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:17:30,574 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:17:30,576 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:17:30,578 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:17:30,583 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:17:30,586 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:17:30,588 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:17:30,589 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:17:30,590 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:17:30,591 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:17:30,592 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:17:30,594 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:17:30,596 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:17:30,597 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:17:30,598 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:17:30,599 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:17:30,602 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:17:30,603 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:17:30,604 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:17:30,752 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:21:49,362 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:21:49,408 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:21:49,409 - trading_system - INFO - Trading system initializing...
2025-03-09 00:21:49,418 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:21:49,420 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:21:49,420 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:21:49,421 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:21:49,422 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:21:49,422 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:21:49,423 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:21:49,424 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:21:49,425 - trading_system - INFO - 创建了local数据源
2025-03-09 00:21:49,447 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:21:50,013 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:21:50,015 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:21:50,017 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 00:21:50,018 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:21:50,020 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:21:50,021 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:21:50,023 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:21:50,027 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:21:50,590 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:21:50,593 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:21:50,596 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:21:50,601 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:21:50,603 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:21:50,605 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:21:50,606 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:21:50,606 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:21:50,607 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:21:50,608 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:21:50,609 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:21:50,610 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:21:50,612 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:21:50,612 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:21:50,613 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:21:50,616 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:21:50,616 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:21:50,617 - trading_system - INFO - 从交易所获取历史数据: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:21:50,765 - trading_system - INFO - 将BTC/USDT 1h的数据获取分为1个部分
2025-03-09 00:22:25,907 - trading_system - ERROR - 获取第1部分数据失败: Binance.fetch_ohlcv() takes from 1 to 4 positional arguments but 5 were given
2025-03-09 00:22:25,912 - trading_system - WARNING - 没有获取到BTC/USDT 1h的数据
2025-03-09 00:22:25,924 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 00:22:25,927 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 00:22:25,932 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 00:22:25,936 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 00:22:25,993 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:22:25,997 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 00:22:26,000 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:22:26,004 - system.execution - INFO - Execution engine closed
2025-03-09 00:22:26,008 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:22:26,012 - trading_system - INFO - Initiating system shutdown...
2025-03-09 00:22:26,016 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:22:26,020 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 00:22:26,023 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:22:26,027 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:22:26,031 - AsyncExecutor - INFO - Task task_2593580499488_0 cancelled
2025-03-09 00:22:26,045 - trading_system - INFO - Shutting down trading system...
2025-03-09 00:22:26,049 - AsyncExecutor - INFO - Task task_2593580499488_0 was cancelled
2025-03-09 00:38:11,973 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 00:38:12,009 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 00:38:12,010 - trading_system - INFO - Trading system initializing...
2025-03-09 00:38:12,021 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 00:38:12,022 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 00:38:12,023 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 00:38:12,024 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 00:38:12,024 - trading_system - INFO - Starting trading pipeline...
2025-03-09 00:38:12,025 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:38:12,026 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 00:38:12,027 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 00:38:12,027 - trading_system - INFO - 创建了local数据源
2025-03-09 00:38:12,049 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 00:38:12,569 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 00:38:12,570 - trading_system - INFO - Binance接口初始化完成
2025-03-09 00:38:12,570 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 00:38:12,570 - trading_system - INFO - 创建了exchange数据源
2025-03-09 00:38:12,570 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 00:38:12,571 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 00:38:12,571 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 00:38:12,574 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 00:38:13,120 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:38:13,123 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:38:13,125 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 00:38:13,130 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 00:38:13,132 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 00:38:13,134 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 00:38:13,135 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 00:38:13,136 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 00:38:13,137 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 00:38:13,137 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 00:38:13,138 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 00:38:13,140 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 00:38:13,140 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 00:38:13,141 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 00:38:13,142 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 00:38:13,145 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 00:38:13,146 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 00:38:13,147 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 00:38:13,335 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 00:38:13,337 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 00:38:13,337 - trading_system - INFO - 将请求分为2个块
2025-03-09 00:38:13,519 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:15,537 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:19,544 - trading_system - ERROR - 第1块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:19,545 - trading_system - ERROR - 获取第1块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:19,547 - trading_system - WARNING - 第2块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:21,557 - trading_system - WARNING - 第2块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:25,586 - trading_system - ERROR - 第2块数据获取失败，已达到最大重试次数: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:25,589 - trading_system - ERROR - 获取第2块数据时出错: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 00:38:25,590 - trading_system - WARNING - 没有获取到任何数据: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 00:38:25,594 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 00:38:25,597 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 00:38:25,599 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 00:38:25,602 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 00:38:25,603 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 00:38:25,610 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:38:25,611 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 00:38:25,612 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:38:25,614 - system.execution - INFO - Execution engine closed
2025-03-09 00:38:25,615 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:38:25,616 - trading_system - INFO - Initiating system shutdown...
2025-03-09 00:38:25,618 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 00:38:25,618 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 00:38:25,619 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 00:38:25,620 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 00:38:25,621 - trading_system - ERROR - Error while closing AsyncExecutor: 'AsyncExecutor' object has no attribute '_active_tasks'
2025-03-09 00:38:25,727 - trading_system - INFO - System shutdown completed
2025-03-09 00:38:25,729 - trading_system - INFO - Shutting down trading system...
2025-03-09 00:38:25,731 - ccxt.base.exchange - WARNING - binance requires to release all resources with an explicit call to the .close() coroutine. If you are using the exchange instance with async coroutines, add `await exchange.close()` to your code into a place when you're done with the exchange and don't need the exchange instance anymore (at the end of your async coroutine).
2025-03-09 00:38:25,733 - asyncio - ERROR - Unclosed client session
client_session: <aiohttp.client.ClientSession object at 0x000002AF05623010>
2025-03-09 01:01:14,678 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:01:14,722 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:01:14,723 - trading_system - INFO - Trading system initializing...
2025-03-09 01:01:14,733 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:01:14,734 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:01:14,735 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:01:14,736 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:01:14,736 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:01:14,737 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:01:14,738 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:01:14,739 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:01:14,740 - trading_system - INFO - 创建了local数据源
2025-03-09 01:01:14,764 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 01:01:15,293 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 01:01:15,293 - trading_system - INFO - Binance接口初始化完成
2025-03-09 01:01:15,294 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:01:15,295 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:01:15,295 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:01:15,296 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:01:15,297 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:01:15,299 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:01:15,946 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:01:15,950 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:01:15,953 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:01:15,958 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:01:15,962 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:01:15,963 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:01:15,965 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:01:15,966 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:01:15,967 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:01:15,968 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:01:15,969 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:01:15,971 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:01:15,972 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:01:15,973 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:01:15,974 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:01:15,977 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:01:15,978 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:01:15,979 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:01:16,234 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:01:16,235 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:01:16,236 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:01:16,420 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:01:18,437 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:27,678 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:29:27,729 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:29:27,731 - trading_system - INFO - Trading system initializing...
2025-03-09 01:29:27,743 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:29:27,745 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:29:27,746 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:29:27,746 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:29:27,747 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:29:27,748 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:29:27,749 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:29:27,750 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:29:27,751 - trading_system - INFO - 创建了local数据源
2025-03-09 01:29:27,776 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 01:29:28,380 - trading_system - INFO - 异步客户端初始化成功, 当前IP地址为: 89.213.179.134
2025-03-09 01:29:28,381 - trading_system - INFO - Binance接口初始化完成
2025-03-09 01:29:28,382 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:29:28,383 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:29:28,384 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:29:28,385 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:29:28,386 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:29:28,390 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:29:28,927 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:29:28,929 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:29:28,931 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:29:28,935 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:29:28,937 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:29:28,938 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:29:28,939 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:29:28,939 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:29:28,940 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:29:28,942 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:29:28,944 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:29:28,945 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:29:28,947 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:29:28,947 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:29:28,948 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:29:28,950 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:29:28,951 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:29:28,951 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:29:29,144 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:29:29,146 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:29:29,147 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:29:29,399 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:31,424 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:35,434 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:35,948 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:37,973 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:41,971 - trading_system - ERROR - Chunk 2/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:41,973 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:29:41,975 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 01:29:41,977 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 01:29:41,979 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 01:29:41,981 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 01:29:41,982 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 01:29:41,987 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:29:41,989 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 01:29:41,990 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:29:41,991 - system.execution - INFO - Execution engine closed
2025-03-09 01:29:41,991 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:29:41,993 - trading_system - INFO - Initiating system shutdown...
2025-03-09 01:29:41,994 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:29:41,994 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 01:29:41,995 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:29:41,995 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:29:41,997 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 01:29:46,939 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:29:46,979 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:29:46,980 - trading_system - INFO - Trading system initializing...
2025-03-09 01:29:46,997 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:29:46,999 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:29:47,001 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:29:47,002 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:29:47,003 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:29:47,005 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:29:47,006 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:29:47,008 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:29:47,008 - trading_system - INFO - 创建了local数据源
2025-03-09 01:29:47,038 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:29:47,624 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:29:47,626 - trading_system - INFO - Binance interface initialized
2025-03-09 01:29:47,628 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:29:47,628 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:29:47,630 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:29:47,632 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:29:47,634 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:29:47,638 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:29:48,117 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:29:48,121 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:29:48,123 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:29:48,128 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:29:48,131 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:29:48,132 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:29:48,133 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:29:48,134 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:29:48,134 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:29:48,136 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:29:48,137 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:29:48,139 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:29:48,140 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:29:48,140 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:29:48,141 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:29:48,144 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:29:48,145 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:29:48,145 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:29:48,291 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:29:48,292 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:29:48,293 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:29:48,469 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:50,499 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:54,493 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:55,010 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:29:57,037 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:30:01,034 - trading_system - ERROR - Chunk 2/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:30:01,038 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:30:01,040 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 01:30:01,043 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 01:30:01,044 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 01:30:01,046 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 01:30:01,048 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 01:30:01,054 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:30:01,056 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 01:30:01,058 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:30:01,060 - system.execution - INFO - Execution engine closed
2025-03-09 01:30:01,061 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:30:01,063 - trading_system - INFO - Initiating system shutdown...
2025-03-09 01:30:01,065 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:30:01,066 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 01:30:01,068 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:30:01,070 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:30:01,073 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 01:38:12,889 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:38:12,930 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:38:12,931 - trading_system - INFO - Trading system initializing...
2025-03-09 01:38:12,941 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:38:12,943 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:38:12,944 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:38:12,945 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:38:12,946 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:38:12,947 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:38:12,948 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:38:12,949 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:38:12,951 - trading_system - INFO - 创建了local数据源
2025-03-09 01:38:12,981 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:38:13,505 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:38:13,507 - trading_system - INFO - Binance interface initialized
2025-03-09 01:38:13,508 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:38:13,510 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:38:13,511 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:38:13,513 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:38:13,516 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:38:13,520 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:38:14,022 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:38:14,025 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:38:14,027 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:38:14,031 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:38:14,033 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:38:14,034 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:38:14,035 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:38:14,036 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:38:14,037 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:38:14,038 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:38:14,039 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:38:14,040 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:38:14,042 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:38:14,042 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:38:14,043 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:38:14,046 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:38:14,046 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:38:14,047 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:38:14,243 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:38:14,244 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:38:14,245 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:38:14,429 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:38:16,446 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:38:20,451 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:38:20,968 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:38:22,993 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:40,917 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:39:40,951 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:39:40,952 - trading_system - INFO - Trading system initializing...
2025-03-09 01:39:40,960 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:39:40,961 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:39:40,962 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:39:40,963 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:39:40,963 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:39:40,964 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:39:40,964 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:39:40,965 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:39:40,965 - trading_system - INFO - 创建了local数据源
2025-03-09 01:39:40,982 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:39:41,571 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:39:41,572 - trading_system - INFO - Binance interface initialized
2025-03-09 01:39:41,573 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:39:41,573 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:39:41,575 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:39:41,576 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:39:41,577 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:39:41,579 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:39:42,040 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:39:42,078 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:39:42,078 - trading_system - INFO - Trading system initializing...
2025-03-09 01:39:42,086 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:39:42,088 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:39:42,089 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:39:42,089 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:39:42,090 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:39:42,091 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:39:42,092 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:39:42,093 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:39:42,094 - trading_system - INFO - 创建了local数据源
2025-03-09 01:39:42,117 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:39:42,157 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:39:42,161 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:39:42,163 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:39:42,169 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:39:42,172 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:39:42,175 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:39:42,177 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:39:42,178 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:39:42,179 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:39:42,179 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:39:42,181 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:39:42,182 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:39:42,182 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:39:42,183 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:39:42,184 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:39:42,186 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:39:42,187 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:39:42,188 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:39:42,349 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:39:42,350 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:39:42,351 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:39:42,537 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:42,646 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:39:42,648 - trading_system - INFO - Binance interface initialized
2025-03-09 01:39:42,650 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:39:42,651 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:39:42,653 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:39:42,654 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:39:42,656 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:39:42,661 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:39:43,173 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:39:43,176 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:39:43,179 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:39:43,183 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:39:43,184 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:39:43,186 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:39:43,187 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:39:43,188 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:39:43,189 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:39:43,191 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:39:43,192 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:39:43,194 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:39:43,195 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:39:43,197 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:39:43,198 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:39:43,201 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:39:43,202 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:39:43,204 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:39:43,373 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:39:43,373 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:39:43,374 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:39:43,604 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:44,566 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:45,641 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:48,588 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:49,101 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:49,650 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:50,169 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:51,104 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:52,194 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:55,135 - trading_system - ERROR - Chunk 2/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:55,138 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:39:55,141 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 01:39:55,143 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 01:39:55,145 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 01:39:55,147 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 01:39:55,148 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 01:39:55,153 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:39:55,154 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 01:39:55,156 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:39:55,157 - system.execution - INFO - Execution engine closed
2025-03-09 01:39:55,158 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:39:55,159 - trading_system - INFO - Initiating system shutdown...
2025-03-09 01:39:55,159 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:39:55,160 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 01:39:55,161 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:39:55,161 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:39:55,164 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 01:39:56,213 - trading_system - ERROR - Chunk 2/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:39:56,215 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:39:56,218 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 01:39:56,221 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 01:39:56,222 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 01:39:56,225 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 01:39:56,226 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 01:39:56,233 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:39:56,235 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 01:39:56,236 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:39:56,237 - system.execution - INFO - Execution engine closed
2025-03-09 01:39:56,239 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:39:56,241 - trading_system - INFO - Initiating system shutdown...
2025-03-09 01:39:56,242 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:39:56,243 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 01:39:56,245 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:39:56,246 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:39:56,248 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 01:41:10,415 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:41:10,455 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:41:10,462 - trading_system - INFO - Trading system initializing...
2025-03-09 01:41:10,473 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:41:10,474 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:41:10,475 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:41:10,476 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:41:10,476 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:41:10,477 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:41:10,478 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:41:10,479 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:41:10,480 - trading_system - INFO - 创建了local数据源
2025-03-09 01:41:10,504 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:41:11,050 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:41:11,052 - trading_system - INFO - Binance interface initialized
2025-03-09 01:41:11,054 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:41:11,055 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:41:11,057 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:41:11,059 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:41:11,061 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:41:11,066 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:41:11,560 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:41:11,563 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:41:11,565 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:41:11,568 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:41:11,570 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:41:11,571 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:41:11,572 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:41:11,573 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:41:11,575 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:41:11,576 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:41:11,577 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:41:11,578 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:41:11,579 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:41:11,580 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:41:11,581 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:41:11,584 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:41:11,585 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:41:11,586 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:41:11,739 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:41:11,741 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:41:11,741 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:41:11,931 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:41:13,949 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:41:56,906 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:41:56,940 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:41:56,942 - trading_system - INFO - Trading system initializing...
2025-03-09 01:41:56,951 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:41:56,952 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:41:56,953 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:41:56,954 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:41:56,954 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:41:56,955 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:41:56,956 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:41:56,957 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:41:56,958 - trading_system - INFO - 创建了local数据源
2025-03-09 01:41:56,978 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:41:57,460 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:41:57,462 - trading_system - INFO - Binance interface initialized
2025-03-09 01:41:57,463 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:41:57,465 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:41:57,466 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:41:57,468 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:41:57,470 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:41:57,476 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:41:57,949 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:41:57,952 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:41:57,954 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:41:57,959 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:41:57,961 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:41:57,962 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:41:57,963 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:41:57,964 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:41:57,965 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:41:57,966 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:41:57,967 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:41:57,969 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:41:57,970 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:41:57,971 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:41:57,971 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:41:57,975 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:41:57,975 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:41:57,976 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:41:58,119 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:41:58,120 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:41:58,120 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:41:58,304 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:00,329 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:04,330 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:04,843 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:06,858 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:10,886 - trading_system - ERROR - Chunk 2/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:10,888 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:42:10,891 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 01:42:10,894 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 01:42:10,896 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 01:42:10,899 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 01:42:10,901 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 01:42:10,908 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:42:10,909 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 01:42:10,911 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:42:10,912 - system.execution - INFO - Execution engine closed
2025-03-09 01:42:10,914 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:42:10,915 - trading_system - INFO - Initiating system shutdown...
2025-03-09 01:42:10,916 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 01:42:10,917 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 01:42:10,918 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 01:42:10,919 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 01:42:10,922 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 01:42:16,196 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:42:16,230 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:42:16,240 - trading_system - INFO - Trading system initializing...
2025-03-09 01:42:16,250 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:42:16,251 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:42:16,252 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:42:16,252 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:42:16,253 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:42:16,254 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:42:16,255 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:42:16,256 - trading_system - INFO - LocalSource初始化完成，数据路径: db/historical/
2025-03-09 01:42:16,257 - trading_system - INFO - 创建了local数据源
2025-03-09 01:42:16,275 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:42:16,820 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:42:16,822 - trading_system - INFO - Binance interface initialized
2025-03-09 01:42:16,823 - trading_system - INFO - ExchangeSource初始化完成, 最大请求频率: 20/分钟
2025-03-09 01:42:16,825 - trading_system - INFO - 创建了exchange数据源
2025-03-09 01:42:16,826 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:42:16,828 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:42:16,830 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:42:16,835 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:42:17,308 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:42:17,311 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:42:17,314 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:42:17,317 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:42:17,319 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:42:17,320 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:42:17,322 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:42:17,322 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:42:17,324 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:42:17,325 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:42:17,327 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:42:17,328 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:42:17,329 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:42:17,330 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:42:17,330 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:42:17,333 - trading_system - WARNING - 本地文件未找到或加载失败: BTC_USDT_1h
2025-03-09 01:42:17,333 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:42:17,334 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:42:17,463 - trading_system - INFO - Divided BTC/USDT 1h data fetch into 1 chunks
2025-03-09 01:42:17,465 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:42:17,466 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:42:17,649 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:42:19,672 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:47:44,121 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:47:44,155 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:47:44,156 - trading_system - INFO - Trading system initializing...
2025-03-09 01:47:44,164 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:47:44,166 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:47:44,167 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:47:44,168 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:47:44,169 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:47:44,170 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:47:44,170 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:47:44,172 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:47:44,172 - trading_system - INFO - Created local data source
2025-03-09 01:47:50,079 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:47:50,592 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:47:50,594 - trading_system - INFO - Binance interface initialized
2025-03-09 01:47:50,596 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:47:50,606 - trading_system - INFO - Created exchange data source
2025-03-09 01:47:50,607 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:47:50,610 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:47:50,613 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:47:50,618 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:47:51,110 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:47:51,114 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:47:51,116 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:47:51,121 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:47:51,122 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:47:51,124 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:47:51,125 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:47:51,126 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:47:51,127 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:47:51,128 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:47:51,129 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:47:51,131 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:47:51,132 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:47:51,133 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:47:51,134 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:47:51,136 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:47:51,137 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:47:51,138 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:47:51,280 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:47:51,281 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:47:51,282 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:47:51,459 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:47:53,482 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:48:59,409 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:48:59,450 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:48:59,452 - trading_system - INFO - Trading system initializing...
2025-03-09 01:48:59,468 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:48:59,471 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:48:59,472 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:48:59,473 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:48:59,473 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:48:59,474 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:48:59,475 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:48:59,476 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:48:59,477 - trading_system - INFO - Created local data source
2025-03-09 01:48:59,499 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:49:00,020 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:49:00,021 - trading_system - INFO - Binance interface initialized
2025-03-09 01:49:00,022 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:49:00,023 - trading_system - INFO - Created exchange data source
2025-03-09 01:49:00,023 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:49:00,025 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:49:00,025 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:49:00,027 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:49:00,495 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:49:00,497 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:49:00,500 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:49:00,504 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:49:00,505 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:49:00,507 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:49:00,509 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:49:00,509 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:49:00,510 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:49:00,511 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:49:00,512 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:49:00,514 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:49:00,515 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:49:00,515 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:49:00,516 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:49:00,518 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:49:00,519 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:49:00,520 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:49:10,483 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:49:49,802 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:50:21,480 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:50:21,748 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:50:23,766 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:50:27,783 - trading_system - ERROR - Chunk 1/2 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:50:28,298 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:50:30,296 - trading_system - WARNING - Chunk 2/2 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:50:34,073 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:50:34,119 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:50:34,121 - trading_system - INFO - Trading system initializing...
2025-03-09 01:50:34,135 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:50:34,137 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:50:34,138 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:50:34,139 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:50:34,141 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:50:34,142 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:50:34,143 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:50:34,145 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:50:34,146 - trading_system - INFO - Created local data source
2025-03-09 01:50:34,168 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:50:34,712 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:50:34,714 - trading_system - INFO - Binance interface initialized
2025-03-09 01:50:34,715 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:50:34,717 - trading_system - INFO - Created exchange data source
2025-03-09 01:50:34,719 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:50:34,720 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:50:34,723 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:50:34,725 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:50:35,264 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:50:35,267 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:50:35,269 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:50:35,273 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:50:35,274 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:50:35,276 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:50:35,277 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:50:35,277 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:50:35,279 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:50:35,279 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:50:35,281 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:50:35,282 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:50:35,283 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:50:35,284 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:50:35,285 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:50:35,288 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:50:35,289 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:50:35,290 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:50:58,505 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:50:58,507 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:51:20,488 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:52:04,934 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:52:15,004 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:52:15,056 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:52:15,056 - trading_system - INFO - Trading system initializing...
2025-03-09 01:52:15,063 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:52:15,064 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:52:15,065 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:52:15,065 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:52:15,067 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:52:15,067 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:52:15,068 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:52:15,069 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:52:15,070 - trading_system - INFO - Created local data source
2025-03-09 01:52:15,091 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:52:15,628 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:52:15,630 - trading_system - INFO - Binance interface initialized
2025-03-09 01:52:15,632 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:52:15,633 - trading_system - INFO - Created exchange data source
2025-03-09 01:52:15,634 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:52:15,636 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:52:15,639 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:52:15,644 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:52:16,119 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:52:16,124 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:52:16,126 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:52:16,131 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:52:16,133 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:52:16,134 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:52:16,136 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:52:16,136 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:52:16,137 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:52:16,138 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:52:16,140 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:52:16,141 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:52:16,143 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:52:16,143 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:52:16,145 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:52:16,148 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:52:16,149 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:52:16,150 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:52:16,288 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:52:16,289 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:52:16,290 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:53:32,676 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:53:32,709 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:53:32,710 - trading_system - INFO - Trading system initializing...
2025-03-09 01:53:32,719 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:53:32,720 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:53:32,721 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:53:32,721 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:53:32,722 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:53:32,723 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:53:32,723 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:53:32,725 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:53:32,726 - trading_system - INFO - Created local data source
2025-03-09 01:53:32,745 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:53:33,275 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:53:33,276 - trading_system - INFO - Binance interface initialized
2025-03-09 01:53:33,278 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:53:33,279 - trading_system - INFO - Created exchange data source
2025-03-09 01:53:33,281 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:53:33,282 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:53:33,285 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:53:33,289 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:53:33,793 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:53:33,796 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:53:33,797 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:53:33,801 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:53:33,802 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:53:33,804 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:53:33,805 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:53:33,805 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:53:33,806 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:53:33,807 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:53:33,808 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:53:33,809 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:53:33,811 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:53:33,811 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:53:33,811 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:53:33,814 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:53:33,815 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:53:33,815 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:53:33,959 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:53:33,960 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:53:33,961 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:54:33,898 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:54:33,932 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:54:33,932 - trading_system - INFO - Trading system initializing...
2025-03-09 01:54:33,941 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:54:33,943 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:54:33,944 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:54:33,945 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:54:33,945 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:54:33,946 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:54:33,947 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:54:33,948 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:54:33,948 - trading_system - INFO - Created local data source
2025-03-09 01:54:33,969 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:54:34,484 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:54:34,486 - trading_system - INFO - Binance interface initialized
2025-03-09 01:54:34,487 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:54:34,488 - trading_system - INFO - Created exchange data source
2025-03-09 01:54:34,489 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:54:34,490 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:54:34,493 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:54:34,497 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:54:34,988 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:54:34,990 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:54:34,993 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:54:34,996 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:54:34,998 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:54:34,999 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:54:35,000 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:54:35,001 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:54:35,003 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:54:35,003 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:54:35,005 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:54:35,006 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:54:35,007 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:54:35,008 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:54:35,009 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:54:35,011 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:54:35,012 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:54:35,012 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:54:35,153 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:54:35,154 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:54:35,155 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:55:09,760 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 01:56:12,825 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 01:56:12,859 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 01:56:12,860 - trading_system - INFO - Trading system initializing...
2025-03-09 01:56:12,869 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 01:56:12,871 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 01:56:12,872 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 01:56:12,872 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 01:56:12,873 - trading_system - INFO - Starting trading pipeline...
2025-03-09 01:56:12,873 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:56:12,875 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 01:56:12,876 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 01:56:12,877 - trading_system - INFO - Created local data source
2025-03-09 01:56:12,899 - trading_system - INFO - Sync client API key validation successful
2025-03-09 01:56:13,415 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 01:56:13,417 - trading_system - INFO - Binance interface initialized
2025-03-09 01:56:13,418 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 01:56:13,420 - trading_system - INFO - Created exchange data source
2025-03-09 01:56:13,421 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 01:56:13,422 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 01:56:13,424 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 01:56:13,429 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 01:56:13,929 - system.strategyfactory - WARNING - 加载模块 src.strategy.rotation 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:56:13,931 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:56:13,933 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 01:56:13,937 - system.strategyfactory - WARNING - 处理文件 rotation.py 时出错: module 'ccxt' has no attribute 'okex'
2025-03-09 01:56:13,938 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 01:56:13,940 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 01:56:13,940 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 01:56:13,941 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 01:56:13,942 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 01:56:13,944 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 01:56:13,945 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 01:56:13,947 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 01:56:13,948 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 01:56:13,948 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 01:56:13,949 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 01:56:13,951 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 01:56:13,952 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 01:56:13,952 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 01:56:14,102 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 01:56:14,103 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 01:56:14,104 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 01:56:37,760 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 02:27:56,366 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 02:27:56,401 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 02:27:56,402 - trading_system - INFO - Trading system initializing...
2025-03-09 02:27:56,411 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 02:27:56,412 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 02:27:56,413 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 02:27:56,414 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 02:27:56,415 - trading_system - INFO - Starting trading pipeline...
2025-03-09 02:27:56,415 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 02:27:56,416 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 02:27:56,417 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 02:27:56,418 - trading_system - INFO - Created local data source
2025-03-09 02:27:56,439 - trading_system - INFO - Sync client API key validation successful
2025-03-09 02:27:57,049 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 02:27:57,050 - trading_system - INFO - Binance interface initialized
2025-03-09 02:27:57,051 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 02:27:57,052 - trading_system - INFO - Created exchange data source
2025-03-09 02:27:57,052 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 02:27:57,053 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 02:27:57,055 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 02:27:57,057 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 02:27:57,572 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 02:27:57,575 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 02:27:57,579 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 02:27:57,580 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 02:27:57,581 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 02:27:57,582 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 02:27:57,583 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 02:27:57,584 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 02:27:57,585 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 02:27:57,586 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 02:27:57,587 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 02:27:57,588 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 02:27:57,588 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 02:27:57,591 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 02:27:57,592 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 02:27:57,593 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 02:27:57,739 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 02:27:57,741 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 02:27:57,741 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 02:28:11,449 - trading_system - WARNING - Chunk 1/2 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 08:57:16,332 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 08:57:16,399 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 08:57:16,400 - trading_system - INFO - Trading system initializing...
2025-03-09 08:57:16,410 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 08:57:16,412 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 08:57:16,413 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 08:57:16,413 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 08:57:16,414 - trading_system - INFO - Starting trading pipeline...
2025-03-09 08:57:16,415 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 08:57:16,416 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 08:57:16,417 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 08:57:16,418 - trading_system - INFO - Created local data source
2025-03-09 08:57:16,440 - trading_system - INFO - Sync client API key validation successful
2025-03-09 08:57:17,049 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 08:57:17,049 - trading_system - INFO - Binance interface initialized
2025-03-09 08:57:17,058 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 08:57:17,060 - trading_system - INFO - Created exchange data source
2025-03-09 08:57:17,061 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 08:57:17,061 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 08:57:17,062 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 08:57:17,064 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 08:57:17,976 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 08:57:17,978 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 08:57:17,984 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 08:57:17,986 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 08:57:17,987 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 08:57:17,988 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 08:57:17,989 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 08:57:17,990 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 08:57:17,991 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 08:57:17,992 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 08:57:17,993 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 08:57:17,994 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 08:57:17,994 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 08:57:17,997 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 08:57:17,998 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 08:57:17,998 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 08:57:18,322 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 08:57:18,323 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 08:57:18,323 - trading_system - INFO - Request divided into 2 chunks
2025-03-09 09:03:00,664 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:03:00,700 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:03:00,701 - trading_system - INFO - Trading system initializing...
2025-03-09 09:03:00,710 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:03:00,710 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:03:00,711 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:03:00,711 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:03:00,711 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:03:00,712 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:03:00,712 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:03:00,713 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:03:00,714 - trading_system - INFO - Created local data source
2025-03-09 09:03:00,732 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:03:01,252 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:03:01,253 - trading_system - INFO - Binance interface initialized
2025-03-09 09:03:01,254 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:03:01,255 - trading_system - INFO - Created exchange data source
2025-03-09 09:03:01,256 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:03:01,258 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:03:01,259 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:03:01,261 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:03:01,757 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:03:01,759 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:03:01,765 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:03:01,766 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:03:01,767 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:03:01,767 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:03:01,768 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:03:01,768 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:03:01,769 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:03:01,771 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:03:01,771 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:03:01,772 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:03:01,773 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:03:01,774 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:03:01,775 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:03:01,776 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:03:01,939 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:03:42,634 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:07:15,970 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:07:16,007 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:07:16,008 - trading_system - INFO - Trading system initializing...
2025-03-09 09:07:16,017 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:07:16,018 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:07:16,019 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:07:16,020 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:07:16,020 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:07:16,020 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:07:16,021 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:07:16,021 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:07:16,022 - trading_system - INFO - Created local data source
2025-03-09 09:07:16,042 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:07:16,595 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:07:16,596 - trading_system - INFO - Binance interface initialized
2025-03-09 09:07:16,598 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:07:16,599 - trading_system - INFO - Created exchange data source
2025-03-09 09:07:16,601 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:07:16,602 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:07:16,603 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:07:16,605 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:07:17,099 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:07:17,102 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:07:17,107 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:07:17,108 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:07:17,109 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:07:17,110 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:07:17,110 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:07:17,110 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:07:17,112 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:07:17,114 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:07:17,114 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:07:17,115 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:07:17,115 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:07:17,117 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:07:17,117 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:07:17,118 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:07:17,271 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:07:36,890 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 3600000 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:07:36,894 - trading_system - ERROR - Smart OHLCV fetch failed: cannot access local variable 'ms_per_candle' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 194, in smart_fetch_ohlcv
    chunks = self._calculate_fetch_chunks(start_dt, end_dt, timeframe_ms)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 531, in _calculate_fetch_chunks
    ms_per_candle = 60 * 1000 if ms_per_candle <= 0 else timeframe
                                 ^^^^^^^^^^^^^
UnboundLocalError: cannot access local variable 'ms_per_candle' where it is not associated with a value

2025-03-09 09:07:36,896 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 09:07:36,896 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:07:36,898 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:07:36,899 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:07:36,901 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:07:36,902 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:07:36,903 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:07:36,903 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:07:36,914 - system.execution - INFO - Execution engine closed
2025-03-09 09:07:36,914 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:07:36,916 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:07:36,916 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:07:36,917 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:07:36,917 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:07:36,918 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:07:36,923 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:07:59,963 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:08:00,001 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:08:00,002 - trading_system - INFO - Trading system initializing...
2025-03-09 09:08:00,018 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:08:00,019 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:08:00,021 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:08:00,022 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:08:00,023 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:08:00,023 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:08:00,025 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:08:00,026 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:08:00,026 - trading_system - INFO - Created local data source
2025-03-09 09:08:00,049 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:08:00,675 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:08:00,678 - trading_system - INFO - Binance interface initialized
2025-03-09 09:08:00,679 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:08:00,680 - trading_system - INFO - Created exchange data source
2025-03-09 09:08:00,682 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:08:00,683 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:08:00,685 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:08:00,688 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:08:01,250 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:08:01,255 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:08:01,261 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:08:01,263 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:08:01,265 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:08:01,265 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:08:01,266 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:08:01,267 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:08:01,269 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:08:01,270 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:08:01,271 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:08:01,272 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:08:01,272 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:08:01,275 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:08:01,276 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:08:01,276 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:08:01,467 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:08:01,468 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:08:15,945 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:08:15,980 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:08:15,981 - trading_system - INFO - Trading system initializing...
2025-03-09 09:08:15,989 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:08:15,990 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:08:15,990 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:08:15,990 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:08:15,991 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:08:15,991 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:08:15,991 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:08:15,992 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:08:15,993 - trading_system - INFO - Created local data source
2025-03-09 09:08:16,012 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:08:16,557 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:08:16,559 - trading_system - INFO - Binance interface initialized
2025-03-09 09:08:16,559 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:08:16,560 - trading_system - INFO - Created exchange data source
2025-03-09 09:08:16,561 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:08:16,562 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:08:16,563 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:08:16,566 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:08:17,104 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:08:17,109 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:08:17,114 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:08:17,115 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:08:17,116 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:08:17,117 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:08:17,117 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:08:17,118 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:08:17,119 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:08:17,120 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:08:17,122 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:08:17,122 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:08:17,123 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:08:17,125 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:08:17,126 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:08:17,126 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:08:17,298 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:08:17,299 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:08:29,469 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:08:29,505 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:08:29,506 - trading_system - INFO - Trading system initializing...
2025-03-09 09:08:29,513 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:08:29,516 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:08:29,517 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:08:29,517 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:08:29,518 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:08:29,518 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:08:29,519 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:08:29,520 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:08:29,520 - trading_system - INFO - Created local data source
2025-03-09 09:08:29,541 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:08:30,106 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:08:30,107 - trading_system - INFO - Binance interface initialized
2025-03-09 09:08:30,108 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:08:30,109 - trading_system - INFO - Created exchange data source
2025-03-09 09:08:30,110 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:08:30,111 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:08:30,112 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:08:30,115 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:08:30,600 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:08:30,602 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:08:30,607 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:08:30,609 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:08:30,610 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:08:30,611 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:08:30,611 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:08:30,612 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:08:30,612 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:08:30,615 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:08:30,615 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:08:30,616 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:08:30,616 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:08:30,618 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:08:30,619 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:08:30,619 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:08:30,765 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:08:30,766 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:10:56,437 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:10:56,478 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:10:56,479 - trading_system - INFO - Trading system initializing...
2025-03-09 09:10:56,493 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:10:56,494 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:10:56,495 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:10:56,495 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:10:56,495 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:10:56,496 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:10:56,496 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:10:56,497 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:10:56,498 - trading_system - INFO - Created local data source
2025-03-09 09:10:56,518 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:10:57,066 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:10:57,068 - trading_system - INFO - Binance interface initialized
2025-03-09 09:10:57,069 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:10:57,070 - trading_system - INFO - Created exchange data source
2025-03-09 09:10:57,072 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:10:57,074 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:10:57,077 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:10:57,081 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:10:57,592 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:10:57,595 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:10:57,601 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:10:57,602 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:10:57,603 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:10:57,604 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:10:57,605 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:10:57,605 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:10:57,607 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:10:57,608 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:10:57,609 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:10:57,609 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:10:57,610 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:10:57,612 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:10:57,613 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:10:57,614 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:10:57,756 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:10:57,757 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:11:26,561 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:14:51,151 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:15:09,805 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:15:09,867 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:15:09,868 - trading_system - INFO - Trading system initializing...
2025-03-09 09:15:09,877 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:15:09,878 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:15:09,879 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:15:09,880 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:15:09,880 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:15:09,880 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:15:09,881 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:15:09,882 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:15:09,882 - trading_system - INFO - Created local data source
2025-03-09 09:15:09,903 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:15:10,573 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:15:10,575 - trading_system - INFO - Binance interface initialized
2025-03-09 09:15:10,576 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:15:10,577 - trading_system - INFO - Created exchange data source
2025-03-09 09:15:10,578 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:15:10,579 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:15:10,581 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:15:10,586 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:15:11,082 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:15:11,084 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:15:11,089 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:15:11,090 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:15:11,092 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:15:11,092 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:15:11,093 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:15:11,093 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:15:11,094 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:15:11,096 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:15:11,097 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:15:11,098 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:15:11,099 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:15:11,100 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:15:11,101 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:15:11,102 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:15:11,262 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:15:11,263 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:15:13,747 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:19:15,207 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:19:15,243 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:19:15,245 - trading_system - INFO - Trading system initializing...
2025-03-09 09:19:15,254 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:19:15,255 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:19:15,255 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:19:15,255 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:19:15,257 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:19:15,257 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:19:15,258 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:19:15,259 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:19:15,259 - trading_system - INFO - Created local data source
2025-03-09 09:19:15,278 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:19:15,839 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:19:15,840 - trading_system - INFO - Binance interface initialized
2025-03-09 09:19:15,842 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:19:15,843 - trading_system - INFO - Created exchange data source
2025-03-09 09:19:15,844 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:19:15,845 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:19:15,847 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:19:15,850 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:19:16,398 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:19:16,401 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:19:16,406 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:19:16,408 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:19:16,410 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:19:16,410 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:19:16,412 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:19:16,413 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:19:16,414 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:19:16,415 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:19:16,416 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:19:16,416 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:19:16,418 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:19:16,420 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:19:16,420 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:19:16,422 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:19:16,650 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:19:16,651 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:19:19,661 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:19:25,018 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:20:10,088 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:20:10,124 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:20:10,125 - trading_system - INFO - Trading system initializing...
2025-03-09 09:20:10,132 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:20:10,133 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:20:10,134 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:20:10,134 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:20:10,135 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:20:10,135 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:20:10,136 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:20:10,137 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:20:10,137 - trading_system - INFO - Created local data source
2025-03-09 09:20:10,155 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:20:10,687 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:20:10,688 - trading_system - INFO - Binance interface initialized
2025-03-09 09:20:10,688 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:20:10,689 - trading_system - INFO - Created exchange data source
2025-03-09 09:20:10,690 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:20:10,690 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:20:10,691 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:20:10,693 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:20:11,173 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:20:11,175 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:20:11,180 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:20:11,182 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:20:11,183 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:20:11,184 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:20:11,184 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:20:11,185 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:20:11,186 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:20:11,187 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:20:11,188 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:20:11,188 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:20:11,189 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:20:11,191 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:20:11,192 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:20:11,192 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:20:11,366 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:20:11,367 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:20:20,142 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:23:30,939 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:23:30,970 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:23:30,972 - trading_system - INFO - Trading system initializing...
2025-03-09 09:23:31,074 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:23:31,076 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:23:31,078 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:23:31,079 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:23:31,080 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:23:31,080 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:23:31,082 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:23:31,083 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:23:31,084 - trading_system - INFO - Created local data source
2025-03-09 09:23:31,104 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:23:31,599 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:23:31,600 - trading_system - INFO - Binance interface initialized
2025-03-09 09:23:31,602 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:23:31,603 - trading_system - INFO - Created exchange data source
2025-03-09 09:23:31,604 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:23:31,604 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:23:31,606 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:23:31,607 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:23:32,076 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:23:32,078 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:23:32,084 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:23:32,085 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:23:32,086 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:23:32,086 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:23:32,086 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:23:32,087 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:23:32,088 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:23:32,089 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:23:32,091 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:23:32,091 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:23:32,091 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:23:32,095 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:23:32,095 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:23:32,096 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:23:32,294 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:23:32,295 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:23:32,296 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:23:43,947 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:23:47,986 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:24:07,948 - trading_system - ERROR - Chunk 1/1 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:24:43,037 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:24:47,246 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 09:24:47,248 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:24:47,249 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:24:47,252 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:24:47,254 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:24:47,259 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:24:47,260 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:24:47,260 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:24:47,261 - system.execution - INFO - Execution engine closed
2025-03-09 09:24:47,263 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:24:47,265 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:24:47,265 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:24:47,266 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:24:47,267 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:24:47,267 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:24:47,269 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:24:56,659 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:24:56,699 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:24:56,700 - trading_system - INFO - Trading system initializing...
2025-03-09 09:24:56,713 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:24:56,715 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:24:56,715 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:24:56,716 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:24:56,717 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:24:56,718 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:24:56,718 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:24:56,720 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:24:56,720 - trading_system - INFO - Created local data source
2025-03-09 09:24:56,740 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:24:57,235 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:24:57,235 - trading_system - INFO - Binance interface initialized
2025-03-09 09:24:57,236 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:24:57,236 - trading_system - INFO - Created exchange data source
2025-03-09 09:24:57,237 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:24:57,238 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:24:57,238 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:24:57,240 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:24:57,723 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:24:57,725 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:24:57,730 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:24:57,730 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:24:57,732 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:24:57,733 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:24:57,733 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:24:57,734 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:24:57,735 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:24:57,737 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:24:57,738 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:24:57,738 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:24:57,739 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:24:57,740 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:24:57,741 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:24:57,743 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:24:57,891 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:24:57,893 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:24:57,893 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:25:52,407 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:25:52,440 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:25:52,440 - trading_system - INFO - Trading system initializing...
2025-03-09 09:25:52,448 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:25:52,449 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:25:52,450 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:25:52,451 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:25:52,452 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:25:52,452 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:25:52,453 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:25:52,453 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:25:52,454 - trading_system - INFO - Created local data source
2025-03-09 09:25:52,472 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:25:53,042 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:25:53,043 - trading_system - INFO - Binance interface initialized
2025-03-09 09:25:53,044 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:25:53,046 - trading_system - INFO - Created exchange data source
2025-03-09 09:25:53,046 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:25:53,047 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:25:53,048 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:25:53,051 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:25:53,536 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:25:53,538 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:25:53,544 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:25:53,545 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:25:53,546 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:25:53,546 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:25:53,547 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:25:53,548 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:25:53,549 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:25:53,550 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:25:53,551 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:25:53,552 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:25:53,552 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:25:53,555 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:25:53,556 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:25:53,557 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:25:53,706 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:25:53,707 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:25:53,707 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:26:40,057 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:26:40,107 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:26:40,108 - trading_system - INFO - Trading system initializing...
2025-03-09 09:26:40,117 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:26:40,118 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:26:40,119 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:26:40,119 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:26:40,119 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:26:40,120 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:26:40,121 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:26:40,122 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:26:40,123 - trading_system - INFO - Created local data source
2025-03-09 09:26:40,142 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:26:40,766 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:26:40,768 - trading_system - INFO - Binance interface initialized
2025-03-09 09:26:40,770 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:26:40,771 - trading_system - INFO - Created exchange data source
2025-03-09 09:26:40,772 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:26:40,774 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:26:40,776 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:26:40,782 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:26:41,254 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:26:41,257 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:26:41,262 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:26:41,264 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:26:41,265 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:26:41,266 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:26:41,267 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:26:41,267 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:26:41,268 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:26:41,270 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:26:41,270 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:26:41,271 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:26:41,271 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:26:41,274 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:26:41,274 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:26:41,275 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:26:41,405 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:26:41,406 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:26:41,406 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:26:43,695 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:27:03,433 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:27:03,480 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:27:03,480 - trading_system - INFO - Trading system initializing...
2025-03-09 09:27:03,489 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:27:03,490 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:27:03,490 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:27:03,490 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:27:03,492 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:27:03,492 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:27:03,493 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:27:03,494 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:27:03,494 - trading_system - INFO - Created local data source
2025-03-09 09:27:03,526 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:27:04,038 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:27:04,040 - trading_system - INFO - Binance interface initialized
2025-03-09 09:27:04,042 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:27:04,043 - trading_system - INFO - Created exchange data source
2025-03-09 09:27:04,045 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:27:04,046 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:27:04,049 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:27:04,053 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:27:04,531 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:27:04,532 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:27:04,538 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:27:04,539 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:27:04,540 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:27:04,540 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:27:04,542 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:27:04,542 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:27:04,543 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:27:04,544 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:27:04,545 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:27:04,546 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:27:04,546 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:27:04,548 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:27:04,548 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:27:04,549 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:27:04,677 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:27:04,677 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:27:04,678 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:27:16,564 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:27:26,829 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:27:41,892 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:27:41,925 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:27:41,926 - trading_system - INFO - Trading system initializing...
2025-03-09 09:27:41,934 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:27:41,935 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:27:41,935 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:27:41,936 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:27:41,936 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:27:41,937 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:27:41,937 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:27:41,938 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:27:41,938 - trading_system - INFO - Created local data source
2025-03-09 09:27:41,957 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:27:42,515 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:27:42,516 - trading_system - INFO - Binance interface initialized
2025-03-09 09:27:42,517 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:27:42,517 - trading_system - INFO - Created exchange data source
2025-03-09 09:27:42,518 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:27:42,518 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:27:42,520 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:27:42,522 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:27:42,997 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:27:42,999 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:27:43,005 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:27:43,006 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:27:43,007 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:27:43,007 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:27:43,008 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:27:43,009 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:27:43,009 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:27:43,011 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:27:43,011 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:27:43,012 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:27:43,012 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:27:43,014 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:27:43,014 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:27:43,015 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:27:43,147 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:27:43,148 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:27:43,148 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:27:47,878 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:27:56,362 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:28:02,362 - trading_system - ERROR - Chunk 1/1 fetch failed after max retries: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:28:02,363 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:28:02,366 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 09:28:02,367 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:28:02,368 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:28:02,370 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:28:02,371 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:28:02,374 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:28:02,376 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:28:02,376 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:28:02,377 - system.execution - INFO - Execution engine closed
2025-03-09 09:28:02,378 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:28:02,379 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:28:02,379 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:28:02,380 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:28:02,382 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:28:02,383 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:28:02,385 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Future finished result=None>)
handle: <Handle Task.task_wakeup(<Future finished result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:28:08,367 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:28:08,404 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:28:08,405 - trading_system - INFO - Trading system initializing...
2025-03-09 09:28:08,413 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:28:08,414 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:28:08,415 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:28:08,415 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:28:08,416 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:28:08,416 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:28:08,417 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:28:08,417 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:28:08,418 - trading_system - INFO - Created local data source
2025-03-09 09:28:08,435 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:28:08,976 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:28:08,977 - trading_system - INFO - Binance interface initialized
2025-03-09 09:28:08,979 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:28:08,980 - trading_system - INFO - Created exchange data source
2025-03-09 09:28:08,982 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:28:08,983 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:28:08,984 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:28:08,988 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:28:09,457 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:28:09,460 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:28:09,476 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:28:09,478 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:28:09,479 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:28:09,479 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:28:09,480 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:28:09,480 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:28:09,482 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:28:09,483 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:28:09,485 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:28:09,485 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:28:09,486 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:28:09,488 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:28:09,489 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:28:09,489 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:28:09,668 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:28:09,669 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:28:09,670 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:28:11,703 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:28:16,007 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: Binance.fetch_ohlcv() got an unexpected keyword argument 'since'
2025-03-09 09:28:23,637 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:28:23,670 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:28:23,671 - trading_system - INFO - Trading system initializing...
2025-03-09 09:28:23,678 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:28:23,679 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:28:23,681 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:28:23,681 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:28:23,681 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:28:23,682 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:28:23,682 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:28:23,683 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:28:23,684 - trading_system - INFO - Created local data source
2025-03-09 09:28:23,702 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:28:24,204 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:28:24,205 - trading_system - INFO - Binance interface initialized
2025-03-09 09:28:24,206 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:28:24,206 - trading_system - INFO - Created exchange data source
2025-03-09 09:28:24,207 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:28:24,207 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:28:24,208 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:28:24,210 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:28:24,728 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:28:24,730 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:28:24,737 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:28:24,738 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:28:24,739 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:28:24,739 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:28:24,739 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:28:24,740 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:28:24,742 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:28:24,743 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:28:24,744 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:28:24,745 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:28:24,745 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:28:24,747 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:28:24,748 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:28:24,749 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:28:24,929 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:28:24,930 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:28:24,930 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:28:57,422 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:28:57,455 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:28:57,456 - trading_system - INFO - Trading system initializing...
2025-03-09 09:28:57,464 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:28:57,465 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:28:57,466 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:28:57,467 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:28:57,467 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:28:57,468 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:28:57,468 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:28:57,469 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:28:57,470 - trading_system - INFO - Created local data source
2025-03-09 09:28:57,489 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:28:58,032 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:28:58,032 - trading_system - INFO - Binance interface initialized
2025-03-09 09:28:58,033 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:28:58,033 - trading_system - INFO - Created exchange data source
2025-03-09 09:28:58,033 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:28:58,034 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:28:58,035 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:28:58,036 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:28:58,587 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:28:58,590 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:28:58,594 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:28:58,596 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:28:58,596 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:28:58,597 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:28:58,598 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:28:58,598 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:28:58,599 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:28:58,600 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:28:58,602 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:28:58,602 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:28:58,603 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:28:58,605 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:28:58,605 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:28:58,606 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:28:58,805 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:28:58,806 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:28:58,807 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:29:08,660 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:29:38,233 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:29:38,267 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:29:38,268 - trading_system - INFO - Trading system initializing...
2025-03-09 09:29:38,276 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:29:38,276 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:29:38,277 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:29:38,278 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:29:38,278 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:29:38,279 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:29:38,280 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:29:38,280 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:29:38,281 - trading_system - INFO - Created local data source
2025-03-09 09:29:38,300 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:29:38,812 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:29:38,812 - trading_system - INFO - Binance interface initialized
2025-03-09 09:29:38,813 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:29:38,814 - trading_system - INFO - Created exchange data source
2025-03-09 09:29:38,814 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:29:38,814 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:29:38,815 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:29:38,816 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:29:39,290 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:29:39,292 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:29:39,298 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:29:39,299 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:29:39,299 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:29:39,300 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:29:39,300 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:29:39,302 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:29:39,303 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:29:39,304 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:29:39,304 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:29:39,305 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:29:39,305 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:29:39,307 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:29:39,308 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:29:39,309 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:29:39,440 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:29:39,441 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:29:39,442 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:29:44,424 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:30:23,687 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:30:23,719 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:30:23,719 - trading_system - INFO - Trading system initializing...
2025-03-09 09:30:23,727 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:30:23,728 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:30:23,729 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:30:23,729 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:30:23,730 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:30:23,730 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:30:23,731 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:30:23,732 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:30:23,732 - trading_system - INFO - Created local data source
2025-03-09 09:30:23,748 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:30:24,406 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:30:24,408 - trading_system - INFO - Binance interface initialized
2025-03-09 09:30:24,410 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:30:24,411 - trading_system - INFO - Created exchange data source
2025-03-09 09:30:24,412 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:30:24,414 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:30:24,416 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:30:24,421 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:30:24,890 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:30:24,892 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:30:24,897 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:30:24,899 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:30:24,900 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:30:24,901 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:30:24,901 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:30:24,902 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:30:24,903 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:30:24,904 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:30:24,905 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:30:24,905 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:30:24,906 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:30:24,908 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:30:24,909 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:30:24,909 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:30:25,048 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:30:25,049 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:30:25,050 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:30:30,580 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:30:43,409 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:30:43,443 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:30:43,444 - trading_system - INFO - Trading system initializing...
2025-03-09 09:30:43,450 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:30:43,452 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:30:43,453 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:30:43,454 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:30:43,454 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:30:43,455 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:30:43,455 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:30:43,456 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:30:43,457 - trading_system - INFO - Created local data source
2025-03-09 09:30:43,476 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:30:44,008 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:30:44,011 - trading_system - INFO - Binance interface initialized
2025-03-09 09:30:44,012 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:30:44,013 - trading_system - INFO - Created exchange data source
2025-03-09 09:30:44,014 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:30:44,016 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:30:44,018 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:30:44,023 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:30:44,494 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:30:44,497 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:30:44,501 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:30:44,502 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:30:44,503 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:30:44,503 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:30:44,504 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:30:44,505 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:30:44,506 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:30:44,507 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:30:44,508 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:30:44,509 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:30:44,509 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:30:44,512 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:30:44,512 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:30:44,512 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:30:44,638 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:30:44,638 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:30:44,639 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:30:48,809 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:31:36,783 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:31:36,822 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:31:36,823 - trading_system - INFO - Trading system initializing...
2025-03-09 09:31:36,835 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:31:36,836 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:31:36,836 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:31:36,836 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:31:36,837 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:31:36,837 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:31:36,838 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:31:36,839 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:31:36,839 - trading_system - INFO - Created local data source
2025-03-09 09:31:36,858 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:31:37,466 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:31:37,469 - trading_system - INFO - Binance interface initialized
2025-03-09 09:31:37,470 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:31:37,471 - trading_system - INFO - Created exchange data source
2025-03-09 09:31:37,472 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:31:37,474 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:31:37,476 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:31:37,480 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:31:37,955 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:31:37,957 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:31:37,962 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:31:37,963 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:31:37,964 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:31:37,964 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:31:37,965 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:31:37,965 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:31:37,966 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:31:37,967 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:31:37,968 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:31:37,970 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:31:37,970 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:31:37,972 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:31:37,972 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:31:37,973 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:31:38,110 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:31:38,111 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:31:38,112 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:34:21,904 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:34:21,941 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:34:21,942 - trading_system - INFO - Trading system initializing...
2025-03-09 09:34:21,956 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:34:21,958 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:34:21,959 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:34:21,960 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:34:21,960 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:34:21,961 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:34:21,962 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:34:21,964 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:34:21,964 - trading_system - INFO - Created local data source
2025-03-09 09:34:21,983 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:34:22,646 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:34:22,647 - trading_system - INFO - Binance interface initialized
2025-03-09 09:34:22,649 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:34:22,652 - trading_system - INFO - Created exchange data source
2025-03-09 09:34:22,654 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:34:22,655 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:34:22,657 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:34:22,662 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:34:23,179 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:34:23,191 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:34:23,196 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:34:23,198 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:34:23,199 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:34:23,199 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:34:23,200 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:34:23,200 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:34:23,202 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:34:23,202 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:34:23,204 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:34:23,204 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:34:23,204 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:34:23,206 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:34:23,207 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:34:23,207 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:34:23,351 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:34:23,352 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:34:23,352 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:34:27,164 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:35:00,584 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:35:00,631 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:35:00,631 - trading_system - INFO - Trading system initializing...
2025-03-09 09:35:00,642 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:35:00,644 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:35:00,645 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:35:00,646 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:35:00,646 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:35:00,648 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:35:00,649 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:35:00,650 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:35:00,651 - trading_system - INFO - Created local data source
2025-03-09 09:35:00,671 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:35:01,177 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:35:01,178 - trading_system - INFO - Binance interface initialized
2025-03-09 09:35:01,180 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:35:01,180 - trading_system - INFO - Created exchange data source
2025-03-09 09:35:01,183 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:35:01,184 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:35:01,187 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:35:01,192 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:35:01,668 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:35:01,671 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:35:01,677 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:35:01,679 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:35:01,680 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:35:01,680 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:35:01,682 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:35:01,682 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:35:01,683 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:35:01,684 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:35:01,685 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:35:01,686 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:35:01,686 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:35:01,688 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:35:01,689 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:35:01,689 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:35:01,824 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:35:01,824 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:35:01,826 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:35:10,675 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:35:10,707 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:35:10,708 - trading_system - INFO - Trading system initializing...
2025-03-09 09:35:10,715 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:35:10,716 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:35:10,716 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:35:10,716 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:35:10,718 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:35:10,718 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:35:10,719 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:35:10,720 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:35:10,720 - trading_system - INFO - Created local data source
2025-03-09 09:35:10,738 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:35:11,421 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:35:11,422 - trading_system - INFO - Binance interface initialized
2025-03-09 09:35:11,424 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:35:11,426 - trading_system - INFO - Created exchange data source
2025-03-09 09:35:11,427 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:35:11,429 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:35:11,430 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:35:11,436 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:35:11,893 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:35:11,895 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:35:11,900 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:35:11,901 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:35:11,902 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:35:11,902 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:35:11,904 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:35:11,904 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:35:11,905 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:35:11,906 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:35:11,907 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:35:11,907 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:35:11,908 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:35:11,910 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:35:11,910 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:35:11,910 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:35:12,042 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:35:12,043 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:35:12,044 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:39:05,462 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:39:05,498 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:39:05,499 - trading_system - INFO - Trading system initializing...
2025-03-09 09:39:05,507 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:39:05,508 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:39:05,508 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:39:05,509 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:39:05,509 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:39:05,510 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:39:05,511 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:39:05,511 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:39:05,512 - trading_system - INFO - Created local data source
2025-03-09 09:39:05,530 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:39:06,074 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:39:06,075 - trading_system - INFO - Binance interface initialized
2025-03-09 09:39:06,076 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:39:06,076 - trading_system - INFO - Created exchange data source
2025-03-09 09:39:06,077 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:39:06,077 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:39:06,078 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:39:06,080 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:39:06,757 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:39:06,759 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:39:06,765 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:39:06,766 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:39:06,767 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:39:06,768 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:39:06,769 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:39:06,769 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:39:06,770 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:39:06,772 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:39:06,773 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:39:06,774 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:39:06,774 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:39:06,777 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:39:06,778 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:39:06,778 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:39:07,073 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:39:07,074 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:39:07,075 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:39:11,952 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:39:28,257 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:39:28,289 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:39:28,290 - trading_system - INFO - Trading system initializing...
2025-03-09 09:39:28,298 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:39:28,299 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:39:28,300 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:39:28,301 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:39:28,301 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:39:28,302 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:39:28,302 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:39:28,303 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:39:28,303 - trading_system - INFO - Created local data source
2025-03-09 09:39:28,322 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:39:28,859 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:39:28,860 - trading_system - INFO - Binance interface initialized
2025-03-09 09:39:28,861 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:39:28,862 - trading_system - INFO - Created exchange data source
2025-03-09 09:39:28,862 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:39:28,863 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:39:28,864 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:39:28,866 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:39:29,320 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:39:29,322 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:39:29,327 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:39:29,329 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:39:29,330 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:39:29,331 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:39:29,332 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:39:29,333 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:39:29,334 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:39:29,336 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:39:29,337 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:39:29,338 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:39:29,338 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:39:29,340 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:39:29,341 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:39:29,342 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:40:10,910 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:40:10,946 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:40:10,947 - trading_system - INFO - Trading system initializing...
2025-03-09 09:40:10,955 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:40:10,957 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:40:10,958 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:40:10,958 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:40:10,959 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:40:10,960 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:40:10,960 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:40:10,961 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:40:10,962 - trading_system - INFO - Created local data source
2025-03-09 09:40:10,983 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:40:11,583 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:40:11,584 - trading_system - INFO - Binance interface initialized
2025-03-09 09:40:11,585 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:40:11,586 - trading_system - INFO - Created exchange data source
2025-03-09 09:40:11,587 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:40:11,588 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:40:11,589 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:40:11,592 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:40:12,062 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:40:12,064 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:40:12,070 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:40:12,071 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:40:12,072 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:40:12,072 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:40:12,073 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:40:12,073 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:40:12,074 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:40:12,075 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:40:12,076 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:40:12,077 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:40:12,077 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:40:12,079 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:40:12,079 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:40:12,080 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:40:16,883 - trading_system - ERROR - Failed to get OHLCV data (BTC/USDT 1h): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:40:16,886 - AsyncExecutor - ERROR - Error in task task_2481849261312_1: Expected coroutine, got DataFrame
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got DataFrame
2025-03-09 09:40:16,890 - trading_system - ERROR - Failed to fetch recent data for BTC/USDT: Expected coroutine, got DataFrame
2025-03-09 09:40:16,895 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:40:16,895 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:40:16,899 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:40:16,902 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:40:16,905 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:40:16,906 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:40:16,907 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:40:16,908 - system.execution - INFO - Execution engine closed
2025-03-09 09:40:16,908 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:40:16,910 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:40:16,910 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:40:16,911 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:40:16,911 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:40:16,911 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:40:16,915 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:40:27,422 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:40:27,458 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:40:27,459 - trading_system - INFO - Trading system initializing...
2025-03-09 09:40:27,468 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:40:27,470 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:40:27,472 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:40:27,472 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:40:27,473 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:40:27,473 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:40:27,474 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:40:27,476 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:40:27,476 - trading_system - INFO - Created local data source
2025-03-09 09:40:27,504 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:40:28,050 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:40:28,052 - trading_system - INFO - Binance interface initialized
2025-03-09 09:40:28,053 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:40:28,053 - trading_system - INFO - Created exchange data source
2025-03-09 09:40:28,055 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:40:28,056 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:40:28,057 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:40:28,059 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:40:28,557 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:40:28,560 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:40:28,565 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:40:28,567 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:40:28,567 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:40:28,568 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:40:28,569 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:40:28,570 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:40:28,571 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:40:28,572 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:40:28,573 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:40:28,574 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:40:28,574 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:40:28,577 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:40:28,577 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:40:28,578 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:40:31,659 - trading_system - ERROR - Failed to get OHLCV data (BTC/USDT 1h): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:40:31,662 - AsyncExecutor - ERROR - Error in task task_1449940138816_1: Expected coroutine, got DataFrame
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got DataFrame
2025-03-09 09:40:31,665 - trading_system - ERROR - Failed to fetch recent data for BTC/USDT: Expected coroutine, got DataFrame
2025-03-09 09:40:31,669 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:40:31,670 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:40:31,672 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:40:31,673 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:40:31,676 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:40:31,677 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:40:31,678 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:40:31,679 - system.execution - INFO - Execution engine closed
2025-03-09 09:40:31,680 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:40:31,680 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:40:31,681 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:40:31,681 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:40:31,682 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:40:31,682 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:40:31,684 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:40:37,690 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:40:37,726 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:40:37,727 - trading_system - INFO - Trading system initializing...
2025-03-09 09:40:37,739 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:40:37,741 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:40:37,742 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:40:37,742 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:40:37,744 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:40:37,744 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:40:37,745 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:40:37,746 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:40:37,747 - trading_system - INFO - Created local data source
2025-03-09 09:40:37,773 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:40:38,346 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:40:38,347 - trading_system - INFO - Binance interface initialized
2025-03-09 09:40:38,349 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:40:38,350 - trading_system - INFO - Created exchange data source
2025-03-09 09:40:38,352 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:40:38,353 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:40:38,356 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:40:38,360 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:40:38,839 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:40:38,841 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:40:38,846 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:40:38,847 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:40:38,848 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:40:38,848 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:40:38,849 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:40:38,849 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:40:38,850 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:40:38,851 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:40:38,852 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:40:38,853 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:40:38,853 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:40:38,855 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:40:38,856 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:40:38,857 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:41:10,935 - trading_system - ERROR - Failed to get OHLCV data (BTC/USDT 1h): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:41:20,514 - AsyncExecutor - ERROR - Error in task task_2830020986112_1: Expected coroutine, got DataFrame
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got DataFrame
2025-03-09 09:41:20,517 - trading_system - ERROR - Failed to fetch recent data for BTC/USDT: Expected coroutine, got DataFrame
2025-03-09 09:41:20,520 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:41:20,522 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:41:20,524 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:41:20,527 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:41:20,529 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:41:20,530 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:41:20,532 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:41:20,533 - system.execution - INFO - Execution engine closed
2025-03-09 09:41:20,533 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:41:20,535 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:41:20,536 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:41:20,537 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:41:20,537 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:41:20,538 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:41:20,544 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:41:25,464 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:41:25,498 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:41:25,499 - trading_system - INFO - Trading system initializing...
2025-03-09 09:41:25,508 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:41:25,509 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:41:25,510 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:41:25,511 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:41:25,511 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:41:25,511 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:41:25,512 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:41:25,513 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:41:25,513 - trading_system - INFO - Created local data source
2025-03-09 09:41:25,531 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:41:26,146 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:41:26,148 - trading_system - INFO - Binance interface initialized
2025-03-09 09:41:26,150 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:41:26,151 - trading_system - INFO - Created exchange data source
2025-03-09 09:41:26,152 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:41:26,154 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:41:26,156 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:41:26,162 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:41:26,626 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:41:26,629 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:41:26,633 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:41:26,634 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:41:26,635 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:41:26,636 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:41:26,637 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:41:26,637 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:41:26,639 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:41:26,640 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:41:26,640 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:41:26,640 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:41:26,642 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:41:26,644 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:41:26,645 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:41:26,646 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:41:52,202 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:41:52,235 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:41:52,236 - trading_system - INFO - Trading system initializing...
2025-03-09 09:41:52,243 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:41:52,244 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:41:52,245 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:41:52,245 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:41:52,246 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:41:52,246 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:41:52,247 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:41:52,248 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:41:52,258 - trading_system - INFO - Created local data source
2025-03-09 09:41:52,276 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:41:52,761 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:41:52,762 - trading_system - INFO - Binance interface initialized
2025-03-09 09:41:52,764 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:41:52,765 - trading_system - INFO - Created exchange data source
2025-03-09 09:41:52,766 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:41:52,766 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:41:52,768 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:41:52,770 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:41:53,213 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:41:53,215 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:41:53,220 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:41:53,221 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:41:53,222 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:41:53,222 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:41:53,223 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:41:53,224 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:41:53,225 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:41:53,226 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:41:53,227 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:41:53,228 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:41:53,228 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:41:53,230 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:41:53,230 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:41:53,232 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:42:28,529 - trading_system - ERROR - Failed to get OHLCV data (BTC/USDT 1h): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:43:28,453 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:43:28,486 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:43:28,487 - trading_system - INFO - Trading system initializing...
2025-03-09 09:43:28,495 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:43:28,496 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:43:28,497 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:43:28,498 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:43:28,498 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:43:28,499 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:43:28,499 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:43:28,500 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:43:28,500 - trading_system - INFO - Created local data source
2025-03-09 09:43:28,520 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:43:29,120 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:43:29,121 - trading_system - INFO - Binance interface initialized
2025-03-09 09:43:29,122 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:43:29,123 - trading_system - INFO - Created exchange data source
2025-03-09 09:43:29,124 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:43:29,125 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:43:29,126 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:43:29,128 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:43:29,593 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:43:29,596 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:43:29,600 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:43:29,602 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:43:29,603 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:43:29,604 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:43:29,605 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:43:29,605 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:43:29,606 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:43:29,607 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:43:29,608 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:43:29,608 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:43:29,608 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:43:29,611 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:43:29,611 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:43:29,611 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:44:54,370 - trading_system - ERROR - Failed to get OHLCV data (BTC/USDT 1h): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:44:54,373 - AsyncExecutor - ERROR - Error in task task_2437371483008_1: Expected coroutine, got DataFrame
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got DataFrame
2025-03-09 09:44:54,377 - trading_system - ERROR - Failed to fetch recent data for BTC/USDT: Expected coroutine, got DataFrame
2025-03-09 09:44:54,381 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:44:54,381 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:44:54,384 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:44:54,385 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:44:54,389 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:44:54,391 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:44:54,392 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:44:54,394 - system.execution - INFO - Execution engine closed
2025-03-09 09:44:54,396 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:44:54,397 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:44:54,398 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:44:54,400 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:44:54,401 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:44:54,402 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:44:54,404 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 09:49:05,749 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:49:05,788 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:49:05,789 - trading_system - INFO - Trading system initializing...
2025-03-09 09:49:05,796 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:49:05,798 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:49:05,798 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:49:05,800 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:49:05,800 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:49:05,800 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:49:05,802 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:49:05,802 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:49:05,803 - trading_system - INFO - Created local data source
2025-03-09 09:49:05,823 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:49:06,368 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:49:06,370 - trading_system - INFO - Binance interface initialized
2025-03-09 09:49:06,370 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:49:06,370 - trading_system - INFO - Created exchange data source
2025-03-09 09:49:06,372 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:49:06,372 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:49:06,373 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:49:06,375 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:49:06,882 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:49:06,885 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:49:06,891 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:49:06,891 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:49:06,892 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:49:06,893 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:49:06,895 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:49:06,895 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:49:06,896 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:49:06,897 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:49:06,898 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:49:06,899 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:49:06,899 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:49:06,901 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:49:06,902 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:49:06,902 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:49:07,066 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:49:07,067 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:49:07,067 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:50:11,901 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:50:40,513 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:50:40,554 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:50:40,555 - trading_system - INFO - Trading system initializing...
2025-03-09 09:50:40,568 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:50:40,570 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:50:40,571 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:50:40,571 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:50:40,571 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:50:40,573 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:50:40,574 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:50:40,575 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:50:40,575 - trading_system - INFO - Created local data source
2025-03-09 09:50:40,594 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:50:41,152 - trading_system - INFO - Async client initialized, current IP: 89.213.179.134
2025-03-09 09:50:41,153 - trading_system - INFO - Binance interface initialized
2025-03-09 09:50:41,155 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:50:41,157 - trading_system - INFO - Created exchange data source
2025-03-09 09:50:41,158 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:50:41,160 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:50:41,162 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:50:41,167 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:50:41,671 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:50:41,672 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:50:41,677 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:50:41,678 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:50:41,679 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:50:41,680 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:50:41,680 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:50:41,681 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:50:41,682 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:50:41,684 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:50:41,685 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:50:41,685 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:50:41,686 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:50:41,689 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:50:41,689 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:50:41,690 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:50:41,843 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:50:41,844 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:50:41,845 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:54:28,736 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:54:28,768 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:54:28,769 - trading_system - INFO - Trading system initializing...
2025-03-09 09:54:28,775 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:54:28,776 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:54:28,777 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:54:28,777 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:54:28,778 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:54:28,778 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:54:28,780 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:54:28,781 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:54:28,781 - trading_system - INFO - Created local data source
2025-03-09 09:54:28,815 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:54:28,815 - trading_system - INFO - Async client initialized
2025-03-09 09:54:29,367 - trading_system - INFO - current IP: 89.213.179.134
2025-03-09 09:54:29,369 - trading_system - INFO - Binance interface initialized
2025-03-09 09:54:29,370 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:54:29,371 - trading_system - INFO - Created exchange data source
2025-03-09 09:54:29,372 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:54:29,374 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:54:29,377 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:54:29,381 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:54:29,847 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:54:29,849 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:54:29,854 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:54:29,855 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:54:29,857 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:54:29,857 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:54:29,858 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:54:29,858 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:54:29,859 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:54:29,861 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:54:29,861 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:54:29,861 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:54:29,862 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:54:29,864 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:54:29,865 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:54:29,865 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:54:29,997 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:54:29,998 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:54:29,998 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:57:07,066 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 09:57:07,099 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 09:57:07,100 - trading_system - INFO - Trading system initializing...
2025-03-09 09:57:07,111 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 09:57:07,112 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 09:57:07,113 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 09:57:07,114 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 09:57:07,114 - trading_system - INFO - Starting trading pipeline...
2025-03-09 09:57:07,115 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:57:07,116 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 09:57:07,117 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 09:57:07,117 - trading_system - INFO - Created local data source
2025-03-09 09:57:07,154 - trading_system - INFO - Sync client API key validation successful
2025-03-09 09:57:07,155 - trading_system - INFO - Async client initialized
2025-03-09 09:57:07,704 - trading_system - INFO - current IP: 89.213.179.134
2025-03-09 09:57:07,706 - trading_system - INFO - Binance interface initialized
2025-03-09 09:57:07,708 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 09:57:07,709 - trading_system - INFO - Created exchange data source
2025-03-09 09:57:07,710 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 09:57:07,711 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 09:57:07,714 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 09:57:07,718 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 09:57:08,190 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:57:08,193 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 09:57:08,198 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 09:57:08,199 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 09:57:08,200 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 09:57:08,200 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 09:57:08,201 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 09:57:08,201 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 09:57:08,203 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 09:57:08,204 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 09:57:08,205 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 09:57:08,206 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 09:57:08,207 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 09:57:08,209 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 09:57:08,210 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 09:57:08,210 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 09:57:08,352 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 09:57:08,353 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:57:08,353 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 09:57:08,617 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:57:10,633 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:57:14,637 - trading_system - ERROR - Chunk 1/1 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 09:57:14,639 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 09:57:14,640 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 09:57:14,642 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 09:57:14,643 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 09:57:14,645 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 09:57:14,647 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 09:57:14,652 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:57:14,653 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 09:57:14,655 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:57:14,656 - system.execution - INFO - Execution engine closed
2025-03-09 09:57:14,657 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:57:14,658 - trading_system - INFO - Initiating system shutdown...
2025-03-09 09:57:14,659 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 09:57:14,660 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 09:57:14,661 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 09:57:14,662 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 09:57:14,665 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:26:50,486 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:26:50,522 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:26:50,522 - trading_system - INFO - Trading system initializing...
2025-03-09 10:26:50,532 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:26:50,533 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:26:50,535 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:26:50,535 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:26:50,536 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:26:50,536 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:26:50,536 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:26:50,537 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:26:50,538 - trading_system - INFO - Created local data source
2025-03-09 10:26:50,576 - trading_system - INFO - Sync client API key validation successful
2025-03-09 10:26:50,577 - trading_system - INFO - Async client initialized
2025-03-09 10:26:51,050 - trading_system - INFO - current IP: 89.213.179.134
2025-03-09 10:26:51,051 - trading_system - INFO - Binance interface initialized
2025-03-09 10:26:51,052 - trading_system - ERROR - Connection test failed: 'Binance' object has no attribute 'load_markets'
2025-03-09 10:26:51,052 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 10:26:51,054 - trading_system - INFO - Created exchange data source
2025-03-09 10:26:51,054 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 10:26:51,055 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:26:51,056 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:26:51,058 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:26:51,557 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:26:51,559 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:26:51,564 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:26:51,565 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:26:51,566 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:26:51,567 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:26:51,568 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:26:51,569 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:26:51,570 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:26:51,571 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:26:51,571 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:26:51,572 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:26:51,573 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:26:51,575 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:26:51,576 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 10:26:51,577 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 10:26:51,724 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 10:26:51,726 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: 'NoneType' object has no attribute 'smart_fetch_ohlcv'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 397, in fetch_historical
    df = await self.exchange.smart_fetch_ohlcv(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'smart_fetch_ohlcv'

2025-03-09 10:26:51,727 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 10:26:51,728 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 10:26:51,729 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 10:26:51,729 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 10:26:51,731 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:26:51,732 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 10:26:51,732 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:26:51,732 - system.execution - INFO - Execution engine closed
2025-03-09 10:26:51,734 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:26:51,734 - trading_system - INFO - Initiating system shutdown...
2025-03-09 10:26:51,735 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:26:51,736 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 10:26:51,736 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:26:51,736 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:26:51,739 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:28:07,738 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:28:07,771 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:28:07,771 - trading_system - INFO - Trading system initializing...
2025-03-09 10:28:07,779 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:28:07,780 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:28:07,781 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:28:07,781 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:28:07,782 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:28:07,782 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:28:07,782 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:28:07,783 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:28:07,784 - trading_system - INFO - Created local data source
2025-03-09 10:28:11,816 - trading_system - INFO - Sync client API key validation successful
2025-03-09 10:28:11,817 - trading_system - INFO - Async client initialized
2025-03-09 10:28:12,315 - trading_system - INFO - current IP: 89.213.179.134
2025-03-09 10:28:12,315 - trading_system - INFO - Binance interface initialized
2025-03-09 10:28:12,316 - trading_system - ERROR - Connection test failed: 'Binance' object has no attribute 'load_markets'
2025-03-09 10:35:02,501 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:35:02,533 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:35:02,533 - trading_system - INFO - Trading system initializing...
2025-03-09 10:35:02,542 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:35:02,543 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:35:02,543 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:35:02,545 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:35:02,546 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:35:02,546 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:35:02,547 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:35:02,547 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:35:02,548 - trading_system - INFO - Created local data source
2025-03-09 10:35:02,588 - trading_system - INFO - Sync client API key validation successful
2025-03-09 10:35:02,589 - trading_system - INFO - Async client initialized
2025-03-09 10:35:03,220 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 10:35:03,220 - trading_system - INFO - Binance interface initialized
2025-03-09 10:35:03,222 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 10:35:03,224 - trading_system - INFO - Created exchange data source
2025-03-09 10:35:03,226 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 10:35:03,227 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:35:03,230 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:35:03,234 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:35:03,739 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:35:03,742 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:35:03,748 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:35:03,749 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:35:03,750 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:35:03,750 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:35:03,751 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:35:03,751 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:35:03,752 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:35:03,754 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:35:03,755 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:35:03,755 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:35:03,755 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:35:03,758 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:35:03,758 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 10:35:03,758 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 10:35:03,905 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 10:35:03,906 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 10:35:03,907 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 10:35:04,066 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:35:06,090 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:37:27,308 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:37:27,344 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:37:27,344 - trading_system - INFO - Trading system initializing...
2025-03-09 10:37:27,353 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:37:27,354 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:37:27,355 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:37:27,355 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:37:27,356 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:37:27,356 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:37:27,357 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:37:27,358 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:37:27,359 - trading_system - INFO - Created local data source
2025-03-09 10:37:27,395 - trading_system - INFO - Sync client API key validation successful
2025-03-09 10:37:27,395 - trading_system - INFO - Async client initialized
2025-03-09 10:37:27,396 - trading_system - INFO - Loading markets data...
2025-03-09 10:37:27,397 - trading_system - ERROR - Failed to load markets: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:37:27,398 - trading_system - INFO - Retrying with public API (no authentication)...
2025-03-09 10:37:27,449 - trading_system - ERROR - Public API connection also failed: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:37:27,963 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 10:37:27,964 - trading_system - INFO - Binance interface initialized
2025-03-09 10:37:27,965 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 10:37:27,966 - trading_system - INFO - Created exchange data source
2025-03-09 10:37:27,966 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 10:37:27,967 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:37:27,969 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:37:27,971 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:37:28,578 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:37:28,581 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:37:28,586 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:37:28,587 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:37:28,587 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:37:28,589 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:37:28,589 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:37:28,590 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:37:28,591 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:37:28,592 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:37:28,593 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:37:28,595 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:37:28,595 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:37:28,598 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:37:28,598 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 10:37:28,599 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 10:37:28,841 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 10:37:28,842 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 10:37:28,842 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 10:37:29,038 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:37:31,047 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:37:35,042 - trading_system - ERROR - Chunk 1/1 fetch failed after max retries: unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 10:37:35,043 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 10:37:35,044 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 10:37:35,044 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 10:37:35,045 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 10:37:35,046 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 10:37:35,047 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 10:37:35,049 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:37:35,049 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 10:37:35,050 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:37:35,051 - system.execution - INFO - Execution engine closed
2025-03-09 10:37:35,051 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:37:35,052 - trading_system - INFO - Initiating system shutdown...
2025-03-09 10:37:35,052 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:37:35,053 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 10:37:35,053 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:37:35,053 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:37:35,055 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...' and 'int'")>)
handle: <Handle Task.task_wakeup(<Task finishe...' and 'int'")>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:49:14,473 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:49:14,517 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:49:14,518 - trading_system - INFO - Trading system initializing...
2025-03-09 10:49:14,532 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:49:14,534 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:49:14,534 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:49:14,535 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:49:14,536 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:49:14,536 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:49:14,537 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:49:14,540 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:49:14,541 - trading_system - INFO - Created local data source
2025-03-09 10:49:32,961 - trading_system - ERROR - Failed to connect to Binance: unsupported operand type(s) for /: 'NoneType' and 'int'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 112, in _connect_exchange
    data = self.exchange.fetch_ohlcv(symbol=symbol, timeframe=time_interval, since=1701388800000, limit= 10)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\binance.py", line 3281, in fetch_ohlcv
    self.load_markets()
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\base\exchange.py", line 1463, in load_markets
    currencies = self.fetch_currencies()
                 ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\binance.py", line 1880, in fetch_currencies
    response = self.sapiGetCapitalConfigGetall(params)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\base\types.py", line 34, in unbound_method
    return _self.request(self.path, self.api, self.method, params, config=self.config)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\binance.py", line 8166, in request
    response = self.fetch2(path, api, method, params, headers, body, config)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\base\exchange.py", line 3350, in fetch2
    return self.fetch(request['url'], request['method'], request['headers'], request['body'])
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\ccxt\base\exchange.py", line 601, in fetch
    timeout=(self.timeout / 1000),
             ~~~~~~~~~~~~~^~~~~~
TypeError: unsupported operand type(s) for /: 'NoneType' and 'int'

2025-03-09 10:54:58,813 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:54:58,864 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:54:58,865 - trading_system - INFO - Trading system initializing...
2025-03-09 10:54:58,873 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:54:58,875 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:54:58,875 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:54:58,876 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:54:58,876 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:54:58,876 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:54:58,877 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:54:58,878 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:54:58,878 - trading_system - INFO - Created local data source
2025-03-09 10:54:58,879 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 10:54:58,882 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 10:54:58,883 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 10:54:58,883 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:54:58,883 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:54:58,887 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:54:59,392 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:54:59,397 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:54:59,402 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:54:59,404 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:54:59,404 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:54:59,405 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:54:59,406 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:54:59,406 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:54:59,407 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:54:59,408 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:54:59,409 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:54:59,409 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:54:59,410 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:54:59,412 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:54:59,412 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 10:54:59,414 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 10:54:59,414 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 10:54:59,416 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:54:59,417 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 10:54:59,417 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:54:59,417 - system.execution - INFO - Execution engine closed
2025-03-09 10:54:59,418 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:54:59,418 - trading_system - INFO - Initiating system shutdown...
2025-03-09 10:54:59,419 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:54:59,419 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 10:54:59,420 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:54:59,420 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:54:59,422 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:56:55,703 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:56:55,737 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:56:55,738 - trading_system - INFO - Trading system initializing...
2025-03-09 10:56:55,753 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:56:55,755 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:56:55,757 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:56:55,758 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:56:55,759 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:56:55,760 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:56:55,760 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:56:55,761 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:56:55,762 - trading_system - INFO - Created local data source
2025-03-09 10:57:14,390 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 10:57:14,398 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 10:57:14,400 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 10:57:14,401 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:57:14,405 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:57:14,408 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:57:14,895 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:57:14,897 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:57:14,902 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:57:14,903 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:57:14,904 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:57:14,905 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:57:14,906 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:57:14,906 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:57:14,911 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:57:14,912 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:57:14,913 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:57:14,913 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:57:14,914 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:57:14,917 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:57:14,917 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 10:57:14,918 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 10:57:14,918 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 10:57:14,920 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:57:14,920 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 10:57:14,921 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:57:14,921 - system.execution - INFO - Execution engine closed
2025-03-09 10:57:14,922 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:57:14,922 - trading_system - INFO - Initiating system shutdown...
2025-03-09 10:57:14,923 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:57:14,923 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 10:57:14,924 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:57:14,925 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:57:14,925 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:57:41,801 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:57:41,837 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:57:41,838 - trading_system - INFO - Trading system initializing...
2025-03-09 10:57:41,846 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:57:41,847 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:57:41,848 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:57:41,848 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:57:41,849 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:57:41,850 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:57:41,850 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:57:41,851 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:57:41,851 - trading_system - INFO - Created local data source
2025-03-09 10:58:37,333 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:58:37,375 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:58:37,376 - trading_system - INFO - Trading system initializing...
2025-03-09 10:58:37,396 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:58:37,397 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:58:37,398 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:58:37,399 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:58:37,399 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:58:37,400 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:58:37,400 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:58:37,401 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:58:37,402 - trading_system - INFO - Created local data source
2025-03-09 10:59:07,400 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 10:59:07,405 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 10:59:07,406 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 10:59:07,407 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:59:07,409 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:59:07,411 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:59:07,992 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:59:07,994 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:59:07,999 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:59:08,000 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:59:08,001 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:59:08,002 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:59:08,003 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:59:08,004 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:59:08,010 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:59:08,011 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:59:08,011 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:59:08,012 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:59:08,013 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:59:08,015 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:59:08,015 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 10:59:08,016 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 10:59:08,017 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 10:59:08,019 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:59:08,020 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 10:59:08,020 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:59:08,021 - system.execution - INFO - Execution engine closed
2025-03-09 10:59:08,022 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:59:08,022 - trading_system - INFO - Initiating system shutdown...
2025-03-09 10:59:08,023 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:59:08,023 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 10:59:08,024 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:59:08,024 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:59:08,026 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:59:16,737 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:59:16,778 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:59:16,778 - trading_system - INFO - Trading system initializing...
2025-03-09 10:59:16,785 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:59:16,786 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:59:16,786 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:59:16,787 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:59:16,788 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:59:16,789 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:59:16,790 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:59:16,791 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:59:16,792 - trading_system - INFO - Created local data source
2025-03-09 10:59:26,276 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 10:59:26,284 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 10:59:26,286 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 10:59:26,287 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 10:59:26,289 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 10:59:26,292 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 10:59:26,807 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:59:26,809 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 10:59:26,814 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 10:59:26,815 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 10:59:26,816 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 10:59:26,817 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 10:59:26,818 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 10:59:26,818 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 10:59:26,824 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 10:59:26,833 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 10:59:26,834 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 10:59:26,835 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:59:26,835 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 10:59:26,837 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 10:59:26,838 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 10:59:26,839 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 10:59:26,839 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 10:59:26,841 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:59:26,841 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 10:59:26,842 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:59:26,842 - system.execution - INFO - Execution engine closed
2025-03-09 10:59:26,842 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:59:26,843 - trading_system - INFO - Initiating system shutdown...
2025-03-09 10:59:26,843 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 10:59:26,843 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 10:59:26,844 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 10:59:26,844 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 10:59:26,845 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 10:59:54,311 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 10:59:54,358 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 10:59:54,360 - trading_system - INFO - Trading system initializing...
2025-03-09 10:59:54,375 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 10:59:54,377 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 10:59:54,378 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 10:59:54,379 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 10:59:54,380 - trading_system - INFO - Starting trading pipeline...
2025-03-09 10:59:54,381 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 10:59:54,382 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 10:59:54,383 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 10:59:54,385 - trading_system - INFO - Created local data source
2025-03-09 11:02:24,187 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:02:24,225 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:02:24,225 - trading_system - INFO - Trading system initializing...
2025-03-09 11:02:24,233 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:02:24,235 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:02:24,235 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:02:24,236 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:02:24,236 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:02:24,236 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:02:24,237 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:02:24,238 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:02:24,238 - trading_system - INFO - Created local data source
2025-03-09 11:03:06,024 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:03:06,056 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:03:06,057 - trading_system - INFO - Trading system initializing...
2025-03-09 11:03:06,064 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:03:06,065 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:03:06,066 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:03:06,066 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:03:06,067 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:03:06,067 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:06,069 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:03:06,070 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:03:06,070 - trading_system - INFO - Created local data source
2025-03-09 11:03:08,419 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 11:03:08,428 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 11:03:08,430 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 11:03:08,431 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:03:08,434 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:03:08,438 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:03:08,915 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:03:08,917 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:03:08,923 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:03:08,924 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:03:08,924 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:03:08,925 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:03:08,927 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:03:08,928 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:03:08,933 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:03:08,933 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:03:08,934 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:03:08,934 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:08,935 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:03:08,936 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:03:08,937 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 11:03:08,938 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 11:03:08,939 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 11:03:08,940 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:03:08,941 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 11:03:08,941 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:03:08,941 - system.execution - INFO - Execution engine closed
2025-03-09 11:03:08,942 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:03:08,942 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:03:08,943 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:03:08,943 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 11:03:08,944 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:03:08,944 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:03:08,946 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:03:15,439 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:03:15,481 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:03:15,482 - trading_system - INFO - Trading system initializing...
2025-03-09 11:03:15,489 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:03:15,490 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:03:15,491 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:03:15,491 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:03:15,492 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:03:15,492 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:15,493 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:03:15,494 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:03:15,495 - trading_system - INFO - Created local data source
2025-03-09 11:03:15,495 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 11:03:15,498 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 11:03:15,499 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 11:03:15,499 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:03:15,500 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:03:15,502 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:03:15,952 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:03:15,954 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:03:15,959 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:03:15,960 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:03:15,962 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:03:15,962 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:03:15,963 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:03:15,963 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:03:15,964 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:03:15,965 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:03:15,966 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:03:15,966 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:15,967 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:03:15,969 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:03:15,969 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 11:03:15,970 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 11:03:15,971 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 11:03:15,972 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:03:15,972 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 11:03:15,973 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:03:15,973 - system.execution - INFO - Execution engine closed
2025-03-09 11:03:15,983 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:03:15,984 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:03:15,985 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:03:15,985 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 11:03:15,985 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:03:15,986 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:03:15,988 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:03:26,656 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:03:26,690 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:03:26,691 - trading_system - INFO - Trading system initializing...
2025-03-09 11:03:26,701 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:03:26,702 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:03:26,703 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:03:26,703 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:03:26,703 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:03:26,704 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:26,705 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:03:26,705 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:03:26,706 - trading_system - INFO - Created local data source
2025-03-09 11:03:30,229 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 11:03:30,234 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 95, in _connect_exchange
    headers = self.config.get('api', 'headers', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 11:03:30,236 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 11:03:30,237 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:03:30,238 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:03:30,241 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:03:30,695 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:03:30,698 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:03:30,702 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:03:30,703 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:03:30,704 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:03:30,705 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:03:30,706 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:03:30,706 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:03:30,707 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:03:30,708 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:03:30,709 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:03:30,709 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:30,710 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:03:30,712 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:03:30,713 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 11:03:30,714 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 11:03:30,715 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 11:03:30,717 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:03:30,717 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 11:03:30,718 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:03:30,719 - system.execution - INFO - Execution engine closed
2025-03-09 11:03:30,719 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:03:30,720 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:03:30,720 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:03:30,721 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 11:03:30,721 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:03:30,722 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:03:30,724 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:03:35,278 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:03:35,316 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:03:35,317 - trading_system - INFO - Trading system initializing...
2025-03-09 11:03:35,326 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:03:35,328 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:03:35,328 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:03:35,329 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:03:35,329 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:03:35,330 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:35,330 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:03:35,331 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:03:35,332 - trading_system - INFO - Created local data source
2025-03-09 11:03:40,439 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:03:40,475 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:03:40,476 - trading_system - INFO - Trading system initializing...
2025-03-09 11:03:40,484 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:03:40,486 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:03:40,486 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:03:40,488 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:03:40,488 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:03:40,489 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:03:40,489 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:03:40,489 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:03:40,489 - trading_system - INFO - Created local data source
2025-03-09 11:04:11,466 - trading_system - ERROR - Failed to connect to Binance: unhashable type: 'dict'
2025-03-09 11:04:11,476 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 46, in __init__
    self._connect_exchange(load_market, retry_with_no_auth)
  File "D:\jacky\crypto_py\src\utils\error_handling.py", line 85, in sync_wrapper
    result = func(*args, **kwargs)
             ^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 100, in _connect_exchange
    proxies = self.config.get('proxies', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 11:04:11,479 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 11:04:11,480 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:04:11,483 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:04:11,485 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:04:12,035 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:04:12,037 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:04:12,042 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:04:12,044 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:04:12,045 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:04:12,046 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:04:12,047 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:04:12,047 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:04:12,053 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:04:12,054 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:04:12,055 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:04:12,055 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:04:12,056 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:04:12,058 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:04:12,058 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 11:04:12,060 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 11:04:12,060 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 11:04:12,062 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:04:12,063 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 11:04:12,063 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:04:12,064 - system.execution - INFO - Execution engine closed
2025-03-09 11:04:12,064 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:04:12,066 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:04:12,066 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:04:12,067 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 11:04:12,067 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:04:12,067 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:04:12,070 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:11:12,469 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:11:12,507 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:11:12,508 - trading_system - INFO - Trading system initializing...
2025-03-09 11:11:12,515 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:11:12,516 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:11:12,517 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:11:12,517 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:11:12,518 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:11:12,518 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:11:12,519 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:11:12,519 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:11:12,520 - trading_system - INFO - Created local data source
2025-03-09 11:11:21,094 - trading_system - INFO - API credentials found in configuration
2025-03-09 11:11:31,116 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:11:31,154 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:11:31,155 - trading_system - INFO - Trading system initializing...
2025-03-09 11:11:31,165 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:11:31,167 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:11:31,168 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:11:31,168 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:11:31,169 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:11:31,170 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:11:31,171 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:11:31,172 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:11:31,172 - trading_system - INFO - Created local data source
2025-03-09 11:12:11,453 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:12:11,455 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:12:12,001 - trading_system - INFO - Connection successful. Server time synchronized (diff: 457ms)
2025-03-09 11:12:12,472 - trading_system - INFO - Authentication successful
2025-03-09 11:12:12,954 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:12:12,955 - trading_system - INFO - Binance interface initialized
2025-03-09 11:12:12,957 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:12:12,958 - trading_system - INFO - Created exchange data source
2025-03-09 11:12:12,960 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:12:12,961 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:12:12,964 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:12:12,969 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:12:13,467 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:12:13,469 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:12:13,473 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:12:13,475 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:12:13,476 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:12:13,477 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:12:13,478 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:12:13,478 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:12:13,479 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:12:13,480 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:12:13,480 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:12:13,481 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:12:13,481 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:12:13,482 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:12:13,484 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 11:12:13,485 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 11:12:13,624 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:12:13,625 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:12:13,625 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 11:12:16,800 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741489933627&recvWindow=60000&signature=46234f18e088e834abac021f264d71e4a644a2c0cf6c90d6140e16bbbe66aa51
2025-03-09 11:12:21,885 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741489938875&recvWindow=60000&signature=73350865e6be9a177520a0b7ceffd0a7406a500708738356bdd191ca385f28df
2025-03-09 11:12:28,979 - trading_system - ERROR - Chunk 1/1 fetch failed after max retries: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741489945967&recvWindow=60000&signature=46cc7eb8df6197d9ee1c4042a6066bb9e8aa9ac4ecba28f5122e7b100482c5fb
2025-03-09 11:12:28,983 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:12:28,987 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 11:12:28,992 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 11:12:28,997 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 11:12:29,004 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 11:12:29,009 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 11:12:29,025 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:12:29,028 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 11:12:29,031 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:12:29,035 - system.execution - INFO - Execution engine closed
2025-03-09 11:12:29,038 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:12:29,042 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:12:29,046 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:12:29,050 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 11:12:29,054 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:12:29,056 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:12:29,067 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...b100482c5fb')>)
handle: <Handle Task.task_wakeup(<Task finishe...b100482c5fb')>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:13:05,823 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:13:05,867 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:13:05,868 - trading_system - INFO - Trading system initializing...
2025-03-09 11:13:05,877 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:13:05,878 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:13:05,879 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:13:05,880 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:13:05,880 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:13:05,881 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:13:05,882 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:13:05,882 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:13:05,883 - trading_system - INFO - Created local data source
2025-03-09 11:13:05,883 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:13:05,885 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:13:29,197 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:13:29,230 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:13:29,230 - trading_system - INFO - Trading system initializing...
2025-03-09 11:13:29,238 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:13:29,239 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:13:29,240 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:13:29,240 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:13:29,241 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:13:29,241 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:13:29,242 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:13:29,243 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:13:29,243 - trading_system - INFO - Created local data source
2025-03-09 11:13:29,243 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:13:29,244 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:13:29,673 - trading_system - INFO - Connection successful. Server time synchronized (diff: 466ms)
2025-03-09 11:14:04,358 - trading_system - INFO - Authentication successful
2025-03-09 11:14:32,598 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:14:32,602 - trading_system - INFO - Binance interface initialized
2025-03-09 11:14:32,604 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:14:32,605 - trading_system - INFO - Created exchange data source
2025-03-09 11:14:32,607 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:14:32,608 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:14:32,611 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:14:32,615 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:14:33,097 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:14:33,099 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:14:33,104 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:14:33,106 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:14:33,106 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:14:33,107 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:14:33,107 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:14:33,108 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:14:33,115 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:14:33,116 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:14:33,116 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:14:33,117 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:14:33,117 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:14:33,119 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:14:33,120 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 11:14:33,121 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 11:14:33,242 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:14:33,243 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:14:33,243 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 11:14:36,415 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490073245&recvWindow=60000&signature=93b10f0b78763d8aae44b31791577c93d120eb5ec472054915ee21ff2663e6cc
2025-03-09 11:14:41,497 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490078479&recvWindow=60000&signature=f3d6fe93d4c52c74373be655ab5b87377b053155f98891fdf0fe86c25f52ccb4
2025-03-09 11:16:02,486 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:16:02,520 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:16:02,521 - trading_system - INFO - Trading system initializing...
2025-03-09 11:16:02,532 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:16:02,533 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:16:02,533 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:16:02,535 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:16:02,535 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:16:02,535 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:16:02,536 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:16:02,538 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:16:02,539 - trading_system - INFO - Created local data source
2025-03-09 11:16:02,539 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:16:02,540 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:17:04,559 - trading_system - INFO - Connection successful. Server time synchronized (diff: 463ms)
2025-03-09 11:17:04,935 - trading_system - INFO - Authentication successful
2025-03-09 11:17:05,470 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:17:05,471 - trading_system - INFO - Binance interface initialized
2025-03-09 11:17:05,472 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:17:05,473 - trading_system - INFO - Created exchange data source
2025-03-09 11:17:05,475 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:17:05,476 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:17:05,477 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:17:05,480 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:17:05,973 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:17:05,976 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:17:05,981 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:17:05,982 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:17:05,983 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:17:05,983 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:17:05,985 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:17:05,986 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:17:05,987 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:17:05,988 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:17:05,989 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:17:05,989 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:17:05,990 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:17:05,992 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:17:05,992 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 11:17:05,993 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 11:17:06,139 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:17:06,140 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:17:06,141 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 11:17:09,364 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490226142&recvWindow=60000&signature=3656c3295366f095af3b6c09e9558e8086dacd477bc74ccc85c8a59f5d16ee51
2025-03-09 11:17:14,458 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 2/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490231442&recvWindow=60000&signature=4771cb2685cb00e5f7ca18c797b9fa5345807755bfaa2441816dd782a4fdbfe6
2025-03-09 11:17:21,540 - trading_system - ERROR - Chunk 1/1 fetch failed after max retries: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490238526&recvWindow=60000&signature=a4972954c6494d263ce84402e69595cb4ec7cd92924e9d24e851b1200f2e7a9f
2025-03-09 11:17:21,543 - trading_system - WARNING - No data retrieved for: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:17:21,545 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 11:17:21,547 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 11:17:21,548 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-12-01-2023-12-31
2025-03-09 11:17:21,552 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 11:17:21,554 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 11:17:21,561 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:17:21,562 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 11:17:21,563 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:17:21,566 - system.execution - INFO - Execution engine closed
2025-03-09 11:17:21,567 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:17:21,568 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:17:21,569 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 11:17:21,570 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 11:17:21,571 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 11:17:21,572 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 11:17:21,575 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...1200f2e7a9f')>)
handle: <Handle Task.task_wakeup(<Task finishe...1200f2e7a9f')>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:17:48,448 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:17:48,479 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:17:48,479 - trading_system - INFO - Trading system initializing...
2025-03-09 11:17:48,488 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:17:48,489 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:17:48,490 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:17:48,490 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:17:48,491 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:17:48,491 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:17:48,492 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:17:48,492 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:17:48,493 - trading_system - INFO - Created local data source
2025-03-09 11:17:48,494 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:17:48,494 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:17:48,849 - trading_system - INFO - Connection successful. Server time synchronized (diff: 457ms)
2025-03-09 11:17:49,193 - trading_system - INFO - Authentication successful
2025-03-09 11:17:49,716 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:17:49,717 - trading_system - INFO - Binance interface initialized
2025-03-09 11:17:49,718 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:17:49,719 - trading_system - INFO - Created exchange data source
2025-03-09 11:17:49,721 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:17:49,722 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:17:49,723 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:17:49,727 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:17:50,183 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:17:50,186 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:17:50,191 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:17:50,192 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:17:50,194 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:17:50,194 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:17:50,195 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:17:50,196 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:17:50,197 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:17:50,198 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:17:50,199 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:17:50,199 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:17:50,200 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:17:50,201 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:17:50,201 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 11:17:50,202 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 11:17:50,329 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:17:50,330 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:17:50,331 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 11:18:05,917 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490282750&recvWindow=60000&signature=8f68e1060ffc15560f893056c3a25a09619c657d8551239e8a48cb728f091710
2025-03-09 11:19:15,519 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:19:15,551 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:19:15,552 - trading_system - INFO - Trading system initializing...
2025-03-09 11:19:15,559 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:19:15,559 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:19:15,559 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:19:15,560 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:19:15,560 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:19:15,562 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:19:15,562 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:19:15,563 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:19:15,563 - trading_system - INFO - Created local data source
2025-03-09 11:20:56,469 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:20:56,470 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:20:56,811 - trading_system - INFO - Connection successful. Server time synchronized (diff: 459ms)
2025-03-09 11:20:57,124 - trading_system - INFO - Authentication successful
2025-03-09 11:20:57,615 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:20:57,616 - trading_system - INFO - Binance interface initialized
2025-03-09 11:20:57,618 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:20:57,619 - trading_system - INFO - Created exchange data source
2025-03-09 11:20:57,620 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:20:57,620 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:20:57,622 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:20:57,624 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:20:58,129 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:20:58,132 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:20:58,136 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:20:58,137 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:20:58,138 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:20:58,139 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:20:58,140 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:20:58,140 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:20:58,147 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:20:58,148 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:20:58,149 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:20:58,150 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:20:58,150 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:20:58,153 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:20:58,153 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 11:20:58,153 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 11:20:58,309 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:20:58,310 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:20:58,310 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 11:21:58,104 - trading_system - WARNING - Chunk 1/1 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741490514897&recvWindow=60000&signature=3582bce4d15e8cbbd3550ce5d0c2e71318e4dd73f79dd5c82f53778b204db2de
2025-03-09 11:25:54,591 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:25:54,623 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:25:54,624 - trading_system - INFO - Trading system initializing...
2025-03-09 11:25:54,631 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:25:54,633 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:25:54,634 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:25:54,634 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:25:54,634 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:25:54,635 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:25:54,635 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:25:54,636 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:25:54,637 - trading_system - INFO - Created local data source
2025-03-09 11:26:28,849 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:26:28,882 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:26:28,882 - trading_system - INFO - Trading system initializing...
2025-03-09 11:26:28,890 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:26:28,891 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:26:28,892 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:26:28,892 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:26:28,893 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:26:28,893 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:26:28,894 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:26:28,895 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:26:28,895 - trading_system - INFO - Created local data source
2025-03-09 11:26:28,896 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:26:28,897 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:26:29,278 - trading_system - INFO - Connection successful. Server time synchronized (diff: 464ms)
2025-03-09 11:26:29,643 - trading_system - INFO - Authentication successful
2025-03-09 11:26:30,222 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:26:30,224 - trading_system - INFO - Binance interface initialized
2025-03-09 11:26:30,225 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:26:30,226 - trading_system - INFO - Created exchange data source
2025-03-09 11:26:30,227 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:26:30,229 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:26:30,231 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:26:30,235 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:26:30,741 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:26:30,743 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:26:30,748 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:26:30,750 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:26:30,751 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:26:30,751 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:26:30,752 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:26:30,752 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:26:30,753 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:26:30,754 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:26:30,755 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:26:30,756 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:26:30,756 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:26:30,758 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:26:30,758 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-12-01-2023-12-31，尝试从交易所下载
2025-03-09 11:26:30,759 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-12-01 - 2023-12-31
2025-03-09 11:26:30,897 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-12-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:26:30,898 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-12-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:26:30,898 - trading_system - INFO - Request divided into 1 chunks
2025-03-09 11:27:03,047 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:27:03,082 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:27:03,082 - trading_system - INFO - Trading system initializing...
2025-03-09 11:27:03,090 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:27:03,091 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:27:03,092 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:27:03,093 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:27:03,093 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:27:03,094 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:27:03,094 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:27:03,096 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:27:03,096 - trading_system - INFO - Created local data source
2025-03-09 11:36:34,232 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:36:34,299 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:36:34,300 - trading_system - INFO - Trading system initializing...
2025-03-09 11:36:34,309 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:36:34,310 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:36:34,311 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:36:34,311 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:36:34,312 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:36:34,313 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:36:34,313 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:36:34,314 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:36:34,315 - trading_system - INFO - Created local data source
2025-03-09 11:36:34,323 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:36:34,325 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:36:34,326 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:36:35,045 - trading_system - INFO - Connection successful. Server time synchronized (diff: 571ms)
2025-03-09 11:36:35,798 - trading_system - INFO - Authentication successful
2025-03-09 11:36:36,298 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:36:36,299 - trading_system - INFO - Binance interface initialized
2025-03-09 11:36:36,300 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:36:36,301 - trading_system - INFO - Created exchange data source
2025-03-09 11:36:36,302 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:36:36,303 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:36:36,304 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:36:36,307 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:36:36,834 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:36:36,837 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:36:36,842 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:36:36,844 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:36:36,844 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:36:36,845 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:36:36,846 - system.strategyfactory - WARNING - 使用标准方法加载策略 simple 失败: 未知类型: simple，尝试替代方法
2025-03-09 11:36:36,847 - system.strategyfactory - ERROR - 创建失败: 未知策略: simple
2025-03-09 11:36:36,848 - system.tradingmodefactory - ERROR - 创建 backtest 失败: 未知策略: simple
2025-03-09 11:36:36,848 - system.tradingmodefactory - ERROR - 创建失败: 创建 backtest 失败: 未知策略: simple
2025-03-09 11:36:36,849 - trading_system - ERROR - Error in trading pipeline: 创建 backtest 失败: 未知策略: simple
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 146, in _get_concrete_class
    return await self._load_class_from_path(name, BaseStrategy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 303, in _load_class_from_path
    raise ValueError(f"未知类型: {name}")
ValueError: 未知类型: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 222, in _get_or_create
    await instance.initialize()
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 29, in initialize
    self.strategy = await self.strategy_factory.create(strategy_name, strategy_params)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 70, in create
    concrete_class = await self._get_concrete_class(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 152, in _get_concrete_class
    raise ValueError(f"未知策略: {name}")
ValueError: 未知策略: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\core\core.py", line 65, in run_pipeline
    self.trading_mode = await self.mode_factory.create(self.mode)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 73, in create
    return await self._get_or_create(name, concrete_class, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 231, in _get_or_create
    raise ValueError(f"创建 {name} 失败: {e}")
ValueError: 创建 backtest 失败: 未知策略: simple
2025-03-09 11:36:36,854 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:36:36,854 - trading_system - WARNING - Trading mode not properly initialized, skipping shutdown
2025-03-09 11:36:36,856 - asyncio - ERROR - Exception in callback <TaskStepMethWrapper object at 0x000001A4ABB1F490>()
handle: <Handle <TaskStepMethWrapper object at 0x000001A4ABB1F490>()>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:38:22,442 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:38:22,478 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:38:22,478 - trading_system - INFO - Trading system initializing...
2025-03-09 11:38:22,485 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:38:22,486 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:38:22,486 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:38:22,487 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:38:22,488 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:38:22,489 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:38:22,489 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:38:22,490 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:38:22,491 - trading_system - INFO - Created local data source
2025-03-09 11:38:22,501 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:38:22,501 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:38:22,502 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:38:23,258 - trading_system - INFO - Connection successful. Server time synchronized (diff: 572ms)
2025-03-09 11:38:23,555 - trading_system - INFO - Authentication successful
2025-03-09 11:38:24,032 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:38:24,034 - trading_system - INFO - Binance interface initialized
2025-03-09 11:38:24,036 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:38:24,037 - trading_system - INFO - Created exchange data source
2025-03-09 11:38:24,038 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:38:24,039 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:38:24,042 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:38:24,044 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:38:24,552 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:38:24,554 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:38:24,560 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:38:24,561 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:38:24,562 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:38:24,562 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:38:24,563 - system.strategyfactory - WARNING - 使用标准方法加载策略 simple 失败: 未知类型: simple，尝试替代方法
2025-03-09 11:38:24,564 - system.strategyfactory - ERROR - 创建失败: 未知策略: simple
2025-03-09 11:38:24,564 - system.tradingmodefactory - ERROR - 创建 backtest 失败: 未知策略: simple
2025-03-09 11:38:24,564 - system.tradingmodefactory - ERROR - 创建失败: 创建 backtest 失败: 未知策略: simple
2025-03-09 11:38:24,566 - trading_system - ERROR - Error in trading pipeline: 创建 backtest 失败: 未知策略: simple
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 146, in _get_concrete_class
    return await self._load_class_from_path(name, BaseStrategy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 303, in _load_class_from_path
    raise ValueError(f"未知类型: {name}")
ValueError: 未知类型: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 222, in _get_or_create
    await instance.initialize()
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 29, in initialize
    self.strategy = await self.strategy_factory.create(strategy_name, strategy_params)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 70, in create
    concrete_class = await self._get_concrete_class(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 152, in _get_concrete_class
    raise ValueError(f"未知策略: {name}")
ValueError: 未知策略: simple

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\core\core.py", line 65, in run_pipeline
    self.trading_mode = await self.mode_factory.create(self.mode)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 73, in create
    return await self._get_or_create(name, concrete_class, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 231, in _get_or_create
    raise ValueError(f"创建 {name} 失败: {e}")
ValueError: 创建 backtest 失败: 未知策略: simple
2025-03-09 11:38:24,570 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:38:24,571 - trading_system - WARNING - Trading mode not properly initialized, skipping shutdown
2025-03-09 11:38:24,573 - asyncio - ERROR - Exception in callback <TaskStepMethWrapper object at 0x000001777FB2B490>()
handle: <Handle <TaskStepMethWrapper object at 0x000001777FB2B490>()>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:39:27,576 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:39:27,633 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:39:27,634 - trading_system - INFO - Trading system initializing...
2025-03-09 11:39:27,644 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:39:27,645 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:39:27,645 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:39:27,647 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:39:27,647 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:39:27,649 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:39:27,649 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:39:27,650 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:39:27,651 - trading_system - INFO - Created local data source
2025-03-09 11:39:27,661 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:39:27,661 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:39:27,662 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:39:28,051 - trading_system - INFO - Connection successful. Server time synchronized (diff: 472ms)
2025-03-09 11:39:28,362 - trading_system - INFO - Authentication successful
2025-03-09 11:39:28,930 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:39:28,932 - trading_system - INFO - Binance interface initialized
2025-03-09 11:39:28,933 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:39:28,934 - trading_system - INFO - Created exchange data source
2025-03-09 11:39:28,936 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:39:28,937 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:39:28,939 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:39:28,944 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:39:29,441 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:39:29,443 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:39:29,447 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:39:29,449 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:39:29,449 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:39:29,450 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:39:29,451 - system.strategyfactory - WARNING - 使用标准方法加载策略 dualma 失败: 未知类型: dualma，尝试替代方法
2025-03-09 11:39:29,452 - system.strategyfactory - ERROR - 创建失败: 未知策略: dualma
2025-03-09 11:39:29,452 - system.tradingmodefactory - ERROR - 创建 backtest 失败: 未知策略: dualma
2025-03-09 11:39:29,453 - system.tradingmodefactory - ERROR - 创建失败: 创建 backtest 失败: 未知策略: dualma
2025-03-09 11:39:29,453 - trading_system - ERROR - Error in trading pipeline: 创建 backtest 失败: 未知策略: dualma
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 146, in _get_concrete_class
    return await self._load_class_from_path(name, BaseStrategy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 303, in _load_class_from_path
    raise ValueError(f"未知类型: {name}")
ValueError: 未知类型: dualma

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 222, in _get_or_create
    await instance.initialize()
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 29, in initialize
    self.strategy = await self.strategy_factory.create(strategy_name, strategy_params)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 70, in create
    concrete_class = await self._get_concrete_class(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 152, in _get_concrete_class
    raise ValueError(f"未知策略: {name}")
ValueError: 未知策略: dualma

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\core\core.py", line 65, in run_pipeline
    self.trading_mode = await self.mode_factory.create(self.mode)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 73, in create
    return await self._get_or_create(name, concrete_class, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 231, in _get_or_create
    raise ValueError(f"创建 {name} 失败: {e}")
ValueError: 创建 backtest 失败: 未知策略: dualma
2025-03-09 11:39:29,458 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:39:29,458 - trading_system - WARNING - Trading mode not properly initialized, skipping shutdown
2025-03-09 11:39:29,460 - asyncio - ERROR - Exception in callback <TaskStepMethWrapper object at 0x000001ECAB01F490>()
handle: <Handle <TaskStepMethWrapper object at 0x000001ECAB01F490>()>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:39:45,782 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:39:45,854 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:39:45,855 - trading_system - INFO - Trading system initializing...
2025-03-09 11:39:45,863 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:39:45,864 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:39:45,865 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:39:45,866 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:39:45,866 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:39:45,867 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:39:45,867 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:39:45,868 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:39:45,868 - trading_system - INFO - Created local data source
2025-03-09 11:39:45,877 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:39:45,878 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:39:45,878 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:39:46,233 - trading_system - INFO - Connection successful. Server time synchronized (diff: 470ms)
2025-03-09 11:39:46,621 - trading_system - INFO - Authentication successful
2025-03-09 11:39:47,149 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:39:47,151 - trading_system - INFO - Binance interface initialized
2025-03-09 11:39:47,152 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:39:47,153 - trading_system - INFO - Created exchange data source
2025-03-09 11:39:47,154 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:39:47,155 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:39:47,157 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:39:47,159 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:39:47,633 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:39:47,636 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:39:47,641 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:39:47,642 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:39:47,643 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:39:47,644 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:39:47,645 - system.strategyfactory - WARNING - 使用标准方法加载策略 dualma 失败: 未知类型: dualma，尝试替代方法
2025-03-09 11:39:47,646 - system.strategyfactory - ERROR - 创建失败: 未知策略: dualma
2025-03-09 11:39:47,649 - system.tradingmodefactory - ERROR - 创建 backtest 失败: 未知策略: dualma
2025-03-09 11:39:47,651 - system.tradingmodefactory - ERROR - 创建失败: 创建 backtest 失败: 未知策略: dualma
2025-03-09 11:39:47,653 - trading_system - ERROR - Error in trading pipeline: 创建 backtest 失败: 未知策略: dualma
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 146, in _get_concrete_class
    return await self._load_class_from_path(name, BaseStrategy)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 303, in _load_class_from_path
    raise ValueError(f"未知类型: {name}")
ValueError: 未知类型: dualma

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 222, in _get_or_create
    await instance.initialize()
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 29, in initialize
    self.strategy = await self.strategy_factory.create(strategy_name, strategy_params)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 70, in create
    concrete_class = await self._get_concrete_class(name)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\strategy\strategy_factory.py", line 152, in _get_concrete_class
    raise ValueError(f"未知策略: {name}")
ValueError: 未知策略: dualma

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\core\core.py", line 65, in run_pipeline
    self.trading_mode = await self.mode_factory.create(self.mode)
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 73, in create
    return await self._get_or_create(name, concrete_class, params)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\abstract_factory.py", line 231, in _get_or_create
    raise ValueError(f"创建 {name} 失败: {e}")
ValueError: 创建 backtest 失败: 未知策略: dualma
2025-03-09 11:39:47,664 - trading_system - INFO - Initiating system shutdown...
2025-03-09 11:39:47,666 - trading_system - WARNING - Trading mode not properly initialized, skipping shutdown
2025-03-09 11:39:47,669 - asyncio - ERROR - Exception in callback <TaskStepMethWrapper object at 0x00000165D8DCF490>()
handle: <Handle <TaskStepMethWrapper object at 0x00000165D8DCF490>()>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 11:40:26,450 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:40:26,504 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:40:26,506 - trading_system - INFO - Trading system initializing...
2025-03-09 11:40:26,513 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:40:26,514 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:40:26,514 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:40:26,516 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:40:26,517 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:40:26,517 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:40:26,518 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:40:26,520 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:40:26,520 - trading_system - INFO - Created local data source
2025-03-09 11:40:26,529 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:40:26,530 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:40:26,530 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:40:26,858 - trading_system - INFO - Connection successful. Server time synchronized (diff: 473ms)
2025-03-09 11:40:27,147 - trading_system - INFO - Authentication successful
2025-03-09 11:40:27,711 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:40:27,712 - trading_system - INFO - Binance interface initialized
2025-03-09 11:40:27,713 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:40:27,714 - trading_system - INFO - Created exchange data source
2025-03-09 11:40:27,716 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:40:27,717 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:40:27,719 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:40:27,723 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:40:28,182 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:40:28,184 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:40:28,190 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:40:28,191 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:40:28,191 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:40:28,192 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:40:28,193 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:40:28,193 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:40:28,194 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:40:28,195 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:40:28,196 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:40:28,197 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:40:28,197 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:40:28,200 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:40:28,200 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2022-01-01-2023-12-31，尝试从交易所下载
2025-03-09 11:40:28,201 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2022-01-01 - 2023-12-31
2025-03-09 11:40:28,361 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2022-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:40:28,361 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2022-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:40:28,362 - trading_system - INFO - Request divided into 9 chunks
2025-03-09 11:40:55,020 - trading_system - WARNING - Chunk 1/9 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741491633777&recvWindow=60000&signature=a79b1ca363e9234262ef2dee29f95f84b80bb0dab277f66d18ce86c5537f5aeb
2025-03-09 11:41:18,164 - trading_system - WARNING - Chunk 1/9 fetch failed, retry 2/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741491657098&recvWindow=60000&signature=c2cb07376d604520c6a89e5f086fb964a7d87cddd78c85acb11f96098a8b9ce6
2025-03-09 11:41:25,867 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:41:25,909 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:41:25,910 - trading_system - INFO - Trading system initializing...
2025-03-09 11:41:25,921 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:41:25,922 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:41:25,923 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:41:25,924 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:41:25,924 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:41:25,925 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:41:25,926 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:41:25,926 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:41:25,927 - trading_system - INFO - Created local data source
2025-03-09 11:41:25,936 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:41:25,936 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:41:25,937 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:41:26,324 - trading_system - INFO - Connection successful. Server time synchronized (diff: 477ms)
2025-03-09 11:41:26,745 - trading_system - INFO - Authentication successful
2025-03-09 11:41:27,290 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:41:27,291 - trading_system - INFO - Binance interface initialized
2025-03-09 11:41:27,293 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:41:27,294 - trading_system - INFO - Created exchange data source
2025-03-09 11:41:27,295 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:41:27,297 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:41:27,299 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:41:27,302 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:41:27,771 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:41:27,773 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:41:27,778 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:41:27,780 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:41:27,780 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:41:27,781 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:41:27,782 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:41:27,783 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:41:27,784 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:41:27,784 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:41:27,785 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:41:27,786 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:41:27,787 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:41:27,789 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:41:27,790 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 11:41:27,790 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 11:41:27,926 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:41:27,926 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:41:27,927 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 11:41:49,213 - trading_system - WARNING - Chunk 1/5 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741491687929&recvWindow=60000&signature=5a44171e66c94165e478525a7d1416fa31ccc87213768b02357321d9d1c15dcd
2025-03-09 11:42:12,366 - trading_system - WARNING - Chunk 1/5 fetch failed, retry 2/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741491711319&recvWindow=60000&signature=c36849a61803cf7c17115ddbe077842f3964f75b1c96c185ca9522aa713ee0bf
2025-03-09 11:42:31,708 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:42:31,743 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:42:31,744 - trading_system - INFO - Trading system initializing...
2025-03-09 11:42:31,751 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:42:31,752 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:42:31,753 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:42:31,754 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:42:31,754 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:42:31,755 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:42:31,755 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:42:31,756 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:42:31,757 - trading_system - INFO - Created local data source
2025-03-09 11:43:40,406 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:43:40,439 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:43:40,440 - trading_system - INFO - Trading system initializing...
2025-03-09 11:43:40,448 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:43:40,450 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:43:40,450 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:43:40,450 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:43:40,450 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:43:40,450 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:43:40,452 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:43:40,452 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:43:40,453 - trading_system - INFO - Created local data source
2025-03-09 11:45:04,517 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:45:04,561 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:45:04,562 - trading_system - INFO - Trading system initializing...
2025-03-09 11:45:04,574 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:45:04,575 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:45:04,577 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:45:04,577 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:45:04,579 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:45:04,579 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:45:04,580 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:45:04,580 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:45:04,581 - trading_system - INFO - Created local data source
2025-03-09 11:45:53,981 - trading_system - INFO - Using API credentials from configuration file
2025-03-09 11:45:53,983 - trading_system - INFO - Using proxy configuration from config file
2025-03-09 11:45:53,984 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:45:54,363 - trading_system - INFO - Connection successful. Server time synchronized (diff: 477ms)
2025-03-09 11:45:55,146 - trading_system - INFO - Authentication successful
2025-03-09 11:45:55,655 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:45:55,658 - trading_system - INFO - Binance interface initialized
2025-03-09 11:45:55,660 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:45:55,662 - trading_system - INFO - Created exchange data source
2025-03-09 11:45:55,663 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:45:55,664 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:45:55,668 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:45:55,670 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:45:56,160 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:45:56,162 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:45:56,168 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:45:56,169 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:45:56,170 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:45:56,171 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:45:56,172 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:45:56,172 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:45:56,180 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:45:56,181 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:45:56,181 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:45:56,182 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:45:56,182 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:45:56,184 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:45:56,184 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 11:45:56,185 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 11:45:56,345 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:45:56,346 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:45:56,347 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 11:46:17,644 - trading_system - WARNING - Chunk 1/5 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741491956349&recvWindow=60000&signature=ba887393b1b728cbd7a8ac12129bf290a1aeb343ec74c2edb951b42e73fa6ad5
2025-03-09 11:46:40,053 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:46:40,096 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:46:40,097 - trading_system - INFO - Trading system initializing...
2025-03-09 11:46:40,108 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:46:40,109 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:46:40,109 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:46:40,110 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:46:40,111 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:46:40,112 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:46:40,113 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:46:40,114 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:46:40,115 - trading_system - INFO - Created local data source
2025-03-09 11:46:40,115 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:46:40,116 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:46:40,859 - trading_system - INFO - Connection successful. Server time synchronized (diff: 569ms)
2025-03-09 11:46:41,641 - trading_system - INFO - Authentication successful
2025-03-09 11:46:42,241 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:46:42,242 - trading_system - INFO - Binance interface initialized
2025-03-09 11:46:42,244 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:46:42,245 - trading_system - INFO - Created exchange data source
2025-03-09 11:46:42,246 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:46:42,246 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:46:42,249 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:46:42,251 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:46:42,750 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:46:42,752 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:46:42,757 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:46:42,758 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:46:42,759 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:46:42,760 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:46:42,761 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:46:42,762 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:46:42,767 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:46:42,768 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:46:42,769 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:46:42,769 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:46:42,770 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:46:42,772 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:46:42,773 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 11:46:42,773 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 11:46:42,919 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:46:42,920 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:46:42,920 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 11:46:54,768 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:46:54,809 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:46:54,809 - trading_system - INFO - Trading system initializing...
2025-03-09 11:46:54,818 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:46:54,819 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:46:54,819 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:46:54,820 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:46:54,821 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:46:54,821 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:46:54,822 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:46:54,823 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:46:54,823 - trading_system - INFO - Created local data source
2025-03-09 11:47:18,853 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:47:18,887 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:47:18,888 - trading_system - INFO - Trading system initializing...
2025-03-09 11:47:18,896 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:47:18,897 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:47:18,898 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:47:18,898 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:47:18,899 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:47:18,899 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:47:18,900 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:47:18,901 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:47:18,902 - trading_system - INFO - Created local data source
2025-03-09 11:47:25,326 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:47:25,328 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:47:25,329 - trading_system - INFO - {'timeout': 60000, 'enableRateLimit': True, 'options': {'adjustForTimeDifference': True, 'recvWindow': 60000, 'defaultType': 'spot'}, 'apiKey': 'HbMs2aPHQfPNh097P8SGWl7PpcjyUUk6I4WURcn6SUaTWjJ8SM8jb4tYSZgLFoBX', 'secret': 'vVQe126DGUw9BNwSG4gkt9E2DTz1YtiGnP3KzmVWH8AFZJ1SAEsPdOexbuwT68ck', 'headers': {'Connection': 'close'}, 'proxies': {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}}
2025-03-09 11:57:42,770 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 11:57:42,805 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 11:57:42,805 - trading_system - INFO - Trading system initializing...
2025-03-09 11:57:42,813 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 11:57:42,814 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 11:57:42,814 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 11:57:42,815 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 11:57:42,816 - trading_system - INFO - Starting trading pipeline...
2025-03-09 11:57:42,816 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:57:42,816 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 11:57:42,818 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 11:57:42,818 - trading_system - INFO - Created local data source
2025-03-09 11:57:42,819 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 11:57:42,820 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 11:57:42,820 - trading_system - INFO - {'timeout': 60000, 'enableRateLimit': True, 'options': {'adjustForTimeDifference': True, 'recvWindow': 60000, 'defaultType': 'spot'}, 'apiKey': 'CFTnyAyxA7dKhm51WQk7BWKnkM7WyoX4KuQBzESWwQo73UbH4q3Nbd2bsAkDiWzl', 'secret': '7STNlR595VAzY4OY5Q3irLXNjl7gvpiVpUDibSPTXWgzTiZM10PXdt6yKz1fi3Ol', 'headers': {'Connection': 'close'}, 'proxies': {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}}
2025-03-09 11:57:52,114 - trading_system - INFO - Connection successful. Server time synchronized (diff: 478ms)
2025-03-09 11:57:52,528 - trading_system - INFO - Authentication successful
2025-03-09 11:57:53,015 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 11:57:53,019 - trading_system - INFO - Binance interface initialized
2025-03-09 11:57:53,021 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 11:57:53,024 - trading_system - INFO - Created exchange data source
2025-03-09 11:57:53,026 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 11:57:53,027 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 11:57:53,031 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 11:57:53,035 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 11:57:53,532 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:57:53,534 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 11:57:53,541 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 11:57:53,542 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 11:57:53,543 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 11:57:53,544 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 11:57:53,545 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 11:57:53,545 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 11:57:53,551 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 11:57:53,552 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 11:57:53,553 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 11:57:53,553 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 11:57:53,554 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 11:57:53,556 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 11:57:53,556 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 11:57:53,557 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 11:57:53,712 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 11:57:53,712 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 11:57:53,713 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 11:58:20,014 - trading_system - WARNING - Chunk 1/5 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741492678750&recvWindow=60000&signature=cf06bae60e0cb7e161cd2f2d702f8f9d8663af2273d7da55929d0168927214a4
2025-03-09 12:00:04,034 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:00:04,071 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:00:04,071 - trading_system - INFO - Trading system initializing...
2025-03-09 12:00:04,078 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:00:04,079 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:00:04,080 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:00:04,080 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:00:04,080 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:00:04,081 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:00:04,081 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:00:04,082 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:00:04,083 - trading_system - INFO - Created local data source
2025-03-09 12:00:04,083 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 12:00:04,084 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 12:00:04,414 - trading_system - INFO - Connection successful. Server time synchronized (diff: 482ms)
2025-03-09 12:00:04,717 - trading_system - INFO - Authentication successful
2025-03-09 12:00:05,231 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 12:00:05,233 - trading_system - INFO - Binance interface initialized
2025-03-09 12:00:05,234 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:00:05,236 - trading_system - INFO - Created exchange data source
2025-03-09 12:00:05,237 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:00:05,238 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:00:05,240 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:00:05,245 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:00:05,733 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:00:05,734 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:00:05,740 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:00:05,741 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:00:05,742 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:00:05,743 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:00:05,744 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:00:05,744 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:00:05,746 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:00:05,747 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:00:05,748 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:00:05,749 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:00:05,749 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:00:05,751 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:00:05,752 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:00:05,752 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:00:05,899 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:00:05,900 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 12:00:05,900 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 12:00:56,486 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:00:56,546 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:00:56,548 - trading_system - INFO - Trading system initializing...
2025-03-09 12:00:56,570 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:00:56,573 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:00:56,575 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:00:56,576 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:00:56,577 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:00:56,577 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:00:56,579 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:00:56,581 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:00:56,582 - trading_system - INFO - Created local data source
2025-03-09 12:00:56,582 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 12:00:56,583 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 12:00:56,912 - trading_system - INFO - Connection successful. Server time synchronized (diff: 484ms)
2025-03-09 12:00:57,295 - trading_system - INFO - Authentication successful
2025-03-09 12:00:57,816 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 12:00:57,817 - trading_system - INFO - Binance interface initialized
2025-03-09 12:00:57,819 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:00:57,820 - trading_system - INFO - Created exchange data source
2025-03-09 12:00:57,822 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:00:57,823 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:00:57,825 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:00:57,831 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:00:58,351 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:00:58,353 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:00:58,358 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:00:58,359 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:00:58,360 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:00:58,360 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:00:58,360 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:00:58,361 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:00:58,362 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:00:58,364 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:00:58,365 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:00:58,366 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:00:58,368 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:00:58,373 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:00:58,374 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:00:58,375 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:00:58,536 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:00:58,536 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 12:00:58,537 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 12:01:24,403 - trading_system - WARNING - Chunk 1/5 fetch failed, retry 1/3: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741492863055&recvWindow=60000&signature=358d70c73c1ef6ad2b41a8b2cbcd823c22a0872305879c299e3da0e29dae5f0c
2025-03-09 12:04:19,984 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:04:20,020 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:04:20,021 - trading_system - INFO - Trading system initializing...
2025-03-09 12:04:20,031 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:04:20,032 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:04:20,033 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:04:20,033 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:04:20,034 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:04:20,034 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:04:20,036 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:04:20,037 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:04:20,038 - trading_system - INFO - Created local data source
2025-03-09 12:04:20,038 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 12:04:20,039 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 12:04:20,379 - trading_system - INFO - Connection successful. Server time synchronized (diff: 487ms)
2025-03-09 12:04:23,608 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:04:23,648 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:04:23,648 - trading_system - INFO - Trading system initializing...
2025-03-09 12:04:23,662 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:04:23,664 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:04:23,664 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:04:23,666 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:04:23,666 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:04:23,667 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:04:23,668 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:04:23,668 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:04:23,670 - trading_system - INFO - Created local data source
2025-03-09 12:04:23,671 - trading_system - INFO - Using proxy configuration: {'http': 'http://127.0.0.1:7890', 'https': 'http://127.0.0.1:7890'}
2025-03-09 12:04:23,672 - trading_system - INFO - Initializing Binance exchange connections
2025-03-09 12:04:24,087 - trading_system - INFO - Connection successful. Server time synchronized (diff: 485ms)
2025-03-09 12:04:24,426 - trading_system - INFO - Authentication successful
2025-03-09 12:04:24,957 - trading_system - INFO - Current IP: 89.213.179.134
2025-03-09 12:04:24,958 - trading_system - INFO - Binance interface initialized
2025-03-09 12:04:24,959 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:04:24,960 - trading_system - INFO - Created exchange data source
2025-03-09 12:04:24,961 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:04:24,962 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:04:24,962 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:04:24,964 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:04:25,463 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:04:25,465 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:04:25,470 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:04:25,471 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:04:25,472 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:04:25,473 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:04:25,473 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:04:25,474 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:04:25,475 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:04:25,476 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:04:25,476 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:04:25,477 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:04:25,478 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:04:25,480 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:04:25,480 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:04:25,481 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:04:25,670 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:04:25,671 - trading_system - INFO - Starting smart OHLCV fetch: BTC/USDT 1h 2023-01-01 08:00:00+08:00 - 2023-12-31 08:00:00+08:00
2025-03-09 12:04:25,672 - trading_system - INFO - Request divided into 5 chunks
2025-03-09 12:04:46,928 - trading_system - ERROR - Error processing chunk 1: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741493065674&recvWindow=60000&signature=1de02c28f7e6e691fead8e934af18da9316c1039baa7594f176feaae7aecf78c
2025-03-09 12:21:40,037 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:21:40,078 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:21:40,079 - trading_system - INFO - Trading system initializing...
2025-03-09 12:21:40,086 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:21:40,088 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:21:40,088 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:21:40,089 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:21:40,089 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:21:40,090 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:21:40,090 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:21:40,091 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:21:40,091 - trading_system - INFO - Created local data source
2025-03-09 12:21:40,491 - trading_system - INFO - Connection successful
2025-03-09 12:21:40,493 - trading_system - INFO - Binance interface initialized
2025-03-09 12:21:40,495 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:21:40,497 - trading_system - INFO - Created exchange data source
2025-03-09 12:21:40,498 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:21:40,500 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:21:40,501 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:21:40,505 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:21:40,981 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:21:40,983 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:21:40,987 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:21:40,988 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:21:40,989 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:21:40,989 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:21:40,990 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:21:40,991 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:21:40,991 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:21:40,992 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:21:40,993 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:21:40,995 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:21:40,995 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:21:40,997 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:21:40,997 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:21:40,998 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:21:41,135 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:21:43,531 - trading_system - ERROR - Error processing chunk 1: binance GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&startTime=1672531200000&limit=1000&endTime=1679731200000
2025-03-09 12:21:45,688 - trading_system - ERROR - Error processing chunk 2: binance GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&startTime=1679731200000&limit=1000&endTime=1686931200000
2025-03-09 12:21:47,855 - trading_system - ERROR - Error processing chunk 3: binance GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&startTime=1686931200000&limit=1000&endTime=1694131200000
2025-03-09 12:21:50,037 - trading_system - ERROR - Error processing chunk 4: binance GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&startTime=1694131200000&limit=1000&endTime=1701331200000
2025-03-09 12:25:08,731 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:25:08,766 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:25:08,766 - trading_system - INFO - Trading system initializing...
2025-03-09 12:25:08,776 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:25:08,777 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:25:08,777 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:25:08,778 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:25:08,778 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:25:08,778 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:25:08,779 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:25:08,779 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:25:08,780 - trading_system - INFO - Created local data source
2025-03-09 12:25:09,189 - trading_system - INFO - Connection successful
2025-03-09 12:25:09,190 - trading_system - INFO - Binance interface initialized
2025-03-09 12:25:09,191 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:25:09,191 - trading_system - INFO - Created exchange data source
2025-03-09 12:25:09,192 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:25:09,193 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:25:09,194 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:25:09,197 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:25:09,720 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:25:09,723 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:25:09,728 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:25:09,729 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:25:09,730 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:25:09,731 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:25:09,732 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:25:09,732 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:25:09,733 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:25:09,735 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:25:09,735 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:25:09,737 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:25:09,737 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:25:09,740 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:25:09,740 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:25:09,741 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:25:09,956 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:25:09,957 - trading_system - INFO - Fetching BTC/USDT 1h data in 5 chunks
2025-03-09 12:25:36,127 - trading_system - WARNING - Error in chunk 1, attempt 1: binance GET https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1h&startTime=1672531200000&endTime=1679731200000&limit=1000
2025-03-09 12:32:42,579 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:32:42,622 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:32:42,622 - trading_system - INFO - Trading system initializing...
2025-03-09 12:32:43,044 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:32:43,045 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:32:43,045 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:32:43,046 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:32:43,047 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:32:43,047 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:32:43,047 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:32:43,049 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:32:43,050 - trading_system - INFO - Created local data source
2025-03-09 12:32:44,558 - trading_system - INFO - Connected to Binance API. Time diff: 609ms
2025-03-09 12:32:44,563 - trading_system - INFO - Binance interface initialized
2025-03-09 12:32:44,565 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:32:44,565 - trading_system - INFO - Created exchange data source
2025-03-09 12:32:44,565 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:32:44,565 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:32:44,568 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:32:44,569 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:32:45,068 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:32:45,070 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:32:45,075 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:32:45,077 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:32:45,078 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:32:45,078 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:32:45,079 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:32:45,080 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:32:45,082 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:32:45,083 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:32:45,084 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:32:45,084 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:32:45,085 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:32:45,087 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:32:45,088 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:32:45,088 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:32:45,248 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:32:45,248 - trading_system - INFO - Fetching BTC/USDT 1h data in 9 chunks
2025-03-09 12:32:46,190 - AsyncExecutor - ERROR - Error in task task_1923134884864_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:46,192 - trading_system - WARNING - Error fetching chunk 1/9: Expected coroutine, got list
2025-03-09 12:32:47,435 - AsyncExecutor - ERROR - Error in task task_1923079255104_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:47,437 - trading_system - WARNING - Error fetching chunk 2/9: Expected coroutine, got list
2025-03-09 12:32:48,658 - AsyncExecutor - ERROR - Error in task task_1923135701504_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:48,659 - trading_system - WARNING - Error fetching chunk 3/9: Expected coroutine, got list
2025-03-09 12:32:49,844 - AsyncExecutor - ERROR - Error in task task_1923129676544_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:49,845 - trading_system - WARNING - Error fetching chunk 4/9: Expected coroutine, got list
2025-03-09 12:32:51,030 - AsyncExecutor - ERROR - Error in task task_1923129615680_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:51,030 - trading_system - WARNING - Error fetching chunk 5/9: Expected coroutine, got list
2025-03-09 12:32:52,272 - AsyncExecutor - ERROR - Error in task task_1922270279488_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:52,273 - trading_system - WARNING - Error fetching chunk 6/9: Expected coroutine, got list
2025-03-09 12:32:53,506 - AsyncExecutor - ERROR - Error in task task_1923133017216_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:53,507 - trading_system - WARNING - Error fetching chunk 7/9: Expected coroutine, got list
2025-03-09 12:32:54,688 - AsyncExecutor - ERROR - Error in task task_1923134938496_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:54,689 - trading_system - WARNING - Error fetching chunk 8/9: Expected coroutine, got list
2025-03-09 12:32:56,001 - AsyncExecutor - ERROR - Error in task task_1923135702976_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:32:56,002 - trading_system - WARNING - Error fetching chunk 9/9: Expected coroutine, got list
2025-03-09 12:32:56,004 - trading_system - WARNING - No data retrieved for BTC/USDT 1h
2025-03-09 12:32:56,005 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 12:32:56,007 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 12:32:56,008 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 12:32:56,009 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 12:32:56,009 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 12:32:56,010 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 12:32:56,010 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 12:32:56,011 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 12:32:56,011 - system.execution - INFO - Execution engine closed
2025-03-09 12:32:56,012 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 12:32:56,012 - trading_system - INFO - Initiating system shutdown...
2025-03-09 12:32:56,013 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 12:32:56,013 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 12:32:56,013 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 12:32:56,015 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 12:32:56,016 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Future finished result=None>)
handle: <Handle Task.task_wakeup(<Future finished result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 12:40:21,101 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:40:21,174 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:40:21,175 - trading_system - INFO - Trading system initializing...
2025-03-09 12:40:21,485 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:40:21,487 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:40:21,487 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:40:21,488 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:40:21,489 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:40:21,489 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:40:21,490 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:40:21,491 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:40:21,491 - trading_system - INFO - Created local data source
2025-03-09 12:40:22,945 - trading_system - INFO - Connected to Binance API. Time difference: 608ms
2025-03-09 12:40:22,946 - trading_system - INFO - Binance interface initialized
2025-03-09 12:40:22,947 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:40:22,947 - trading_system - INFO - Created exchange data source
2025-03-09 12:40:22,947 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:40:22,948 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:40:22,948 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:40:22,950 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:40:23,502 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:40:23,505 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:40:23,512 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:40:23,513 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:40:23,514 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:40:23,515 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:40:23,516 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:40:23,516 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:40:23,517 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:40:23,518 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:40:23,519 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:40:23,519 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:40:23,520 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:40:23,522 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:40:23,523 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:40:23,524 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:40:23,723 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:40:23,724 - trading_system - INFO - Fetching BTCUSDT 1h data in 9 chunks
2025-03-09 12:40:24,684 - AsyncExecutor - ERROR - Error in task task_1711528550592_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:40:24,686 - trading_system - WARNING - Chunk 1/9 attempt 1 failed: Expected coroutine, got list
2025-03-09 12:40:27,620 - AsyncExecutor - ERROR - Error in task task_1711528553952_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:40:27,621 - trading_system - WARNING - Chunk 1/9 attempt 2 failed: Expected coroutine, got list
2025-03-09 12:48:20,339 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:48:20,373 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:48:20,374 - trading_system - INFO - Trading system initializing...
2025-03-09 12:48:20,665 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:48:20,667 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:48:20,667 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:48:20,668 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:48:20,668 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:48:20,669 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:48:20,669 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:48:20,670 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:48:20,671 - trading_system - INFO - Created local data source
2025-03-09 12:48:21,665 - trading_system - INFO - Connected to Binance API. Time difference: 504ms
2025-03-09 12:48:21,666 - trading_system - INFO - Binance interface initialized
2025-03-09 12:48:21,667 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:48:21,667 - trading_system - INFO - Created exchange data source
2025-03-09 12:48:21,670 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:48:21,671 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:48:21,672 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:48:21,674 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:48:22,176 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:48:22,178 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:48:22,184 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:48:22,186 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:48:22,187 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:48:22,187 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:48:22,188 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:48:22,188 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:48:22,189 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:48:22,191 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:48:22,191 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:48:22,192 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:48:22,193 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:48:22,195 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:48:22,196 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:48:22,196 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:48:22,334 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:48:22,335 - trading_system - INFO - Fetching BTCUSDT 1h data in 9 chunks
2025-03-09 12:48:22,683 - AsyncExecutor - ERROR - Error in task task_2080887026400_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:48:22,685 - trading_system - WARNING - Chunk 1/9 attempt 1 failed: Expected coroutine, got list
2025-03-09 12:48:25,063 - AsyncExecutor - ERROR - Error in task task_2080887021760_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:48:25,064 - trading_system - WARNING - Chunk 1/9 attempt 2 failed: Expected coroutine, got list
2025-03-09 12:48:29,419 - AsyncExecutor - ERROR - Error in task task_2080887026400_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 108, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:48:29,421 - trading_system - WARNING - Chunk 1/9 attempt 3 failed: Expected coroutine, got list
2025-03-09 12:48:29,422 - trading_system - ERROR - Failed to fetch chunk 1/9 after 3 attempts
2025-03-09 12:55:31,145 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 12:55:31,181 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 12:55:31,182 - trading_system - INFO - Trading system initializing...
2025-03-09 12:55:31,517 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 12:55:31,518 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 12:55:31,518 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 12:55:31,519 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 12:55:31,519 - trading_system - INFO - Starting trading pipeline...
2025-03-09 12:55:31,520 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:55:31,521 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 12:55:31,522 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 12:55:31,522 - trading_system - INFO - Created local data source
2025-03-09 12:55:32,638 - trading_system - INFO - Connected to Binance API. Time difference: 619ms
2025-03-09 12:55:32,639 - trading_system - INFO - Binance interface initialized
2025-03-09 12:55:32,641 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 12:55:32,641 - trading_system - INFO - Created exchange data source
2025-03-09 12:55:32,642 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 12:55:32,643 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 12:55:32,645 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 12:55:32,649 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 12:55:33,184 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:55:33,186 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 12:55:33,191 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 12:55:33,192 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 12:55:33,193 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 12:55:33,194 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 12:55:33,194 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 12:55:33,194 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 12:55:33,196 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 12:55:33,197 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 12:55:33,198 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 12:55:33,198 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 12:55:33,199 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 12:55:33,201 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 12:55:33,201 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 12:55:33,202 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 12:55:33,341 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 08:00:00+08:00 to 2023-12-31 08:00:00+08:00
2025-03-09 12:55:33,341 - trading_system - INFO - Fetching BTCUSDT 1h data in 9 chunks
2025-03-09 12:55:34,248 - AsyncExecutor - ERROR - Error in task task_2847552746368_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:55:34,251 - trading_system - ERROR - Request execution error: Expected coroutine, got list
2025-03-09 12:55:34,251 - trading_system - WARNING - Chunk 1/9 attempt 1 failed: Expected coroutine, got list
2025-03-09 12:55:37,201 - AsyncExecutor - ERROR - Error in task task_2847552746848_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:55:37,202 - trading_system - ERROR - Request execution error: Expected coroutine, got list
2025-03-09 12:55:37,204 - trading_system - WARNING - Chunk 1/9 attempt 2 failed: Expected coroutine, got list
2025-03-09 12:55:42,052 - AsyncExecutor - ERROR - Error in task task_2847552746368_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:55:42,053 - trading_system - ERROR - Request execution error: Expected coroutine, got list
2025-03-09 12:55:42,053 - trading_system - WARNING - Chunk 1/9 attempt 3 failed: Expected coroutine, got list
2025-03-09 12:55:42,054 - trading_system - ERROR - Failed to fetch chunk 1/9 after 3 attempts
2025-03-09 12:55:43,254 - AsyncExecutor - ERROR - Error in task task_2847552746368_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 12:55:43,255 - trading_system - ERROR - Request execution error: Expected coroutine, got list
2025-03-09 12:55:43,255 - trading_system - WARNING - Chunk 2/9 attempt 1 failed: Expected coroutine, got list
2025-03-09 13:01:33,139 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:01:33,174 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:01:33,175 - trading_system - INFO - Trading system initializing...
2025-03-09 13:01:33,544 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:01:33,545 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:01:33,546 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:01:33,546 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:01:33,546 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:01:33,546 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:01:33,548 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:01:33,549 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:01:33,550 - trading_system - INFO - Created local data source
2025-03-09 13:01:35,073 - trading_system - INFO - Connected to Binance API. Time difference: 628ms
2025-03-09 13:01:35,074 - trading_system - INFO - Binance interface initialized
2025-03-09 13:01:35,075 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 13:01:35,075 - trading_system - INFO - Created exchange data source
2025-03-09 13:01:35,076 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 13:01:35,077 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:01:35,078 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:01:35,079 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:01:35,571 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:01:35,574 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:01:35,579 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:01:35,580 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:01:35,580 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:01:35,580 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:01:35,581 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:01:35,582 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:01:35,582 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:01:35,584 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:01:35,584 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:01:35,584 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:01:35,586 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:01:35,588 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:01:35,588 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 13:01:35,589 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 13:01:35,589 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00 to 2023-12-31 00:00:00
2025-03-09 13:01:35,590 - trading_system - INFO - Fetching BTCUSDT 1h data in 9 chunks
2025-03-09 13:01:36,478 - AsyncExecutor - ERROR - Error in task task_2132007612032_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 13:01:36,483 - trading_system - WARNING - Chunk 1/9 attempt 1 failed: Expected coroutine, got list
2025-03-09 13:01:36,485 - trading_system - INFO - Retrying after 2s...
2025-03-09 13:01:39,541 - AsyncExecutor - ERROR - Error in task task_2132007610592_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 13:01:39,543 - trading_system - WARNING - Chunk 1/9 attempt 2 failed: Expected coroutine, got list
2025-03-09 13:01:39,545 - trading_system - INFO - Retrying after 4s...
2025-03-09 13:05:38,439 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:05:38,472 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:05:38,473 - trading_system - INFO - Trading system initializing...
2025-03-09 13:05:38,483 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:05:38,484 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:05:38,485 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:05:38,486 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:05:38,486 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:05:38,486 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:05:38,488 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:05:38,488 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:05:38,489 - trading_system - INFO - Created local data source
2025-03-09 13:05:38,514 - trading_system - INFO - Binance interface initialized using ccxt
2025-03-09 13:05:38,515 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 13:05:38,516 - trading_system - INFO - Created exchange data source
2025-03-09 13:05:38,516 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 13:05:38,517 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:05:38,518 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:05:38,520 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:05:39,039 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:05:39,041 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:05:39,046 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:05:39,046 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:05:39,048 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:05:39,049 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:05:39,050 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:05:39,050 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:05:39,051 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:05:39,053 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:05:39,054 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:05:39,054 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:05:39,055 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:05:39,057 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:05:39,058 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 13:05:39,058 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 13:05:39,058 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00 to 2023-12-31 00:00:00
2025-03-09 13:05:39,059 - trading_system - INFO - Fetching BTC/USDT 1h data in 9 chunks
2025-03-09 13:05:44,464 - AsyncExecutor - ERROR - Error in task task_1479265770272_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 13:05:44,466 - trading_system - WARNING - Chunk 1/9 attempt 1 failed: Expected coroutine, got list
2025-03-09 13:05:46,803 - AsyncExecutor - ERROR - Error in task task_1479265777312_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 13:05:46,805 - trading_system - WARNING - Chunk 1/9 attempt 2 failed: Expected coroutine, got list
2025-03-09 13:11:35,886 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:11:35,921 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:11:35,922 - trading_system - INFO - Trading system initializing...
2025-03-09 13:11:36,216 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:11:36,216 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:11:36,218 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:11:36,218 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:11:36,219 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:11:36,219 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:11:36,220 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:11:36,221 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:11:36,221 - trading_system - INFO - Created local data source
2025-03-09 13:11:36,222 - trading_system - INFO - Binance interface initialized
2025-03-09 13:11:36,222 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 13:11:36,223 - trading_system - INFO - Created exchange data source
2025-03-09 13:11:36,223 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 13:11:36,223 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:11:36,224 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:11:36,225 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:11:36,731 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:11:36,734 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:11:36,739 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:11:36,740 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:11:36,741 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:11:36,741 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:11:36,742 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:11:36,743 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:11:36,744 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:11:36,745 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:11:36,746 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:11:36,747 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:11:36,748 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:11:36,749 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:11:36,750 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 13:11:36,750 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 13:11:36,751 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00 to 2023-12-31 00:00:00
2025-03-09 13:11:36,751 - trading_system - INFO - Fetching BTC/USDT 1h data in 9 chunks
2025-03-09 13:11:37,773 - AsyncExecutor - ERROR - Error in task task_2192171800576_1: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list
2025-03-09 13:11:37,780 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: Expected coroutine, got list
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 143, in smart_fetch_ohlcv
    chunk_data = await self.executor.submit(fetch_chunk)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\async_executor.py", line 226, in submit
    raise TypeError(f"Expected coroutine, got {type(coro).__name__}")
TypeError: Expected coroutine, got list

2025-03-09 13:11:37,783 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 13:11:37,784 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 13:11:37,786 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 13:11:37,789 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 13:11:37,790 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 13:11:37,795 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 13:11:37,797 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 13:11:37,799 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 13:11:37,800 - system.execution - INFO - Execution engine closed
2025-03-09 13:11:37,801 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 13:11:37,803 - trading_system - INFO - Initiating system shutdown...
2025-03-09 13:11:37,804 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 13:11:37,805 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 13:11:37,806 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 13:11:37,808 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 13:11:37,811 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 13:17:54,138 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:17:54,171 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:17:54,172 - trading_system - INFO - Trading system initializing...
2025-03-09 13:17:54,179 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:17:54,180 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:17:54,181 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:17:54,182 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:17:54,183 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:17:54,183 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:17:54,184 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:17:54,185 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:17:54,185 - trading_system - INFO - Created local data source
2025-03-09 13:17:54,187 - trading_system - ERROR - Failed to create exchange data source: Binance.__init__() got an unexpected keyword argument 'retry_with_no_auth'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Binance.__init__() got an unexpected keyword argument 'retry_with_no_auth'

2025-03-09 13:17:54,188 - trading_system - WARNING - 无法创建备用交易所数据源: Binance.__init__() got an unexpected keyword argument 'retry_with_no_auth'
2025-03-09 13:17:54,189 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:17:54,190 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:17:54,192 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:17:54,686 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:17:54,689 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:17:54,694 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:17:54,695 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:17:54,697 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:17:54,697 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:17:54,698 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:17:54,699 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:17:54,700 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:17:54,701 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:17:54,702 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:17:54,702 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:17:54,703 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:17:54,705 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:17:54,705 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 13:17:54,706 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 13:17:54,707 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 13:17:54,708 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 13:17:54,709 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 13:17:54,709 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 13:17:54,710 - system.execution - INFO - Execution engine closed
2025-03-09 13:17:54,710 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 13:17:54,711 - trading_system - INFO - Initiating system shutdown...
2025-03-09 13:17:54,712 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 13:17:54,712 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 13:17:54,712 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 13:17:54,713 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 13:17:54,715 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 13:19:57,944 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:19:57,979 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:19:57,980 - trading_system - INFO - Trading system initializing...
2025-03-09 13:19:57,988 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:19:57,989 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:19:57,989 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:19:57,989 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:19:57,990 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:19:57,990 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:19:57,991 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:19:57,992 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:19:57,992 - trading_system - INFO - Created local data source
2025-03-09 13:19:58,026 - trading_system - INFO - Binance interface initialized using CCXT
2025-03-09 13:19:58,028 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 13:19:58,028 - trading_system - INFO - Created exchange data source
2025-03-09 13:19:58,029 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 13:19:58,030 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:19:58,030 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:19:58,032 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:19:58,626 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:19:58,628 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:19:58,633 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:19:58,634 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:19:58,635 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:19:58,636 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:19:58,636 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:19:58,638 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:19:58,639 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:19:58,640 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:19:58,641 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:19:58,641 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:19:58,642 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:19:58,644 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:19:58,645 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 13:19:58,646 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 13:19:58,646 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00 to 2023-12-31 00:00:00
2025-03-09 13:19:58,647 - trading_system - INFO - Fetching BTC/USDT 1h data in 9 chunks
2025-03-09 13:20:19,907 - trading_system - WARNING - Chunk 1/9 attempt 1 failed: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741497598649&recvWindow=60000&signature=f200e1ff46eddcc5c647494afe949b56a5e2ca03c247971010d74fab835f41e7
2025-03-09 13:20:43,039 - trading_system - WARNING - Chunk 1/9 attempt 2 failed: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741497621969&recvWindow=60000&signature=6c6732442d1e80f9f6bc0fbaf1584a7e721e5052e387ee633d58774cd8873e7f
2025-03-09 13:21:08,140 - trading_system - WARNING - Chunk 1/9 attempt 3 failed: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741497647071&recvWindow=60000&signature=45642211ab5eefc56a7f362925f929cdafa985c6775fae55f24671761a162d6b
2025-03-09 13:21:08,141 - trading_system - ERROR - Failed to fetch chunk after 3 attempts
2025-03-09 13:39:04,162 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:39:04,195 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:39:04,195 - trading_system - INFO - Trading system initializing...
2025-03-09 13:39:04,203 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:39:04,204 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:39:04,204 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:39:04,205 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:39:04,205 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:39:04,206 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:39:04,207 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:39:04,207 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:39:04,208 - trading_system - INFO - Created local data source
2025-03-09 13:39:04,209 - trading_system - ERROR - Failed to create exchange data source: Binance.__init__() got an unexpected keyword argument 'retry_with_no_auth'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: Binance.__init__() got an unexpected keyword argument 'retry_with_no_auth'

2025-03-09 13:39:04,210 - trading_system - WARNING - 无法创建备用交易所数据源: Binance.__init__() got an unexpected keyword argument 'retry_with_no_auth'
2025-03-09 13:39:04,210 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:39:04,212 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:39:04,213 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:39:04,647 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:39:04,649 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:39:04,654 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:39:04,655 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:39:04,657 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:39:04,657 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:39:04,658 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:39:04,658 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:39:04,659 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:39:04,660 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:39:04,661 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:39:04,662 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:39:04,662 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:39:04,664 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:39:04,665 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 13:39:04,666 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 13:39:04,667 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 13:39:04,668 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 13:39:04,669 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 13:39:04,669 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 13:39:04,670 - system.execution - INFO - Execution engine closed
2025-03-09 13:39:04,670 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 13:39:04,670 - trading_system - INFO - Initiating system shutdown...
2025-03-09 13:39:04,671 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 13:39:04,671 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 13:39:04,671 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 13:39:04,672 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 13:39:04,674 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 13:43:30,992 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 13:43:31,063 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 13:43:31,064 - trading_system - INFO - Trading system initializing...
2025-03-09 13:43:31,084 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 13:43:31,087 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 13:43:31,089 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 13:43:31,090 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 13:43:31,092 - trading_system - INFO - Starting trading pipeline...
2025-03-09 13:43:31,093 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:43:31,095 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 13:43:31,097 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 13:43:31,099 - trading_system - INFO - Created local data source
2025-03-09 13:43:31,137 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 13:43:31,171 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 13:43:31,172 - trading_system - INFO - Binance接口初始化完成
2025-03-09 13:43:31,173 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 13:43:31,174 - trading_system - INFO - Created exchange data source
2025-03-09 13:43:31,175 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 13:43:31,176 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 13:43:31,177 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 13:43:31,179 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 13:43:31,658 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:43:31,661 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 13:43:31,666 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 13:43:31,668 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 13:43:31,668 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 13:43:31,669 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 13:43:31,669 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 13:43:31,670 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 13:43:31,671 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 13:43:31,672 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 13:43:31,672 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 13:43:31,673 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 13:43:31,673 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 13:43:31,675 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 13:43:31,675 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 13:43:31,676 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 13:43:31,676 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00 to 2023-12-31 00:00:00
2025-03-09 13:43:31,676 - trading_system - INFO - 开始智能获取OHLCV数据: BTC/USDT 1h 2023-01-01 00:00:00+00:00 - 2023-12-31 00:00:00+00:00
2025-03-09 13:43:31,677 - trading_system - INFO - 将请求分为18个块
2025-03-09 13:43:31,880 - trading_system - WARNING - 第1块数据获取失败，尝试重试(1/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 13:43:33,908 - trading_system - WARNING - 第1块数据获取失败，尝试重试(2/3): unsupported operand type(s) for /: 'NoneType' and 'int'
2025-03-09 15:03:32,668 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:03:32,720 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:03:32,720 - trading_system - INFO - Trading system initializing...
2025-03-09 15:03:32,729 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:03:32,730 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:03:32,731 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:03:32,731 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:03:32,731 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:03:32,732 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:03:32,733 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:03:32,734 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:03:32,735 - trading_system - INFO - Created local data source
2025-03-09 15:03:32,751 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:03:32,769 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:03:32,770 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:03:32,771 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:03:32,772 - trading_system - INFO - Created exchange data source
2025-03-09 15:03:32,772 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:03:32,773 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:03:32,774 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:03:32,776 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:03:33,227 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:03:33,229 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:03:33,234 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:03:33,235 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:03:33,236 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:03:33,237 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:03:33,238 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:03:33,238 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:03:33,239 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:03:33,240 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:03:33,241 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:03:33,241 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:03:33,242 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:03:33,243 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:03:33,243 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:03:33,244 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:03:33,290 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:03:33,291 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:03:33,293 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:03:33,294 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:03:33,315 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:03:33,316 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:03:33,316 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:03:33,317 - system.execution - INFO - Execution engine closed
2025-03-09 15:03:33,317 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:03:33,318 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:03:33,318 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:03:33,319 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:03:33,319 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:03:33,320 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:03:33,322 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:04:50,161 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:04:50,204 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:04:50,205 - trading_system - INFO - Trading system initializing...
2025-03-09 15:04:50,211 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:04:50,213 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:04:50,213 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:04:50,215 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:04:50,215 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:04:50,215 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:04:50,215 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:04:50,216 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:04:50,216 - trading_system - INFO - Created local data source
2025-03-09 15:04:50,232 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:04:50,249 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:04:50,249 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:04:50,250 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:04:50,250 - trading_system - INFO - Created exchange data source
2025-03-09 15:04:50,251 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:04:50,252 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:04:50,252 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:04:50,254 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:04:50,663 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:04:50,665 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:04:50,669 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:04:50,670 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:04:50,671 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:04:50,673 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:04:50,674 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:04:50,674 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:04:50,675 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:04:50,676 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:04:50,677 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:04:50,678 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:04:50,678 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:04:50,680 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:04:50,680 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:04:50,681 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:04:50,683 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:04:50,683 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:04:50,684 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:04:50,685 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:04:50,686 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:04:50,687 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:04:50,687 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:04:50,687 - system.execution - INFO - Execution engine closed
2025-03-09 15:04:50,688 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:04:50,688 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:04:50,688 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:04:50,689 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:04:50,689 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:04:50,690 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:04:50,692 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:05:36,664 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:05:36,705 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:05:36,706 - trading_system - INFO - Trading system initializing...
2025-03-09 15:05:36,716 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:05:36,717 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:05:36,718 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:05:36,718 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:05:36,718 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:05:36,719 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:05:36,719 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:05:36,720 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:05:36,720 - trading_system - INFO - Created local data source
2025-03-09 15:05:36,748 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:05:36,782 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:05:36,783 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:05:36,784 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:05:36,785 - trading_system - INFO - Created exchange data source
2025-03-09 15:05:36,785 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:05:36,786 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:05:36,786 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:05:36,788 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:05:37,221 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:05:37,223 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:05:37,228 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:05:37,229 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:05:37,229 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:05:37,230 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:05:37,231 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:05:37,231 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:05:37,232 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:05:37,233 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:05:37,234 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:05:37,235 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:05:37,235 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:05:37,237 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:05:37,237 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:05:37,237 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:05:37,239 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:05:37,240 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:05:37,241 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:05:37,242 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:05:37,243 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:05:37,244 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:05:37,244 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:05:37,244 - system.execution - INFO - Execution engine closed
2025-03-09 15:05:37,245 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:05:37,245 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:05:37,245 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:05:37,246 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:05:37,246 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:05:37,247 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:05:37,248 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:06:16,565 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:06:16,598 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:06:16,599 - trading_system - INFO - Trading system initializing...
2025-03-09 15:06:16,606 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:06:16,607 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:06:16,608 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:06:16,608 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:06:16,608 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:06:16,609 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:06:16,609 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:06:16,610 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:06:16,610 - trading_system - INFO - Created local data source
2025-03-09 15:06:16,626 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:06:16,641 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:06:16,643 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:06:16,643 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:06:16,644 - trading_system - INFO - Created exchange data source
2025-03-09 15:06:16,644 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:06:16,645 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:06:16,645 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:06:16,647 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:06:17,054 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:06:17,056 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:06:17,060 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:06:17,062 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:06:17,062 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:06:17,063 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:06:17,064 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:06:17,064 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:06:17,065 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:06:17,067 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:06:17,068 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:06:17,069 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:06:17,069 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:06:17,071 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:06:17,071 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:06:29,076 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:06:29,081 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:06:29,082 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:06:29,084 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:06:29,086 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:06:29,088 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:06:29,089 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:06:29,089 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:06:29,090 - system.execution - INFO - Execution engine closed
2025-03-09 15:06:29,090 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:06:29,091 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:06:29,091 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:06:29,093 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:06:29,093 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:06:29,094 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:06:29,097 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:06:38,476 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:06:38,508 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:06:38,509 - trading_system - INFO - Trading system initializing...
2025-03-09 15:06:38,516 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:06:38,516 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:06:38,518 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:06:38,518 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:06:38,518 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:06:38,529 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:06:38,529 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:06:38,530 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:06:38,532 - trading_system - INFO - Created local data source
2025-03-09 15:06:38,547 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:06:38,567 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:06:38,568 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:06:38,569 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:06:38,571 - trading_system - INFO - Created exchange data source
2025-03-09 15:06:38,571 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:06:38,572 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:06:38,573 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:06:38,575 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:06:39,000 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:06:39,001 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:06:39,006 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:06:39,007 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:06:39,008 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:06:39,009 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:06:39,009 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:06:39,010 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:06:39,011 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:06:39,012 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:06:39,013 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:06:39,014 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:06:39,014 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:06:39,017 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:06:39,017 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:06:41,036 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:06:41,043 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:06:41,044 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:06:41,049 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:06:41,050 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:06:41,053 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:06:41,053 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:06:41,055 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:06:41,056 - system.execution - INFO - Execution engine closed
2025-03-09 15:06:41,057 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:06:41,057 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:06:41,058 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:06:41,058 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:06:41,059 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:06:41,060 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:06:41,062 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:06:47,573 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:06:47,629 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:06:47,630 - trading_system - INFO - Trading system initializing...
2025-03-09 15:06:47,646 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:06:47,649 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:06:47,650 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:06:47,652 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:06:47,654 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:06:47,655 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:06:47,656 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:06:47,658 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:06:47,659 - trading_system - INFO - Created local data source
2025-03-09 15:06:47,684 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:06:47,707 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:06:47,708 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:06:47,709 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:06:47,709 - trading_system - INFO - Created exchange data source
2025-03-09 15:06:47,712 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:06:47,713 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:06:47,714 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:06:47,716 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:06:48,144 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:06:48,146 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:06:48,150 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:06:48,152 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:06:48,153 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:06:48,154 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:06:48,155 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:06:48,156 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:06:48,157 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:06:48,158 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:06:48,158 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:06:48,159 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:06:48,159 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:06:48,160 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:06:48,161 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:06:52,039 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:06:57,533 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:06:57,535 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:06:57,540 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:06:57,544 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:06:57,548 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:06:57,548 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:06:57,549 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:06:57,550 - system.execution - INFO - Execution engine closed
2025-03-09 15:06:57,551 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:06:57,552 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:06:57,553 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:06:57,553 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:06:57,554 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:06:57,554 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:06:57,558 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:07:02,786 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:07:02,820 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:07:02,820 - trading_system - INFO - Trading system initializing...
2025-03-09 15:07:02,831 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:07:02,833 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:07:02,834 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:07:02,835 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:07:02,836 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:07:02,837 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:07:02,837 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:07:02,838 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:07:02,840 - trading_system - INFO - Created local data source
2025-03-09 15:07:02,861 - trading_system - INFO - 同步客户端API密钥验证成功
2025-03-09 15:07:02,880 - trading_system - INFO - 异步客户端初始化成功
2025-03-09 15:07:02,880 - trading_system - INFO - Binance接口初始化完成
2025-03-09 15:07:02,882 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:07:02,883 - trading_system - INFO - Created exchange data source
2025-03-09 15:07:02,883 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:07:02,884 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:07:02,885 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:07:02,886 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:07:03,316 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:07:03,318 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:07:03,322 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:07:03,322 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:07:03,324 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:07:03,325 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:07:03,325 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:07:03,326 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:07:03,327 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:07:03,328 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:07:03,328 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:07:03,329 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:07:03,330 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:07:03,332 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:07:03,333 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:24:40,726 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:24:40,758 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:24:40,759 - trading_system - INFO - Trading system initializing...
2025-03-09 15:24:40,766 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:24:40,767 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:24:40,767 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:24:40,768 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:24:40,768 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:24:40,769 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:24:40,769 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:24:40,770 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:24:40,770 - trading_system - INFO - Created local data source
2025-03-09 15:24:40,772 - trading_system - ERROR - Failed to create exchange data source: SimpleBinance.__init__() got an unexpected keyword argument 'retry_with_no_auth'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config, retry_with_no_auth=True)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: SimpleBinance.__init__() got an unexpected keyword argument 'retry_with_no_auth'

2025-03-09 15:24:40,773 - trading_system - WARNING - 无法创建备用交易所数据源: SimpleBinance.__init__() got an unexpected keyword argument 'retry_with_no_auth'
2025-03-09 15:24:40,773 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:24:40,774 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:24:40,776 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:24:41,222 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:24:41,225 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:24:41,229 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:24:41,231 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:24:41,232 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:24:41,232 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:24:41,233 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:24:41,234 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:24:41,234 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:24:41,235 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:24:41,235 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:24:41,237 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:24:41,238 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:24:41,241 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:24:41,241 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:24:41,243 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:24:41,244 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:24:41,245 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:24:41,245 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:24:41,246 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:24:41,246 - system.execution - INFO - Execution engine closed
2025-03-09 15:24:41,246 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:24:41,247 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:24:41,247 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:24:41,248 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:24:41,248 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:24:41,249 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:24:41,251 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:25:30,158 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:25:30,190 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:25:30,192 - trading_system - INFO - Trading system initializing...
2025-03-09 15:25:30,199 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:25:30,200 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:25:30,201 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:25:30,201 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:25:30,202 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:25:30,202 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:25:30,202 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:25:30,203 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:25:30,203 - trading_system - INFO - Created local data source
2025-03-09 15:25:30,205 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 27, in __init__
    self._init_exchange()
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 43, in _init_exchange
    api_key = self.config.get('api', {}).get('binance', {}).get('apiKey', '')
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 15:25:30,205 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 15:25:30,206 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:25:30,206 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:25:30,208 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:25:30,650 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:25:30,653 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:25:30,658 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:25:30,659 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:25:30,660 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:25:30,661 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:25:30,661 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:25:30,662 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:25:30,662 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:25:30,664 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:25:30,664 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:25:30,665 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:25:30,665 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:25:30,667 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:25:30,668 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:25:30,670 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:25:30,670 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:25:30,672 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:25:30,673 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:25:30,673 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:25:30,674 - system.execution - INFO - Execution engine closed
2025-03-09 15:25:30,674 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:25:30,675 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:25:30,675 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:25:30,675 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:25:30,676 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:25:30,676 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:25:30,678 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:26:18,912 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:26:18,945 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:26:18,946 - trading_system - INFO - Trading system initializing...
2025-03-09 15:26:18,954 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:26:18,955 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:26:18,955 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:26:18,956 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:26:18,956 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:26:18,956 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:26:18,957 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:26:18,958 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:26:18,959 - trading_system - INFO - Created local data source
2025-03-09 15:26:32,395 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 27, in __init__
    self._init_exchange()
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 60, in _init_exchange
    proxies = self.config.get('proxies', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 15:26:32,397 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 15:26:32,399 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:26:32,401 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:26:32,404 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:26:32,834 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:26:32,836 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:26:32,840 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:26:32,842 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:26:32,843 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:26:32,844 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:26:32,845 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:26:32,845 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:26:32,850 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:26:32,851 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:26:32,852 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:26:32,852 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:26:32,853 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:26:32,855 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:26:32,855 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:26:32,857 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:26:32,857 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:26:32,859 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:26:32,859 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:26:32,859 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:26:32,860 - system.execution - INFO - Execution engine closed
2025-03-09 15:26:32,860 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:26:32,860 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:26:32,862 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:26:32,862 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:26:32,863 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:26:32,863 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:26:32,864 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:26:53,857 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:26:53,894 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:26:53,895 - trading_system - INFO - Trading system initializing...
2025-03-09 15:26:53,902 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:26:53,902 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:26:53,903 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:26:53,904 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:26:53,904 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:26:53,905 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:26:53,905 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:26:53,906 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:26:53,907 - trading_system - INFO - Created local data source
2025-03-09 15:27:04,979 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 452, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 27, in __init__
    self._init_exchange()
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 60, in _init_exchange
    proxies = self.config.get('proxies', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 15:27:04,979 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 15:27:04,980 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:27:04,980 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:27:04,983 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:27:05,470 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:27:05,472 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:27:05,477 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:27:05,479 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:27:05,480 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:27:05,480 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:27:05,481 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:27:05,482 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:27:05,483 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:27:05,484 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:27:05,485 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:27:05,485 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:27:05,486 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:27:05,488 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:27:05,489 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:27:05,490 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:27:05,491 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:27:05,492 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:27:05,493 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:27:05,494 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:27:05,494 - system.execution - INFO - Execution engine closed
2025-03-09 15:27:05,494 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:27:05,495 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:27:05,495 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:27:05,496 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:27:05,496 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:27:05,496 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:27:05,498 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:27:10,155 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:27:10,190 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:27:10,190 - trading_system - INFO - Trading system initializing...
2025-03-09 15:27:10,199 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:27:10,200 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:27:10,201 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:27:10,202 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:27:10,202 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:27:10,202 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:27:10,203 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:27:10,204 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:27:10,204 - trading_system - INFO - Created local data source
2025-03-09 15:29:30,842 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:29:30,875 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:29:30,876 - trading_system - INFO - Trading system initializing...
2025-03-09 15:29:30,884 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:29:30,886 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:29:30,886 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:29:30,887 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:29:30,887 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:29:30,888 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:29:30,888 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:29:30,889 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:29:30,890 - trading_system - INFO - Created local data source
2025-03-09 15:29:34,472 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:29:34,472 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:29:34,473 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:29:34,473 - trading_system - INFO - Created exchange data source
2025-03-09 15:29:34,474 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:29:34,474 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:29:34,475 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:29:34,477 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:29:34,938 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:29:34,941 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:29:34,945 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:29:34,946 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:29:34,948 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:29:34,948 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:29:34,949 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:29:34,949 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:29:34,950 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:29:34,952 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:29:34,953 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:29:34,953 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:29:34,954 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:29:34,956 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:29:34,956 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:29:43,644 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:29:43,649 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:29:43,650 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:29:43,653 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:29:43,653 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:29:43,654 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:29:43,655 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:29:43,656 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:29:43,656 - system.execution - INFO - Execution engine closed
2025-03-09 15:29:43,657 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:29:43,657 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:29:43,657 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:29:43,658 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:29:43,658 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:29:43,659 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:29:43,661 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:29:48,652 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:29:48,701 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:29:48,702 - trading_system - INFO - Trading system initializing...
2025-03-09 15:29:48,708 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:29:48,710 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:29:48,710 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:29:48,712 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:29:48,713 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:29:48,714 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:29:48,714 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:29:48,715 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:29:48,715 - trading_system - INFO - Created local data source
2025-03-09 15:30:04,782 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:30:09,584 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:30:49,481 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:30:59,268 - trading_system - INFO - Created exchange data source
2025-03-09 15:31:04,615 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:31:36,232 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:31:49,362 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:31:49,367 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:31:49,862 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:31:49,864 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:31:49,869 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:31:49,870 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:32:35,252 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:32:38,224 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:33:06,965 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:33:06,967 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:33:06,980 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:33:06,982 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:33:09,511 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:34:07,099 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:34:34,285 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:34:49,838 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:34:49,839 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:34:57,706 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:34:57,710 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:34:57,710 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:34:59,960 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:35:11,712 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:35:11,745 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:35:11,746 - trading_system - INFO - Trading system initializing...
2025-03-09 15:35:11,752 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:35:11,753 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:35:11,753 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:35:11,754 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:35:11,755 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:35:11,755 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:35:11,756 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:35:11,756 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:35:11,757 - trading_system - INFO - Created local data source
2025-03-09 15:36:21,920 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:36:21,952 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:36:21,952 - trading_system - INFO - Trading system initializing...
2025-03-09 15:36:22,052 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:36:22,053 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:36:22,054 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:36:22,054 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:36:22,055 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:36:22,055 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:36:22,056 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:36:22,057 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:36:22,057 - trading_system - INFO - Created local data source
2025-03-09 15:39:18,171 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:39:18,227 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:39:18,228 - trading_system - INFO - Trading system initializing...
2025-03-09 15:39:18,235 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:39:18,236 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:39:18,237 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:39:18,237 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:39:18,239 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:39:18,239 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:39:18,240 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:39:18,241 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:39:18,241 - trading_system - INFO - Created local data source
2025-03-09 15:39:29,463 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:39:35,837 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:39:53,984 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:40:03,210 - trading_system - INFO - Created exchange data source
2025-03-09 15:40:21,814 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:41:42,437 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:41:55,121 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:41:55,134 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:41:55,678 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:41:55,680 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:41:55,685 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:41:55,686 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:41:55,688 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:41:55,689 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:41:55,690 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:41:55,690 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:41:55,695 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:41:55,696 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:41:55,697 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:41:55,697 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:41:55,697 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:42:18,624 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:42:18,626 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:42:22,229 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:42:25,501 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:42:25,503 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:42:25,507 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:42:25,512 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:42:25,515 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:42:25,516 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:42:25,517 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:42:25,518 - system.execution - INFO - Execution engine closed
2025-03-09 15:42:25,519 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:42:25,521 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:42:25,521 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:42:25,522 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:42:25,523 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:42:25,523 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:42:25,528 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:42:31,595 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:42:31,638 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:42:31,639 - trading_system - INFO - Trading system initializing...
2025-03-09 15:42:31,648 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:42:31,649 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:42:31,650 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:42:31,651 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:42:31,651 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:42:31,651 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:42:31,652 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:42:31,653 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:42:31,653 - trading_system - INFO - Created local data source
2025-03-09 15:42:42,305 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:42:42,307 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:42:42,310 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:42:42,311 - trading_system - INFO - Created exchange data source
2025-03-09 15:42:42,313 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:42:42,314 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:42:42,318 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:42:42,321 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:42:42,763 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:42:42,765 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:42:42,769 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:42:42,770 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:42:42,771 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:42:42,772 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:42:42,773 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:42:42,773 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:42:42,778 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:42:42,779 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:42:42,780 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:42:42,780 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:42:42,781 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:43:29,036 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:43:35,367 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:43:37,947 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:43:52,586 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:43:52,588 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:43:52,592 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:43:52,598 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:43:52,600 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:43:52,601 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:43:52,602 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:43:52,603 - system.execution - INFO - Execution engine closed
2025-03-09 15:43:52,604 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:43:52,605 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:43:52,606 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:43:52,606 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:43:52,607 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:43:52,607 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:43:52,610 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:43:58,939 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:43:58,972 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:43:58,974 - trading_system - INFO - Trading system initializing...
2025-03-09 15:43:58,982 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:43:58,983 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:43:58,983 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:43:58,983 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:43:58,984 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:43:58,984 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:43:58,985 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:43:58,986 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:43:58,986 - trading_system - INFO - Created local data source
2025-03-09 15:43:59,004 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:43:59,004 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:43:59,005 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:43:59,006 - trading_system - INFO - Created exchange data source
2025-03-09 15:43:59,006 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:43:59,007 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:43:59,008 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:43:59,009 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:43:59,477 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:43:59,480 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:43:59,484 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:43:59,486 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:43:59,487 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:43:59,488 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:43:59,488 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:43:59,489 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:43:59,490 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:43:59,491 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:43:59,491 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:43:59,492 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:43:59,492 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:44:03,028 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:44:03,029 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:44:08,535 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:44:08,542 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:44:08,545 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:44:08,548 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:44:08,550 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:44:08,552 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:44:08,554 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:44:08,555 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:44:08,556 - system.execution - INFO - Execution engine closed
2025-03-09 15:44:08,556 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:44:08,557 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:44:08,558 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:44:08,558 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:44:08,559 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:44:08,559 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:44:08,562 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:44:15,660 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:44:15,692 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:44:15,694 - trading_system - INFO - Trading system initializing...
2025-03-09 15:44:15,700 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:44:15,701 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:44:15,703 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:44:15,703 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:44:15,704 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:44:15,704 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:44:15,705 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:44:15,706 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:44:15,706 - trading_system - INFO - Created local data source
2025-03-09 15:44:15,724 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:44:15,724 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:44:15,725 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:44:15,726 - trading_system - INFO - Created exchange data source
2025-03-09 15:44:15,726 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:44:15,727 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:44:15,727 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:44:15,730 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:44:16,165 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:44:16,167 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:44:16,172 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:44:16,173 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:44:16,174 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:44:16,176 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:44:16,176 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:44:16,176 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:44:16,177 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:44:16,178 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:44:16,179 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:44:16,179 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:44:16,180 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:44:18,795 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:44:18,796 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:44:20,799 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:44:20,806 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:44:20,808 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:44:20,811 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:44:20,814 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:44:20,817 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:44:20,818 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:44:20,820 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:44:20,821 - system.execution - INFO - Execution engine closed
2025-03-09 15:44:20,821 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:44:20,823 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:44:20,824 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:44:20,825 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:44:20,826 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:44:20,827 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:44:20,830 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:44:25,432 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:44:25,465 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:44:25,466 - trading_system - INFO - Trading system initializing...
2025-03-09 15:44:25,473 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:44:25,474 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:44:25,474 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:44:25,476 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:44:25,476 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:44:25,477 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:44:25,477 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:44:25,478 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:44:25,478 - trading_system - INFO - Created local data source
2025-03-09 15:44:25,495 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:44:25,496 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:44:25,496 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:44:25,497 - trading_system - INFO - Created exchange data source
2025-03-09 15:44:25,498 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:44:25,499 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:44:25,500 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:44:25,502 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:44:25,964 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:44:25,967 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:44:25,971 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:44:25,972 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:44:25,973 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:44:25,973 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:44:25,974 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:44:25,975 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:44:25,976 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:44:25,977 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:44:25,978 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:44:25,978 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:44:25,979 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:44:28,363 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:44:28,364 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:44:31,680 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:44:44,212 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:44:44,214 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:44:44,218 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:44:44,223 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:44:44,225 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:44:44,227 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:44:44,227 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:44:44,228 - system.execution - INFO - Execution engine closed
2025-03-09 15:44:44,229 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:44:44,230 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:44:44,231 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:44:44,231 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:44:44,231 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:44:44,232 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:44:44,235 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 15:44:54,096 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 15:44:54,128 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 15:44:54,129 - trading_system - INFO - Trading system initializing...
2025-03-09 15:44:54,137 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 15:44:54,142 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 15:44:54,143 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 15:44:54,143 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 15:44:54,144 - trading_system - INFO - Starting trading pipeline...
2025-03-09 15:44:54,144 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:44:54,144 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 15:44:54,146 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 15:44:54,147 - trading_system - INFO - Created local data source
2025-03-09 15:44:54,163 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 15:44:54,164 - trading_system - INFO - SimpleBinance initialized
2025-03-09 15:44:54,164 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 15:44:54,165 - trading_system - INFO - Created exchange data source
2025-03-09 15:44:54,165 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 15:44:54,166 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 15:44:54,167 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 15:44:54,168 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 15:44:54,597 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:44:54,599 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 15:44:54,603 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 15:44:54,604 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 15:44:54,605 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 15:44:54,606 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 15:44:54,606 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 15:44:54,607 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 15:44:54,608 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 15:44:54,608 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 15:44:54,610 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 15:44:54,611 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 15:44:54,611 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 15:44:54,613 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 15:44:54,613 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 15:44:55,892 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 15:45:13,703 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 15:45:13,704 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 15:45:13,709 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 15:45:13,713 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 15:45:13,717 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:45:13,718 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 15:45:13,719 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:45:13,720 - system.execution - INFO - Execution engine closed
2025-03-09 15:45:13,721 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:45:13,722 - trading_system - INFO - Initiating system shutdown...
2025-03-09 15:45:13,723 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 15:45:13,724 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 15:45:13,725 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 15:45:13,725 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 15:45:13,729 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:04:13,318 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:04:13,360 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:04:13,363 - trading_system - INFO - Trading system initializing...
2025-03-09 16:04:13,373 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:04:13,375 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:04:13,375 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:04:13,376 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:04:13,376 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:04:13,376 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:04:13,377 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:04:13,378 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:04:13,379 - trading_system - INFO - Created local data source
2025-03-09 16:04:13,398 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:04:13,399 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:04:13,399 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:04:13,399 - trading_system - INFO - Created exchange data source
2025-03-09 16:04:13,400 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:04:13,400 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:04:13,401 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:04:13,403 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:04:13,870 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:04:13,872 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:04:13,876 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:04:13,877 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:04:13,878 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:04:13,879 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:04:13,880 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:04:13,880 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:04:13,881 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:04:13,882 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:04:13,883 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:04:13,884 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:04:13,884 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:04:13,886 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:04:13,887 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:04:17,426 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:04:17,431 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 16:04:17,433 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:04:17,436 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:04:17,438 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:04:17,440 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:04:17,442 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:04:17,443 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:04:17,444 - system.execution - INFO - Execution engine closed
2025-03-09 16:04:17,446 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:04:17,447 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:04:17,447 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:04:17,449 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:04:17,449 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:04:17,450 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:04:17,453 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:04:23,143 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:04:23,177 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:04:23,178 - trading_system - INFO - Trading system initializing...
2025-03-09 16:04:23,186 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:04:23,188 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:04:23,188 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:04:23,189 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:04:23,189 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:04:23,189 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:04:23,190 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:04:23,191 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:04:23,191 - trading_system - INFO - Created local data source
2025-03-09 16:04:23,207 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:04:23,208 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:04:23,208 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:04:23,209 - trading_system - INFO - Created exchange data source
2025-03-09 16:04:23,209 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:04:23,210 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:04:23,211 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:04:23,213 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:04:23,647 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:04:23,649 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:04:23,654 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:04:23,655 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:04:23,655 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:04:23,657 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:04:23,657 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:04:23,658 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:04:23,659 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:04:23,660 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:04:23,661 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:04:23,661 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:04:23,661 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:04:23,663 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:04:23,663 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:04:31,626 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:06:01,378 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:06:01,412 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:06:01,412 - trading_system - INFO - Trading system initializing...
2025-03-09 16:06:01,421 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:06:01,422 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:06:01,422 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:06:01,423 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:06:01,423 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:06:01,423 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:06:01,424 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:06:01,425 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:06:01,425 - trading_system - INFO - Created local data source
2025-03-09 16:06:01,443 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:06:01,443 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:06:01,444 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:06:01,445 - trading_system - INFO - Created exchange data source
2025-03-09 16:06:01,445 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:06:01,446 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:06:01,446 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:06:01,448 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:06:01,905 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:06:01,907 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:06:01,911 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:06:01,914 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:06:01,915 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:06:01,915 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:06:01,916 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:06:01,917 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:06:01,918 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:06:01,919 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:06:01,920 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:06:01,920 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:06:01,921 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:06:01,923 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:06:01,923 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:06:08,606 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:08:11,118 - trading_system - ERROR - 从交易所下载数据失败: cannot access local variable 'datetime' where it is not associated with a value
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\data_manager.py", line 164, in get_historical_data
    exchange_data = await self.fallback_source.fetch_historical(symbol, timeframe, start, end)
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 360, in fetch_historical
    start_dt = TimeUtils.parse_timestamp(start) if start else datetime.now() - timedelta(days=30)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\utils\time_utils.py", line 32, in parse_timestamp
    if isinstance(timestamp, datetime):
                             ^^^^^^^^
UnboundLocalError: cannot access local variable 'datetime' where it is not associated with a value

2025-03-09 16:08:11,119 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:08:11,130 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:08:11,137 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:08:11,145 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:08:11,149 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:08:11,152 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:08:11,155 - system.execution - INFO - Execution engine closed
2025-03-09 16:08:11,158 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:08:11,164 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:08:11,168 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:08:11,171 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:08:11,174 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:08:11,178 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:08:11,195 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:11:43,498 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:11:43,545 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:11:43,547 - trading_system - INFO - Trading system initializing...
2025-03-09 16:11:43,560 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:11:43,562 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:11:43,564 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:11:43,565 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:11:43,566 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:11:43,566 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:11:43,568 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:11:43,568 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:11:43,569 - trading_system - INFO - Created local data source
2025-03-09 16:11:43,586 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:11:43,587 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:11:43,588 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:11:43,588 - trading_system - INFO - Created exchange data source
2025-03-09 16:11:43,589 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:11:43,589 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:11:43,590 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:11:43,592 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:11:44,053 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:11:44,055 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:11:44,059 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:11:44,061 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:11:44,062 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:11:44,062 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:11:44,063 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:11:44,063 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:11:44,064 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:11:44,065 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:11:44,066 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:11:44,066 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:11:44,066 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:11:44,068 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:11:44,069 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:11:47,165 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:11:59,771 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:12:30,396 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 366, in fetch_historical
    df = await self.exchange.smart_fetch_ohlcv(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 353, in smart_fetch_ohlcv
    return await self.fetch_historical_ohlcv(symbol, timeframe, start, end)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 251, in fetch_historical_ohlcv
    await self._init_async_exchange()
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 75, in _init_async_exchange
    api_key = self.config.get('api', {}).get('binance', {}).get('apiKey', '')
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 16:12:30,401 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 16:12:30,402 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:12:30,406 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:12:30,410 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:12:30,413 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:12:30,414 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:12:30,416 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:12:30,418 - system.execution - INFO - Execution engine closed
2025-03-09 16:12:30,420 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:12:30,422 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:12:30,423 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:12:30,424 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:12:30,425 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:12:30,426 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:12:30,432 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:12:40,960 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:12:40,999 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:12:40,999 - trading_system - INFO - Trading system initializing...
2025-03-09 16:12:41,008 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:12:41,009 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:12:41,010 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:12:41,010 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:12:41,011 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:12:41,012 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:12:41,012 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:12:41,013 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:12:41,013 - trading_system - INFO - Created local data source
2025-03-09 16:12:41,030 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:12:41,031 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:12:41,031 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:12:41,032 - trading_system - INFO - Created exchange data source
2025-03-09 16:12:41,032 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:12:41,032 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:12:41,033 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:12:41,036 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:12:41,489 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:12:41,491 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:12:41,494 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:12:41,496 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:12:41,497 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:12:41,498 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:12:41,499 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:12:41,499 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:12:41,500 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:12:41,501 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:12:41,502 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:12:41,503 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:12:41,503 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:12:41,505 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:12:41,506 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:12:46,651 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:12:46,653 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:12:57,975 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 366, in fetch_historical
    df = await self.exchange.smart_fetch_ohlcv(
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 353, in smart_fetch_ohlcv
    return await self.fetch_historical_ohlcv(symbol, timeframe, start, end)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 251, in fetch_historical_ohlcv
    await self._init_async_exchange()
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 75, in _init_async_exchange
    api_key = self.config.get('api', {}).get('binance', {}).get('apiKey', '')
              ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 16:12:57,978 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 16:12:57,979 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:12:57,982 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:12:57,985 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:12:57,987 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:12:57,988 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:12:57,988 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:12:57,989 - system.execution - INFO - Execution engine closed
2025-03-09 16:12:57,989 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:12:57,990 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:12:57,991 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:12:57,993 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:12:57,993 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:12:57,994 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:12:57,998 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:13:10,493 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:13:10,543 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:13:10,544 - trading_system - INFO - Trading system initializing...
2025-03-09 16:13:10,554 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:13:10,556 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:13:10,557 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:13:10,557 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:13:10,558 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:13:10,559 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:13:10,560 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:13:10,561 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:13:10,561 - trading_system - INFO - Created local data source
2025-03-09 16:13:10,594 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:13:10,595 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:13:10,597 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:13:10,598 - trading_system - INFO - Created exchange data source
2025-03-09 16:13:10,600 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:13:10,601 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:13:10,603 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:13:10,608 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:13:11,026 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:13:11,028 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:13:11,032 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:13:11,033 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:13:11,034 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:13:11,036 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:13:11,036 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:13:11,036 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:13:11,037 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:13:11,038 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:13:11,039 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:13:11,039 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:13:11,040 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:13:11,042 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:13:11,042 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:13:13,387 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:13:33,634 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:13:56,889 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:13:56,922 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:13:56,923 - trading_system - INFO - Trading system initializing...
2025-03-09 16:13:56,929 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:13:56,930 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:13:56,932 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:13:56,932 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:13:56,933 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:13:56,933 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:13:56,934 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:13:56,934 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:13:56,935 - trading_system - INFO - Created local data source
2025-03-09 16:13:56,950 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:13:56,951 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:13:56,952 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:13:56,952 - trading_system - INFO - Created exchange data source
2025-03-09 16:13:56,953 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:13:56,954 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:13:56,954 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:13:56,956 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:13:57,378 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:13:57,379 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:13:57,383 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:13:57,384 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:13:57,385 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:13:57,386 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:13:57,387 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:13:57,387 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:13:57,388 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:13:57,389 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:13:57,390 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:13:57,391 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:13:57,391 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:13:57,393 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:13:57,394 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:13:59,358 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:13:59,361 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:14:33,304 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:14:33,339 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:14:33,340 - trading_system - INFO - Trading system initializing...
2025-03-09 16:14:33,347 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:14:33,348 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:14:33,349 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:14:33,349 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:14:33,350 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:14:33,350 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:14:33,351 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:14:33,351 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:14:33,352 - trading_system - INFO - Created local data source
2025-03-09 16:14:33,373 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:14:33,381 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:14:33,382 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:14:33,382 - trading_system - INFO - Created exchange data source
2025-03-09 16:14:33,383 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:14:33,384 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:14:33,385 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:14:33,388 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:14:33,818 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:14:33,820 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:14:33,825 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:14:33,826 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:14:33,827 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:14:33,828 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:14:33,829 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:14:33,829 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:14:33,830 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:14:33,831 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:14:33,831 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:14:33,832 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:14:33,832 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:14:33,834 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:14:33,835 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:14:39,004 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:14:39,006 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:14:40,994 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 366, in fetch_historical
    df = await self.exchange.smart_fetch_ohlcv(symbol, timeframe, start_dt, end_dt)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 353, in smart_fetch_ohlcv
    return await self.fetch_historical_ohlcv(symbol, timeframe, start, end)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 251, in fetch_historical_ohlcv
    await self._init_async_exchange()
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 92, in _init_async_exchange
    proxies = self.config.get('proxies', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 16:14:40,995 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 16:14:40,996 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:14:40,997 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:14:40,998 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:14:40,999 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:14:41,000 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:14:41,001 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:14:41,001 - system.execution - INFO - Execution engine closed
2025-03-09 16:14:41,002 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:14:41,002 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:14:41,002 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:14:41,003 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:14:41,004 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:14:41,004 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:14:41,006 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:15:11,339 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:15:11,372 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:15:11,372 - trading_system - INFO - Trading system initializing...
2025-03-09 16:15:11,379 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:15:11,379 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:15:11,380 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:15:11,380 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:15:11,380 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:15:11,381 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:15:11,381 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:15:11,382 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:15:11,382 - trading_system - INFO - Created local data source
2025-03-09 16:15:11,398 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:15:11,399 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:15:11,400 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:15:11,400 - trading_system - INFO - Created exchange data source
2025-03-09 16:15:11,401 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:15:11,401 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:15:11,402 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:15:11,403 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:15:11,849 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:15:11,851 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:15:11,855 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:15:11,856 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:15:11,857 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:15:11,858 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:15:11,859 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:15:11,860 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:15:11,861 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:15:11,862 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:15:11,862 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:15:11,863 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:15:11,863 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:15:11,865 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:15:11,866 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:15:13,956 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:15:13,960 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:16:10,229 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:16:10,261 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:16:10,262 - trading_system - INFO - Trading system initializing...
2025-03-09 16:16:10,271 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:16:10,272 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:16:10,272 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:16:10,273 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:16:10,274 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:16:10,274 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:16:10,275 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:16:10,275 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:16:10,276 - trading_system - INFO - Created local data source
2025-03-09 16:16:10,292 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:16:10,293 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:16:10,293 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:16:10,295 - trading_system - INFO - Created exchange data source
2025-03-09 16:16:10,295 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:16:10,296 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:16:10,296 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:16:10,298 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:16:10,742 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:16:10,744 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:16:10,749 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:16:10,750 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:16:10,751 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:16:10,752 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:16:10,753 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:16:10,753 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:16:10,754 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:16:10,755 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:16:10,756 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:16:10,756 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:16:10,757 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:16:10,758 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:16:10,759 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:18:33,605 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:18:33,638 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:18:33,639 - trading_system - INFO - Trading system initializing...
2025-03-09 16:18:33,646 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:18:33,647 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:18:33,647 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:18:33,647 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:18:33,648 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:18:33,648 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:18:33,649 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:18:33,649 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:18:33,650 - trading_system - INFO - Created local data source
2025-03-09 16:18:33,666 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:18:33,667 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:18:33,668 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:18:33,668 - trading_system - INFO - Created exchange data source
2025-03-09 16:18:33,669 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:18:33,669 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:18:33,670 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:18:33,671 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:18:34,158 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:18:34,160 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:18:34,165 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:18:34,167 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:18:34,168 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:18:34,168 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:18:34,169 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:18:34,170 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:18:34,170 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:18:34,171 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:18:34,172 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:18:34,172 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:18:34,173 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:18:34,175 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:18:34,175 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:18:36,326 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:18:36,329 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:18:41,013 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:18:41,015 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:18:46,677 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741508324313&recvWindow=60000&signature=11c45e7cc1103454f16eef127b96f8169af682d9c8790533f65b798e853da419
2025-03-09 16:19:08,161 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:19:08,195 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:19:08,195 - trading_system - INFO - Trading system initializing...
2025-03-09 16:19:08,203 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:19:08,205 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:19:08,206 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:19:08,206 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:19:08,207 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:19:08,207 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:19:08,208 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:19:08,208 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:19:08,209 - trading_system - INFO - Created local data source
2025-03-09 16:19:08,226 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:19:08,227 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:19:08,228 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:19:08,228 - trading_system - INFO - Created exchange data source
2025-03-09 16:19:08,229 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:19:08,229 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:19:08,230 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:19:08,231 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:19:08,644 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:19:08,646 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:19:08,651 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:19:08,652 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:19:08,652 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:19:08,653 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:19:08,654 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:19:08,654 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:19:08,655 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:19:08,656 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:19:08,657 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:19:08,657 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:19:08,657 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:19:08,660 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:19:08,661 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:19:11,234 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:19:11,237 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:19:26,886 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:19:26,888 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:21:56,649 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741508495907&recvWindow=60000&signature=95f16f78cd4e61024e0a4e5d08a49703ad913d89a6b50b98dc3c972936fc6459
2025-03-09 16:22:20,845 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741508525225&recvWindow=60000&signature=27b4ace31abb39bdef9923f288a0fcbc8741f716415458ecd82b408a4496b0c3
2025-03-09 16:28:53,316 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:28:53,350 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:28:53,351 - trading_system - INFO - Trading system initializing...
2025-03-09 16:28:53,359 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:28:53,360 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:28:53,360 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:28:53,361 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:28:53,361 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:28:53,361 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:28:53,362 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:28:53,362 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:28:53,363 - trading_system - INFO - Created local data source
2025-03-09 16:28:53,379 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:28:53,389 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:28:53,389 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:28:53,390 - trading_system - INFO - Created exchange data source
2025-03-09 16:28:53,390 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:28:53,391 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:28:53,476 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:28:53,480 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:28:53,982 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:28:53,984 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:28:53,988 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:28:53,989 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:28:53,990 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:28:53,991 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:28:53,992 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:28:53,992 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:28:53,994 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:28:53,995 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:28:53,995 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:28:53,996 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:28:53,996 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:28:53,998 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:28:53,999 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:28:53,999 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:28:54,000 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:28:54,017 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:28:54,018 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:33:06,356 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:33:06,398 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:33:06,399 - trading_system - INFO - Trading system initializing...
2025-03-09 16:33:06,405 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:33:06,406 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:33:06,407 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:33:06,407 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:33:06,407 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:33:06,409 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:33:06,409 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:33:06,410 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:33:06,411 - trading_system - INFO - Created local data source
2025-03-09 16:33:06,426 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:33:06,427 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:33:06,427 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:33:06,428 - trading_system - INFO - Created exchange data source
2025-03-09 16:33:06,428 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:33:06,429 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:33:06,430 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:33:06,433 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:33:06,887 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:33:06,900 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:33:06,907 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:33:06,909 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:33:06,909 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:33:06,910 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:33:06,911 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:33:06,911 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:33:06,913 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:33:06,914 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:33:06,915 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:33:06,915 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:33:06,916 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:33:06,918 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:33:06,919 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:33:06,920 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:33:06,921 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:33:06,945 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:33:06,946 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:33:36,435 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741509195192&recvWindow=60000&signature=41c75c04915f1c2e5d3d8b33f0b143535be3abb4570856f68c625a5f5792c6d6
2025-03-09 16:34:05,506 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:34:05,561 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:34:05,562 - trading_system - INFO - Trading system initializing...
2025-03-09 16:34:05,573 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:34:05,576 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:34:05,577 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:34:05,578 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:34:05,579 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:34:05,581 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:34:05,582 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:34:05,584 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:34:05,585 - trading_system - INFO - Created local data source
2025-03-09 16:34:05,611 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:34:05,612 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:34:05,613 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:34:05,613 - trading_system - INFO - Created exchange data source
2025-03-09 16:34:05,614 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:34:05,614 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:34:05,614 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:34:05,616 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:34:06,077 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:34:06,080 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:34:06,084 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:34:06,085 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:34:06,087 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:34:06,087 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:34:06,088 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:34:06,089 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:34:06,090 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:34:06,091 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:34:06,091 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:34:06,092 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:34:06,092 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:34:06,095 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:34:06,095 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:34:06,095 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:34:06,097 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:34:06,113 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:34:06,114 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:34:36,798 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741509255570&recvWindow=60000&signature=d8db94e034975d278fb240c6a67b72cf2e15612df5ea4536a70463c2449ba5d5
2025-03-09 16:34:51,682 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:34:51,720 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:34:51,721 - trading_system - INFO - Trading system initializing...
2025-03-09 16:34:51,731 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:34:51,733 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:34:51,734 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:34:51,735 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:34:51,735 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:34:51,736 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:34:51,737 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:34:51,739 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:34:51,739 - trading_system - INFO - Created local data source
2025-03-09 16:34:51,759 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:34:51,760 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:34:51,761 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:34:51,761 - trading_system - INFO - Created exchange data source
2025-03-09 16:34:51,762 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:34:51,762 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:34:51,762 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:34:51,765 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:34:52,205 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:34:52,207 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:34:52,211 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:34:52,212 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:34:52,212 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:34:52,214 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:34:52,215 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:34:52,215 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:34:52,216 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:34:52,217 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:34:52,218 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:34:52,218 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:34:52,218 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:34:52,220 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:34:52,221 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:34:52,221 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:34:52,223 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:34:52,239 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:34:52,239 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:35:03,236 - trading_system - INFO - Downloaded data up to 2023-02-11 23:00:00.001000
2025-03-09 16:39:55,990 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:39:56,025 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:39:56,025 - trading_system - INFO - Trading system initializing...
2025-03-09 16:39:56,035 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:39:56,036 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:39:56,037 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:39:56,038 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:39:56,038 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:39:56,039 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:39:56,039 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:39:56,040 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:39:56,041 - trading_system - INFO - Created local data source
2025-03-09 16:39:56,057 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:39:56,057 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:39:56,058 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:39:56,058 - trading_system - INFO - Created exchange data source
2025-03-09 16:39:56,059 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:39:56,059 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:39:56,060 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:39:56,062 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:39:56,515 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:39:56,517 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:39:56,523 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:39:56,524 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:39:56,524 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:39:56,525 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:39:56,525 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:39:56,526 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:39:56,527 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:39:56,528 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:39:56,528 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:39:56,529 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:39:56,529 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:39:56,531 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:39:56,532 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:39:56,532 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:39:56,534 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:39:56,536 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: 'Binance' object has no attribute 'smart_fetch_ohlcv'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 366, in fetch_historical
    df = await self.exchange.smart_fetch_ohlcv(symbol, timeframe, start_dt, end_dt)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'Binance' object has no attribute 'smart_fetch_ohlcv'

2025-03-09 16:39:56,537 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 16:39:56,537 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:39:56,538 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:39:56,539 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:39:56,540 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:39:56,540 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:39:56,541 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:39:56,541 - system.execution - INFO - Execution engine closed
2025-03-09 16:39:56,542 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:39:56,542 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:39:56,542 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:39:56,543 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:39:56,543 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:39:56,543 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:39:56,545 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:42:03,968 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:42:04,004 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:42:04,005 - trading_system - INFO - Trading system initializing...
2025-03-09 16:42:04,013 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:42:04,014 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:42:04,015 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:42:04,016 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:42:04,016 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:42:04,017 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:42:04,017 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:42:04,018 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:42:04,019 - trading_system - INFO - Created local data source
2025-03-09 16:42:04,036 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:42:04,037 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:42:04,037 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:42:04,038 - trading_system - INFO - Created exchange data source
2025-03-09 16:42:04,038 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:42:04,039 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:42:04,040 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:42:04,041 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:42:04,472 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:42:04,475 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:42:04,479 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:42:04,480 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:42:04,481 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:42:04,481 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:42:04,482 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:42:04,483 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:42:04,484 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:42:04,484 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:42:04,485 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:42:04,485 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:42:04,486 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:42:04,488 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:42:04,488 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:42:04,489 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:42:04,490 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:42:04,506 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:42:04,507 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:42:29,806 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741509728542&recvWindow=60000&signature=0f9e27819d7d8bdad3516647f83d41b9009bba00012043cad6151f69401f0024
2025-03-09 16:43:05,550 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:43:05,583 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:43:05,584 - trading_system - INFO - Trading system initializing...
2025-03-09 16:43:05,591 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:43:05,592 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:43:05,592 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:43:05,593 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:43:05,593 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:43:05,594 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:43:05,594 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:43:05,595 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:43:05,595 - trading_system - INFO - Created local data source
2025-03-09 16:43:05,612 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:43:05,613 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:43:05,613 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:43:05,614 - trading_system - INFO - Created exchange data source
2025-03-09 16:43:05,615 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:43:05,615 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:43:05,616 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:43:05,618 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:43:06,049 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:43:06,051 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:43:06,056 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:43:06,057 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:43:06,058 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:43:06,059 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:43:06,059 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:43:06,060 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:43:06,061 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:43:06,062 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:43:06,063 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:43:06,063 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:43:06,064 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:43:06,066 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:43:06,066 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:43:06,066 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:43:06,068 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:43:06,084 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:43:06,085 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:44:12,516 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:44:12,558 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:44:12,559 - trading_system - INFO - Trading system initializing...
2025-03-09 16:44:12,567 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:44:12,568 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:44:12,569 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:44:12,569 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:44:12,570 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:44:12,570 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:44:12,570 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:44:12,571 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:44:12,572 - trading_system - INFO - Created local data source
2025-03-09 16:44:12,587 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:44:12,588 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:44:12,588 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:44:12,589 - trading_system - INFO - Created exchange data source
2025-03-09 16:44:12,590 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:44:12,590 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:44:12,591 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:44:12,592 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:44:13,020 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:44:13,022 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:44:13,026 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:44:13,027 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:44:13,028 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:44:13,029 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:44:13,030 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:44:13,031 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:44:13,032 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:44:13,033 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:44:13,034 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:44:13,034 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:44:13,035 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:44:13,037 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:44:13,037 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:44:13,038 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:44:13,039 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:44:13,055 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:44:13,055 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:44:31,183 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:44:31,219 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:44:31,220 - trading_system - INFO - Trading system initializing...
2025-03-09 16:44:31,227 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:44:31,228 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:44:31,229 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:44:31,229 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:44:31,229 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:44:31,230 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:44:31,230 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:44:31,231 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:44:31,231 - trading_system - INFO - Created local data source
2025-03-09 16:44:31,248 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:44:31,249 - trading_system - INFO - SimpleBinance initialized
2025-03-09 16:44:31,250 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:44:31,250 - trading_system - INFO - Created exchange data source
2025-03-09 16:44:31,251 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:44:31,251 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:44:31,252 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:44:31,254 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:44:31,744 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:44:31,746 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:44:31,751 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:44:31,752 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:44:31,753 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:44:31,753 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:44:31,754 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:44:31,755 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:44:31,756 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:44:31,757 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:44:31,758 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:44:31,759 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:44:31,759 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:44:31,761 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:44:31,762 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:44:31,762 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:44:31,763 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:44:31,780 - trading_system - INFO - CCXT Async Binance exchange initialized
2025-03-09 16:44:31,781 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:44:36,705 - trading_system - INFO - Downloaded data up to 2023-02-11 23:00:00.001000
2025-03-09 16:44:44,463 - trading_system - INFO - Downloaded data up to 2023-03-25 16:00:00.001000
2025-03-09 16:44:46,652 - trading_system - INFO - Downloaded data up to 2023-05-06 08:00:00.001000
2025-03-09 16:44:47,313 - trading_system - INFO - Downloaded data up to 2023-06-17 00:00:00.001000
2025-03-09 16:44:47,963 - trading_system - INFO - Downloaded data up to 2023-07-28 16:00:00.001000
2025-03-09 16:44:48,621 - trading_system - INFO - Downloaded data up to 2023-09-08 08:00:00.001000
2025-03-09 16:44:49,334 - trading_system - INFO - Downloaded data up to 2023-10-20 00:00:00.001000
2025-03-09 16:44:49,989 - trading_system - INFO - Downloaded data up to 2023-11-30 16:00:00.001000
2025-03-09 16:44:50,703 - trading_system - ERROR - Smart fetch failed for BTC/USDT 1h: Invalid comparison between dtype=datetime64[ns] and datetime
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arrays\datetimelike.py", line 536, in _validate_comparison_value
    self._check_compatible_with(other)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arrays\datetimes.py", line 540, in _check_compatible_with
    self._assert_tzawareness_compat(other)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arrays\datetimes.py", line 782, in _assert_tzawareness_compat
    raise TypeError(
TypeError: Cannot compare tz-naive and tz-aware datetime-like objects.

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arrays\datetimelike.py", line 983, in _cmp_method
    other = self._validate_comparison_value(other)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arrays\datetimelike.py", line 539, in _validate_comparison_value
    raise InvalidComparison(other) from err
pandas.errors.InvalidComparison: 2023-01-01 00:00:00+00:00

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 366, in fetch_historical
    df = await self.exchange.fetch_historical_ohlcv(symbol, timeframe, start_dt, end_dt)
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 304, in fetch_historical_ohlcv
    df = df[(df.index >= start_date) & (df.index <= end_date)]
             ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arraylike.py", line 60, in __ge__
    return self._cmp_method(other, operator.ge)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\indexes\base.py", line 7197, in _cmp_method
    result = op(self._values, other)
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\ops\common.py", line 76, in new_method
    return method(self, other)
           ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arraylike.py", line 60, in __ge__
    return self._cmp_method(other, operator.ge)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\arrays\datetimelike.py", line 985, in _cmp_method
    return invalid_comparison(self, other, op)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\site-packages\pandas\core\ops\invalid.py", line 40, in invalid_comparison
    raise TypeError(f"Invalid comparison between dtype={left.dtype} and {typ}")
TypeError: Invalid comparison between dtype=datetime64[ns] and datetime

2025-03-09 16:44:50,707 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 16:44:50,708 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:44:50,710 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:44:50,712 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:44:50,716 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:44:50,717 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:44:50,718 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:44:50,719 - system.execution - INFO - Execution engine closed
2025-03-09 16:44:50,720 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:44:50,720 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:44:50,721 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:44:50,722 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:44:50,723 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:44:50,724 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:44:50,725 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Future finished result=None>)
handle: <Handle Task.task_wakeup(<Future finished result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:49:56,881 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:49:56,915 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:49:56,916 - trading_system - INFO - Trading system initializing...
2025-03-09 16:49:56,922 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:49:56,923 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:49:56,924 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:49:56,924 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:49:56,924 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:49:56,924 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:49:56,926 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:49:56,927 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:49:56,928 - trading_system - INFO - Created local data source
2025-03-09 16:49:56,947 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:49:56,948 - trading_system - INFO - Binance interface initialized
2025-03-09 16:49:56,949 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:49:56,949 - trading_system - INFO - Created exchange data source
2025-03-09 16:49:56,950 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:49:56,951 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:49:56,952 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:49:56,955 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:49:57,391 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:49:57,393 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:49:57,398 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:49:57,399 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:49:57,400 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:49:57,400 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:49:57,401 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:49:57,402 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:49:57,403 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:49:57,404 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:49:57,404 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:49:57,405 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:49:57,405 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:49:57,407 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:49:57,408 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:49:57,408 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:49:57,411 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:49:57,411 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:50:00,346 - trading_system - INFO - Downloaded data up to 2023-02-11 23:00:00.001000
2025-03-09 16:50:01,029 - trading_system - INFO - Downloaded data up to 2023-03-25 16:00:00.001000
2025-03-09 16:50:01,832 - trading_system - INFO - Downloaded data up to 2023-05-06 08:00:00.001000
2025-03-09 16:50:02,472 - trading_system - INFO - Downloaded data up to 2023-06-17 00:00:00.001000
2025-03-09 16:50:03,173 - trading_system - INFO - Downloaded data up to 2023-07-28 16:00:00.001000
2025-03-09 16:50:03,915 - trading_system - INFO - Downloaded data up to 2023-09-08 08:00:00.001000
2025-03-09 16:50:04,618 - trading_system - INFO - Downloaded data up to 2023-10-20 00:00:00.001000
2025-03-09 16:50:05,307 - trading_system - INFO - Downloaded data up to 2023-11-30 16:00:00.001000
2025-03-09 16:50:05,982 - trading_system - ERROR - Failed to fetch historical data for BTC/USDT: Invalid comparison between dtype=datetime64[ns] and datetime
2025-03-09 16:50:05,983 - trading_system - WARNING - No data fetched for BTC/USDT 1h
2025-03-09 16:50:05,983 - trading_system - ERROR - 无法从交易所获取 BTC/USDT 1h 数据
2025-03-09 16:50:05,984 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 16:50:05,984 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 16:50:05,984 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 16:50:05,987 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:50:05,987 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 16:50:05,988 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:50:05,988 - system.execution - INFO - Execution engine closed
2025-03-09 16:50:05,989 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:50:05,989 - trading_system - INFO - Initiating system shutdown...
2025-03-09 16:50:05,990 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 16:50:05,990 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 16:50:05,991 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 16:50:05,991 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 16:50:05,993 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Future finished result=None>)
handle: <Handle Task.task_wakeup(<Future finished result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 16:52:22,233 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 16:52:22,268 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 16:52:22,269 - trading_system - INFO - Trading system initializing...
2025-03-09 16:52:22,276 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 16:52:22,277 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 16:52:22,277 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 16:52:22,278 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 16:52:22,278 - trading_system - INFO - Starting trading pipeline...
2025-03-09 16:52:22,279 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:52:22,279 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 16:52:22,280 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 16:52:22,281 - trading_system - INFO - Created local data source
2025-03-09 16:52:22,297 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 16:52:22,298 - trading_system - INFO - Binance interface initialized
2025-03-09 16:52:22,298 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 16:52:22,299 - trading_system - INFO - Created exchange data source
2025-03-09 16:52:22,299 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 16:52:22,299 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 16:52:22,300 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 16:52:22,302 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 16:52:22,764 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:52:22,766 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 16:52:22,770 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 16:52:22,772 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 16:52:22,772 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 16:52:22,773 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 16:52:22,773 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 16:52:22,774 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 16:52:22,775 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 16:52:22,776 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 16:52:22,776 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 16:52:22,777 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 16:52:22,777 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 16:52:22,779 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 16:52:22,780 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 16:52:22,780 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 16:52:22,781 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 16:52:22,782 - trading_system - INFO - Fetching historical data for BTC/USDT (attempt 1/3)
2025-03-09 16:52:22,783 - trading_system - INFO - Split data request into 52 chunks
2025-03-09 16:52:22,783 - trading_system - INFO - Fetching chunk 1/52: 2023-01-01 00:00:00+00:00 to 2023-01-08 00:00:00+00:00
2025-03-09 16:52:43,852 - trading_system - ERROR - Error fetching chunk 1: binance GET https://api.binance.com/api/v3/exchangeInfo
2025-03-09 16:52:44,861 - trading_system - INFO - Fetching chunk 2/52: 2023-01-08 00:00:00+00:00 to 2023-01-15 00:00:00+00:00
2025-03-09 16:53:05,891 - trading_system - ERROR - Error fetching chunk 2: binance GET https://api.binance.com/api/v3/exchangeInfo
2025-03-09 16:53:06,904 - trading_system - INFO - Fetching chunk 3/52: 2023-01-15 00:00:00+00:00 to 2023-01-22 00:00:00+00:00
2025-03-09 17:01:53,820 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:01:53,852 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:01:53,852 - trading_system - INFO - Trading system initializing...
2025-03-09 17:01:53,862 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:01:53,863 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:01:53,866 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:01:53,866 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:01:53,866 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:01:53,868 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:01:53,869 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:01:53,871 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:01:53,871 - trading_system - INFO - Created local data source
2025-03-09 17:01:53,876 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'list'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 35, in __init__
    self.params = self._build_params()
                  ^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 66, in _build_params
    api_key = self.config_manager.get(['api', 'binance', 'apiKey'])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'list'

2025-03-09 17:01:53,877 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'list'
2025-03-09 17:01:53,878 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:01:53,879 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:01:53,882 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:01:54,328 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:01:54,330 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:01:54,335 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:01:54,336 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:01:54,338 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:01:54,339 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:01:54,340 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:01:54,340 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:01:54,341 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:01:54,342 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:01:54,343 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:01:54,343 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:01:54,344 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:01:54,346 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:01:54,346 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:01:54,347 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:01:54,348 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:01:54,350 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:01:54,351 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:01:54,351 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:01:54,352 - system.execution - INFO - Execution engine closed
2025-03-09 17:01:54,352 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:01:54,353 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:01:54,354 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:01:54,354 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:01:54,355 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:01:54,356 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:01:54,358 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:05:09,593 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:05:09,634 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:05:09,634 - trading_system - INFO - Trading system initializing...
2025-03-09 17:05:09,647 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:05:09,650 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:05:09,651 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:05:09,652 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:05:09,652 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:05:09,653 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:05:09,654 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:05:09,655 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:05:09,655 - trading_system - INFO - Created local data source
2025-03-09 17:05:09,659 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 35, in __init__
    self.params = self._build_params()
                  ^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 84, in _build_params
    proxies = self.config_manager.get('proxies', {})
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 17:05:09,660 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 17:05:09,661 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:05:09,662 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:05:09,664 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:05:10,185 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:05:10,187 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:05:10,191 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:05:10,192 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:05:10,193 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:05:10,194 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:05:10,195 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:05:10,195 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:05:10,195 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:05:10,197 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:05:10,197 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:05:10,198 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:05:10,198 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:05:10,200 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:05:10,200 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:05:10,201 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:05:10,202 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:05:10,203 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:05:10,203 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:05:10,203 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:05:10,205 - system.execution - INFO - Execution engine closed
2025-03-09 17:05:10,205 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:05:10,206 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:05:10,206 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:05:10,206 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:05:10,207 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:05:10,207 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:05:10,209 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:05:28,892 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:05:28,926 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:05:28,927 - trading_system - INFO - Trading system initializing...
2025-03-09 17:05:28,935 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:05:28,936 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:05:28,937 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:05:28,937 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:05:28,938 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:05:28,938 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:05:28,939 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:05:28,940 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:05:28,940 - trading_system - INFO - Created local data source
2025-03-09 17:06:27,757 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'dict'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 35, in __init__
    self.params = self._build_params()
                  ^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 84, in _build_params
    proxies = self.config_manager.get('proxies')
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'dict'

2025-03-09 17:06:27,760 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'dict'
2025-03-09 17:06:27,761 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:06:27,765 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:06:27,769 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:06:28,203 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:06:28,205 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:06:28,210 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:06:28,212 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:06:28,212 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:06:28,213 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:06:28,214 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:06:28,214 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:06:28,220 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:06:28,221 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:06:28,221 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:06:28,222 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:06:28,222 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:06:28,225 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:06:28,225 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:06:28,226 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:06:28,226 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:06:28,228 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:06:28,228 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:06:28,229 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:06:28,230 - system.execution - INFO - Execution engine closed
2025-03-09 17:06:28,230 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:06:28,231 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:06:28,231 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:06:28,231 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:06:28,232 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:06:28,232 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:06:28,233 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:06:33,709 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:06:33,743 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:06:33,743 - trading_system - INFO - Trading system initializing...
2025-03-09 17:06:33,751 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:06:33,752 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:06:33,752 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:06:33,752 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:06:33,754 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:06:33,755 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:06:33,755 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:06:33,755 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:06:33,756 - trading_system - INFO - Created local data source
2025-03-09 17:09:26,678 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:09:26,711 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:09:26,712 - trading_system - INFO - Trading system initializing...
2025-03-09 17:09:26,720 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:09:26,721 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:09:26,722 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:09:26,722 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:09:26,723 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:09:26,724 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:09:26,724 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:09:26,725 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:09:26,725 - trading_system - INFO - Created local data source
2025-03-09 17:09:35,953 - binance_exchange - INFO - CCXT Binance exchange initialized
2025-03-09 17:09:35,955 - trading_system - ERROR - Failed to create exchange data source: unhashable type: 'list'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 43, in __init__
    self.rate_limit = self.config_manager.get(['api', 'rate_limit'], 1200)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\common\config_manager.py", line 302, in get
    if not isinstance(config, dict) or key not in config:
                                       ^^^^^^^^^^^^^^^^^
TypeError: unhashable type: 'list'

2025-03-09 17:09:35,956 - trading_system - WARNING - 无法创建备用交易所数据源: unhashable type: 'list'
2025-03-09 17:09:35,957 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:09:35,958 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:09:35,959 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:09:36,490 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:09:36,492 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:09:36,496 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:09:36,498 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:09:36,498 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:09:36,499 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:09:36,499 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:09:36,499 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:09:36,502 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:09:36,503 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:09:36,503 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:09:36,504 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:09:36,504 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:09:36,506 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:09:36,507 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:09:36,508 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:09:36,508 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:09:36,509 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:09:36,510 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:09:36,510 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:09:36,511 - system.execution - INFO - Execution engine closed
2025-03-09 17:09:36,511 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:09:36,511 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:09:36,512 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:09:36,513 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:09:36,513 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:09:36,514 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:09:36,516 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:09:42,609 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:09:42,649 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:09:42,650 - trading_system - INFO - Trading system initializing...
2025-03-09 17:09:42,658 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:09:42,659 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:09:42,659 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:09:42,660 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:09:42,660 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:09:42,661 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:09:42,661 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:09:42,661 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:09:42,662 - trading_system - INFO - Created local data source
2025-03-09 17:10:38,042 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:10:38,075 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:10:38,076 - trading_system - INFO - Trading system initializing...
2025-03-09 17:10:38,083 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:10:38,084 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:10:38,085 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:10:38,085 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:10:38,086 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:10:38,086 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:10:38,087 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:10:38,088 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:10:38,088 - trading_system - INFO - Created local data source
2025-03-09 17:10:38,091 - trading_system - ERROR - Failed to create exchange data source: 'proxies'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 35, in __init__
    self.params = self._build_params()
                  ^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 86, in _build_params
    params['proxies']['http'] = proxies['http']
    ~~~~~~^^^^^^^^^^^
KeyError: 'proxies'

2025-03-09 17:10:38,091 - trading_system - WARNING - 无法创建备用交易所数据源: 'proxies'
2025-03-09 17:10:38,091 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:10:38,092 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:10:38,094 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:10:38,523 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:10:38,527 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:10:38,532 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:10:38,533 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:10:38,534 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:10:38,535 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:10:38,535 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:10:38,536 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:10:38,537 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:10:38,538 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:10:38,539 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:10:38,540 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:10:38,541 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:10:38,542 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:10:38,543 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:10:38,544 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:10:38,545 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:10:38,546 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:10:38,546 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:10:38,547 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:10:38,547 - system.execution - INFO - Execution engine closed
2025-03-09 17:10:38,548 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:10:38,548 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:10:38,549 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:10:38,549 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:10:38,549 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:10:38,550 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:10:38,552 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:15:40,789 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:15:40,824 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:15:40,825 - trading_system - INFO - Trading system initializing...
2025-03-09 17:15:40,832 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:15:40,833 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:15:40,833 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:15:40,834 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:15:40,834 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:15:40,835 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:15:40,835 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:15:40,836 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:15:40,837 - trading_system - INFO - Created local data source
2025-03-09 17:15:40,839 - trading_system - ERROR - Failed to create exchange data source: 'proxies'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 31, in __init__
    self.params = self._build_params()
                  ^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 76, in _build_params
    params['proxies']['http'] = proxies['http']
    ~~~~~~^^^^^^^^^^^
KeyError: 'proxies'

2025-03-09 17:15:40,840 - trading_system - WARNING - 无法创建备用交易所数据源: 'proxies'
2025-03-09 17:15:40,840 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:15:40,841 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:15:40,842 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:15:41,285 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:15:41,288 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:15:41,292 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:15:41,293 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:15:41,293 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:15:41,295 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:15:41,296 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:15:41,296 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:15:41,297 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:15:41,298 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:15:41,299 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:15:41,300 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:15:41,300 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:15:41,302 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:15:41,303 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:15:41,304 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:15:41,304 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:15:41,306 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:15:41,307 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:15:41,307 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:15:41,308 - system.execution - INFO - Execution engine closed
2025-03-09 17:15:41,308 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:15:41,308 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:15:41,309 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:15:41,309 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:15:41,310 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:15:41,310 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:15:41,312 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:16:13,386 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:16:13,422 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:16:13,423 - trading_system - INFO - Trading system initializing...
2025-03-09 17:16:13,429 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:16:13,430 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:16:13,431 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:16:13,431 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:16:13,432 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:16:13,432 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:16:13,433 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:16:13,434 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:16:13,434 - trading_system - INFO - Created local data source
2025-03-09 17:16:58,575 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:16:58,616 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:16:58,617 - trading_system - INFO - Trading system initializing...
2025-03-09 17:16:58,625 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:16:58,627 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:16:58,628 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:16:58,628 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:16:58,629 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:16:58,629 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:16:58,629 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:16:58,629 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:16:58,631 - trading_system - INFO - Created local data source
2025-03-09 17:16:58,633 - trading_system - ERROR - Failed to create exchange data source: 'proxies'
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\data\sources.py", line 450, in create_source
    source = sources[source_type](config)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\data\sources.py", line 311, in __init__
    self.exchange = Binance(config)
                    ^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 31, in __init__
    self.params = self._build_params()
                  ^^^^^^^^^^^^^^^^^^^^
  File "D:\jacky\crypto_py\src\exchange\binance.py", line 73, in _build_params
    params['proxies']['http'] = self.config.get('proxies', 'http')
    ~~~~~~^^^^^^^^^^^
KeyError: 'proxies'

2025-03-09 17:16:58,634 - trading_system - WARNING - 无法创建备用交易所数据源: 'proxies'
2025-03-09 17:16:58,634 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:16:58,635 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:16:58,637 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:16:59,060 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:16:59,062 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:16:59,067 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:16:59,069 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:16:59,069 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:16:59,070 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:16:59,071 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:16:59,071 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:16:59,072 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:16:59,074 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:16:59,074 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:16:59,075 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:16:59,075 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:16:59,078 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:16:59,078 - trading_system - WARNING - 无法获取历史数据: BTC/USDT 1h 2023-01-01-2023-12-31
2025-03-09 17:16:59,079 - mode.backtesttradingmode - WARNING - BTC/USDT has no historical data
2025-03-09 17:16:59,079 - mode.backtesttradingmode - ERROR - backtest mode error: Failed to get historical data
Traceback (most recent call last):
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 135, in run
    await self._pre_run_setup(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\base_trading_mode.py", line 171, in _pre_run_setup
    await self._prepare_run(symbols, timeframe)
  File "D:\jacky\crypto_py\src\mode\backtest_trading_mode.py", line 50, in _prepare_run
    raise ValueError("Failed to get historical data")
ValueError: Failed to get historical data
2025-03-09 17:16:59,081 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:16:59,081 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 已关闭
2025-03-09 17:16:59,082 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:16:59,082 - system.execution - INFO - Execution engine closed
2025-03-09 17:16:59,083 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:16:59,083 - trading_system - INFO - Initiating system shutdown...
2025-03-09 17:16:59,083 - mode.backtesttradingmode - INFO - Shutting down backtest mode
2025-03-09 17:16:59,085 - system.strategy.dualmastrategy - WARNING - 策略 DualMAStrategy 未初始化，跳过关闭
2025-03-09 17:16:59,085 - system.strategy.dualmastrategy - INFO - DualMAStrategy shutdown complete
2025-03-09 17:16:59,086 - mode.backtesttradingmode - INFO - Backtest mode shutdown complete
2025-03-09 17:16:59,088 - asyncio - ERROR - Exception in callback Task.task_wakeup(<Task finishe...> result=None>)
handle: <Handle Task.task_wakeup(<Task finishe...> result=None>)>
Traceback (most recent call last):
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 708, in cancel
    if child.cancel(msg=msg):
       ^^^^^^^^^^^^^^^^^^^^^
  [Previous line repeated 486 more times]
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
  File "C:\Users\Jacky\anaconda3\envs\torch\Lib\asyncio\tasks.py", line 703, in cancel
    def cancel(self, msg=None):
    
RecursionError: maximum recursion depth exceeded
2025-03-09 17:18:23,960 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:18:23,996 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:18:23,996 - trading_system - INFO - Trading system initializing...
2025-03-09 17:18:24,003 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:18:24,004 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:18:24,004 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:18:24,005 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:18:24,005 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:18:24,006 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:18:24,006 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:18:24,007 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:18:24,008 - trading_system - INFO - Created local data source
2025-03-09 17:18:24,025 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 17:18:24,026 - trading_system - INFO - Binance interface initialized
2025-03-09 17:18:24,026 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 17:18:24,027 - trading_system - INFO - Created exchange data source
2025-03-09 17:18:24,027 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 17:18:24,028 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:18:24,029 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:18:24,030 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:18:24,472 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:18:24,474 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:18:24,479 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:18:24,480 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:18:24,481 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:18:24,481 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:18:24,483 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:18:24,483 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:18:24,484 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:18:24,485 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:18:24,486 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:18:24,486 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:18:24,487 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:18:24,489 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:18:24,490 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 17:18:24,490 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 17:18:24,492 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:18:24,492 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:18:45,573 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741511904493&recvWindow=60000&signature=5f1888fcf51632f6ed394f6e0d1a1945aa6bfcbe8a2e3c538e76700cf30bc5af
2025-03-09 17:19:08,652 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741511927584&recvWindow=60000&signature=f720f297bcffe14e2b00e3680026178eb600b63b76e231b373eb6644197978cc
2025-03-09 17:23:11,178 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:23:11,222 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:23:11,223 - trading_system - INFO - Trading system initializing...
2025-03-09 17:23:11,239 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:23:11,241 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:23:11,242 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:23:11,243 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:23:11,245 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:23:11,245 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:23:11,247 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:23:11,248 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:23:11,248 - trading_system - INFO - Created local data source
2025-03-09 17:23:11,273 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 17:23:11,274 - trading_system - INFO - Binance interface initialized
2025-03-09 17:23:11,275 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 17:23:11,276 - trading_system - INFO - Created exchange data source
2025-03-09 17:23:11,277 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 17:23:11,277 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:23:11,278 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:23:11,280 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:23:11,729 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:23:11,731 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:23:11,736 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:23:11,737 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:23:11,738 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:23:11,739 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:23:11,740 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:23:11,740 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:23:11,741 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:23:11,742 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:23:11,742 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:23:11,743 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:23:11,744 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:23:11,745 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:23:11,745 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 17:23:11,747 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 17:23:11,747 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:23:11,748 - trading_system - INFO - Fetching historical data for BTC/USDT (attempt 1/3)
2025-03-09 17:23:11,749 - trading_system - INFO - Split data request into 52 chunks
2025-03-09 17:23:11,749 - trading_system - INFO - Fetching chunk 1/52: 2023-01-01 00:00:00+00:00 to 2023-01-08 00:00:00+00:00
2025-03-09 17:23:32,824 - trading_system - ERROR - Error fetching chunk 1: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741512191750&recvWindow=60000&signature=806b475e94b6cb5b1a5f7fd423bae9ac4e7c1515e330bae0c3af3b92a9bf28fd
2025-03-09 17:23:33,829 - trading_system - INFO - Fetching chunk 2/52: 2023-01-08 00:00:00+00:00 to 2023-01-15 00:00:00+00:00
2025-03-09 17:24:40,895 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:24:40,929 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:24:40,930 - trading_system - INFO - Trading system initializing...
2025-03-09 17:24:40,937 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:24:40,938 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:24:40,938 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:24:40,939 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:24:40,939 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:24:40,940 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:24:40,940 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:24:40,941 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:24:40,941 - trading_system - INFO - Created local data source
2025-03-09 17:24:40,958 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 17:24:40,959 - trading_system - INFO - Binance interface initialized
2025-03-09 17:24:40,960 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 17:24:40,961 - trading_system - INFO - Created exchange data source
2025-03-09 17:24:40,961 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 17:24:40,962 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:24:40,964 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:24:40,970 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:24:41,393 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:24:41,396 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:24:41,400 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:24:41,402 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:24:41,403 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:24:41,404 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:24:41,404 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:24:41,404 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:24:41,405 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:24:41,407 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:24:41,407 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:24:41,408 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:24:41,408 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:24:41,410 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:24:41,411 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 17:24:41,412 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 17:24:41,413 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:24:41,413 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:25:02,485 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741512281414&recvWindow=60000&signature=c2697d28a44ea9517b661de02da00a1ba2a0df3fce1705b06beab511ed769c76
2025-03-09 17:27:11,380 - AsyncExecutor - INFO - AsyncExecutor started
2025-03-09 17:27:11,417 - ConfigManager - INFO - Configuration loaded from d:\jacky\crypto_py\conf\bt_config.yaml
2025-03-09 17:27:11,417 - trading_system - INFO - Trading system initializing...
2025-03-09 17:27:11,424 - system.tradingmodefactory - INFO - 自动注册 custom_mode (src.mode.trading_mode_factory.CustomTradingMode)
2025-03-09 17:27:11,425 - system.tradingmodefactory - INFO - 自动发现完成，注册了 4 个项目
2025-03-09 17:27:11,425 - trading_system - INFO - Trading core initialized | Mode: backtest | Version: unknown
2025-03-09 17:27:11,426 - trading_system - INFO - Available trading modes: ['backtest', 'paper', 'live', 'custom_mode']
2025-03-09 17:27:11,426 - trading_system - INFO - Starting trading pipeline...
2025-03-09 17:27:11,427 - trading_system - INFO - Starting trading pipeline | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:27:11,427 - system.tradingmodefactory - INFO - 创建新的 backtest 实例
2025-03-09 17:27:11,428 - trading_system - INFO - LocalSource initialized, data path: db/historical/
2025-03-09 17:27:11,429 - trading_system - INFO - Created local data source
2025-03-09 17:27:11,445 - trading_system - INFO - CCXT Binance exchange initialized
2025-03-09 17:27:11,446 - trading_system - INFO - Binance interface initialized
2025-03-09 17:27:11,447 - trading_system - INFO - ExchangeSource initialized, max request rate: 20/minute
2025-03-09 17:27:11,448 - trading_system - INFO - Created exchange data source
2025-03-09 17:27:11,448 - trading_system - INFO - 创建了交易所备用数据源用于自动下载缺失数据
2025-03-09 17:27:11,449 - trading_system - INFO - DataManager初始化完成: 数据源=local, 缓存=True, 交易模式=BACKTEST
2025-03-09 17:27:11,449 - system.strategyfactory - INFO - 注册了2个默认策略
2025-03-09 17:27:11,451 - system.strategyfactory - INFO - 自动注册 dual_ma (src.strategy.DualMA.DualMAStrategy)
2025-03-09 17:27:11,889 - system.strategyfactory - WARNING - 加载模块 src.strategy.spbbt 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:27:11,891 - system.strategyfactory - INFO - 自动发现完成，注册了 0 个项目
2025-03-09 17:27:11,895 - system.strategyfactory - WARNING - 处理文件 spbbt.py 时出错: cannot import name 'factors_lib' from 'lib' (unknown location)
2025-03-09 17:27:11,896 - system.strategyfactory - INFO - 自动发现完成，共注册3个策略
2025-03-09 17:27:11,896 - mode.backtesttradingmode - INFO - Initializing backtest trading mode
2025-03-09 17:27:11,897 - mode.backtesttradingmode - INFO - Initializing backtest mode
2025-03-09 17:27:11,898 - system.strategyfactory - WARNING - 使用标准方法加载策略 dual_ma 失败: 未知类型: dual_ma，尝试替代方法
2025-03-09 17:27:11,898 - system.strategyfactory - INFO - 创建新的 dual_ma 实例
2025-03-09 17:27:11,899 - system.strategy.dualmastrategy - INFO - 策略 DualMAStrategy 初始化完成
2025-03-09 17:27:11,900 - system.strategy.dualmastrategy - INFO - Initialized DualMAStrategy with short_window=10, long_window=30
2025-03-09 17:27:11,901 - mode.backtesttradingmode - INFO - Backtest mode initialization complete
2025-03-09 17:27:11,902 - mode.backtesttradingmode - INFO - Starting backtest mode | Symbols: ['BTC/USDT'] | Timeframe: 1h
2025-03-09 17:27:11,902 - mode.backtesttradingmode - INFO - State initialized with 100000 initial capital
2025-03-09 17:27:11,904 - trading_system - WARNING - Local file not found or failed to load: BTC_USDT_1h
2025-03-09 17:27:11,904 - trading_system - WARNING - 本地历史数据不存在或不完整: BTC/USDT 1h 2023-01-01-2023-12-31，尝试从交易所下载
2025-03-09 17:27:11,905 - trading_system - INFO - Fetching historical data from exchange: BTC/USDT 1h 2023-01-01 - 2023-12-31
2025-03-09 17:27:11,906 - trading_system - INFO - Using smart fetch for BTC/USDT 1h from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:27:11,906 - trading_system - INFO - Fetching historical data for BTC/USDT from 2023-01-01 00:00:00+00:00 to 2023-12-31 00:00:00+00:00
2025-03-09 17:27:32,971 - trading_system - ERROR - Error fetching historical chunk: binance GET https://api.binance.com/sapi/v1/capital/config/getall?timestamp=1741512431907&recvWindow=60000&signature=4bc9099917b695ffd98d3775d3c06a7a4f2b10de4606bdec57e5fdf9773cb396
